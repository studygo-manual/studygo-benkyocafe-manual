<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スタディGO スタッフマニュアル | 勉強カフェ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <button class="menu-toggle" id="menuToggle" aria-label="メニューを開く">&#9776;</button>
            <div class="header-logo-placeholder" aria-label="スタディGO">StudyGO</div>
            <h1>スタッフマニュアル<span class="subtitle">～勉強カフェ～</span></h1>
            <div class="header-guide" id="headerGuide">
                左の目次から項目を選択、または検索してご覧ください
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                <span class="user-name" id="userNameDisplay"></span>
                <button class="user-info-btn" id="pinChangeBtn">PIN変更</button>
                <button class="user-info-btn" id="logoutBtn">ログアウト</button>
            </div>
        </div>
    </header>

    <!-- ログインモーダル -->
    <div class="login-modal-overlay" id="loginOverlay">
        <div class="login-modal">
            <div class="login-modal-header">
                <h3>スタッフログイン</h3>
                <p>スタッフマニュアルを利用するにはログインしてください</p>
            </div>
            <div class="login-form">
                <div class="login-form-group">
                    <label for="loginName">スタッフ名</label>
                    <select id="loginName">
                        <option value="">-- 選択してください --</option>
                    </select>
                </div>
                <div class="login-form-group">
                    <label for="loginPin">PIN（4桁）</label>
                    <input type="password" id="loginPin" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="4桁の数字">
                </div>
                <button class="login-btn" id="loginBtn">ログイン</button>
                <div class="login-error" id="loginError"></div>
            </div>
        </div>
    </div>

    <!-- PIN変更モーダル -->
    <div class="pin-change-modal-overlay" id="pinChangeOverlay">
        <div class="pin-change-modal">
            <div class="pin-change-header">
                <h3>PIN変更</h3>
                <button class="pin-change-close" id="pinChangeClose">&times;</button>
            </div>
            <div class="pin-change-form">
                <div class="login-form-group">
                    <label for="currentPin">現在のPIN</label>
                    <input type="password" id="currentPin" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="現在の4桁PIN">
                </div>
                <div class="login-form-group">
                    <label for="newPin">新しいPIN</label>
                    <input type="password" id="newPin" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="新しい4桁PIN">
                </div>
                <div class="login-form-group">
                    <label for="confirmPin">新しいPIN（確認）</label>
                    <input type="password" id="confirmPin" maxlength="4" inputmode="numeric" pattern="[0-9]*" placeholder="もう一度入力">
                </div>
                <button class="pin-change-btn" id="pinChangeSaveBtn">PINを変更する</button>
                <div class="pin-change-error" id="pinChangeError"></div>
                <div class="pin-change-success" id="pinChangeSuccess"></div>
            </div>
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <nav id="sidebar">
        <div class="nav-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="検索...">
                <button class="search-clear" id="searchClear" aria-label="検索をクリア">&times;</button>
            </div>
            <div class="nav-header-row">
                <h3>目次</h3>
                <button class="top-btn" id="topButton">TOP画面へ</button>
            </div>
            <ul id="navList">
                <!-- JavaScriptで動的に生成 -->
            </ul>
        </div>
    </nav>

    <main>
        <!-- コンテキストバー（大項目・中項目の固定表示） -->
        <div id="contextBar" class="context-bar" style="display: none;">
            <span id="contextCategory" class="context-category"></span>
            <span class="context-separator">›</span>
            <span id="contextSection" class="context-section"></span>
            <span id="contextH3Sep" class="context-separator" style="display:none;">›</span>
            <span id="contextH3" class="context-h3" style="display:none;"></span>
        </div>
        <!-- マネージャーからのお知らせ（TOP：最新1件のみ表示） -->
        <div id="manager-notice" class="manager-notice">
            <div class="card" style="border-left: 5px solid #FF7043;">
                <h3 style="border-left-color: #FF7043; color: #E64A19;">最新のお知らせ</h3>
                <div id="noticeList">
                    <!-- お知らせデータ（JSで表示制御） -->
                    <div class="notice-card" data-notice-idx="0">
                        <div class="notice-priority high">重要</div>
                        <div class="notice-body">
                            <div class="notice-title">マニュアルが新しくなりました <span class="notice-date-inline">2026-02-10</span></div>
                            <div class="notice-text" data-full-text="クイズ機能やトラブル対応ガイドが追加されました。各セクション末尾の「理解度チェック」ボタンから、研修クイズに挑戦してください。">クイズ機能やトラブル対応ガイドが追加されました。各セクション末尾の「理解度チェック」ボタンから、研修クイズに挑戦してください。</div>
                        </div>
                        <div class="notice-actions" data-notice-id="notice-001">
                            <button class="notice-confirm-btn" onclick="confirmNotice(this, 'notice-001')">確認しました</button>
                        </div>
                    </div>
                    <div class="notice-card" data-notice-idx="1">
                        <div class="notice-priority normal">連絡</div>
                        <div class="notice-body">
                            <div class="notice-title">清掃チェックリストを更新しました <span class="notice-date-inline">2026-02-10</span></div>
                            <div class="notice-text" data-full-text="CL作業の清掃チェックリストに新しい項目を追加しています。確認をお願いします。">CL作業の清掃チェックリストに新しい項目を追加しています。確認をお願いします。</div>
                        </div>
                        <div class="notice-actions" data-notice-id="notice-002">
                            <button class="notice-confirm-btn" onclick="confirmNotice(this, 'notice-002')">確認しました</button>
                        </div>
                    </div>
                </div>
                <div class="notice-footer">
                    <a href="#" id="showAllNoticesLink" class="notice-all-link">お知らせ一覧を確認する</a>
                </div>
            </div>
        </div>

        <!-- マニュアルの使い方（シンプル版） -->
        <div id="usage-guide" class="usage-guide-compact">
            <p><strong>使い方：</strong>左の目次から項目を選択、または上部の検索バーでキーワード検索できます。</p>
        </div>

        <!-- よく見られている項目 & よく検索されている項目（下部中央配置） -->
        <section id="quick-access" class="usage-guide-section quick-access-section">
            <div class="quick-access-bottom">
                <div class="card quick-access-card">
                    <h3 style="border-left-color: #2196F3; color: #0D47A1; text-align: center;">よく見られている項目</h3>
                    <div class="quick-links quick-links-center" id="popularViews">
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="見学・お客様対応">
                            <span class="quick-link-icon">&#127970;</span>
                            <span>見学予約対応</span>
                        </a>
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="チェックイン・チェックアウト">
                            <span class="quick-link-icon">&#9989;</span>
                            <span>チェックイン・チェックアウト</span>
                        </a>
                        <a href="#" class="quick-link-item" data-quick-section="admin-panel" data-quick-h3="ダッシュボード">
                            <span class="quick-link-icon">&#128187;</span>
                            <span>管理画面ログイン</span>
                        </a>
                    </div>
                </div>
                <div class="card quick-access-card">
                    <h3 style="border-left-color: #FF9800; color: #E65100; text-align: center;">よく検索されている項目</h3>
                    <div class="quick-links quick-links-center" id="popularSearches">
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="月額契約">
                            <span class="quick-link-icon">&#128203;</span>
                            <span>月額契約</span>
                        </a>
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="月額契約">
                            <span class="quick-link-icon">&#128221;</span>
                            <span>契約</span>
                        </a>
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="プラン解約（退会）・休会">
                            <span class="quick-link-icon">&#128465;</span>
                            <span>プラン解約</span>
                        </a>
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="時間利用（ドロップイン）">
                            <span class="quick-link-icon">&#128336;</span>
                            <span>時間利用</span>
                        </a>
                        <a href="#" class="quick-link-item" data-quick-section="procedures" data-quick-h3="月額契約">
                            <span class="quick-link-icon">&#128273;</span>
                            <span>Akerun</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 研修進捗（一番下に配置） -->
        <div id="training-dashboard" class="card" style="margin-bottom: 20px;">
            <h3 id="trainingDashboardTitle" style="border-left-color: #9C27B0; color: #7B1FA2;">研修進捗</h3>
            <p style="font-size: 0.85rem; color: #666;">各セクションのクイズに合格するとバッジが獲得できます。</p>
            <div class="training-progress-grid" id="trainingProgressGrid">
                <!-- JSで動的に生成 -->
            </div>
        </div>

        <!-- 管理者用：誤答分析ダッシュボード -->
        <div id="admin-quiz-dashboard" class="card" style="margin-bottom: 20px; display: none;">
            <h3 style="border-left-color: #E65100; color: #E65100;">クイズ管理ダッシュボード</h3>
            <p style="font-size: 0.85rem; color: #666;">スタッフのクイズ結果を全PCから確認できます。</p>
            <div id="adminQuizStats"></div>
            <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">
                <button id="adminExportBtn" style="padding: 8px 16px; background: #1976D2; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">全履歴をコピー</button>
                <button id="adminClearBtn" style="padding: 8px 16px; background: #757575; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">ローカル履歴クリア</button>
                <button id="adminAllQuestionsBtn" style="padding: 8px 16px; background: #7B1FA2; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">全問題一覧</button>
                <span id="adminCopyMsg" style="line-height: 36px; color: #2E7D32; font-size: 0.85rem; display: none;">コピーしました</span>
            </div>
            <details style="margin-top: 12px; font-size: 0.82rem;">
                <summary style="cursor: pointer; color: #1976D2;">サーバー連携設定</summary>
                <div style="margin-top: 8px; padding: 10px; background: #F5F5F5; border-radius: 6px;">
                    <p style="margin: 0 0 6px; color: #666;">GAS WebアプリのURLを設定すると、クイズ結果が全PCで共有されます。</p>
                    <input type="text" id="quizApiUrlInput" placeholder="https://script.google.com/macros/s/..." style="width: 100%; padding: 6px 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.85rem; box-sizing: border-box;">
                    <button id="saveQuizApiUrl" style="margin-top: 6px; padding: 6px 16px; background: #4CAF50; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 0.82rem;">保存</button>
                    <span id="apiUrlSaveMsg" style="margin-left: 8px; color: #2E7D32; font-size: 0.82rem; display: none;">保存しました（ページを再読み込みしてください）</span>
                </div>
            </details>
        </div>

        <!-- お知らせ一覧（専用表示エリア） -->
        <div id="notice-list-page" style="display: none;">
            <div class="card" style="border-left: 5px solid #FF7043;">
                <h3 style="border-left-color: #FF7043; color: #E64A19;">お知らせ一覧</h3>
                <div id="noticeListAll">
                    <!-- JSでnoticeListの全件をクローンして表示 -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button id="backToTopFromNotices" class="top-btn">TOPに戻る</button>
                </div>
            </div>
        </div>

        <!-- 勉強カフェ > 基本情報 -->
        <section id="cafe-basic" data-category="cafe" data-modified>
            <h2>基本情報</h2>
            <div class="card">
                <h3>営業時間</h3>
                <div class="hours-visual">
                    <div class="hours-visual-header">
                        <span class="header-label">スタッフ滞在時間</span>
                        <span class="header-staffed">有人営業時間</span>
                        <span class="header-unmanned">無人営業時間</span>
                    </div>
                    <!-- 全て6-23時スケールで統一 (17時間=100%) -->
                    <!-- 平日: 6-23、有人17-21 -->
                    <div class="hours-visual-row">
                        <div class="hours-visual-label">平日</div>
                        <div class="hours-visual-bar-container">
                            <div class="hours-visual-numbers">
                                <span class="num" style="left: 0%;">6</span>
                                <span class="num" style="left: 64.7%;">17</span>
                                <span class="num" style="left: 88.2%;">21</span>
                                <span class="num end-mark" style="left: 100%;">23</span>
                            </div>
                            <div class="hours-visual-bar">
                                <div class="bar-unmanned" style="left: 0%; width: 64.7%;"></div>
                                <div class="bar-staffed" style="left: 64.7%; width: 23.5%;"></div>
                                <div class="bar-unmanned" style="left: 88.2%; width: 11.8%;"></div>
                                <div class="bar-end-line" style="left: 100%;"></div>
                            </div>
                        </div>
                    </div>
                    <!-- 土曜: 6-22、有人12-21 -->
                    <div class="hours-visual-row">
                        <div class="hours-visual-label">土曜</div>
                        <div class="hours-visual-bar-container">
                            <div class="hours-visual-numbers">
                                <span class="num" style="left: 0%;">6</span>
                                <span class="num" style="left: 35.3%;">12</span>
                                <span class="num" style="left: 88.2%;">21</span>
                                <span class="num end-mark" style="left: 94.1%;">22</span>
                            </div>
                            <div class="hours-visual-bar">
                                <div class="bar-unmanned" style="left: 0%; width: 35.3%;"></div>
                                <div class="bar-staffed" style="left: 35.3%; width: 52.9%;"></div>
                                <div class="bar-unmanned" style="left: 88.2%; width: 5.9%;"></div>
                                <div class="bar-end-line" style="left: 94.1%;"></div>
                            </div>
                        </div>
                    </div>
                    <!-- 日祝: 6-21、有人12-21 -->
                    <div class="hours-visual-row">
                        <div class="hours-visual-label">日祝</div>
                        <div class="hours-visual-bar-container">
                            <div class="hours-visual-numbers">
                                <span class="num" style="left: 0%;">6</span>
                                <span class="num" style="left: 35.3%;">12</span>
                                <span class="num end-mark" style="left: 88.2%;">21</span>
                            </div>
                            <div class="hours-visual-bar">
                                <div class="bar-unmanned" style="left: 0%; width: 35.3%;"></div>
                                <div class="bar-staffed" style="left: 35.3%; width: 52.9%;"></div>
                                <div class="bar-end-line" style="left: 88.2%;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 20px;">休業日・短縮営業日</h4>
                <table class="info-table">
                    <tr>
                        <th>休業日</th>
                        <td>年末年始（12/29〜1/3）<br><span class="note">※年末年始パスの販売あり</span></td>
                    </tr>
                    <tr>
                        <th>短縮営業日</th>
                        <td>メンテナンスデー（年2回程度）<br>停電・水道点検</td>
                    </tr>
                </table>
                <p class="note">※営業時間の変更は店内掲示・メール・Lステップ等にてご案内いたします。</p>

                <h4 style="margin-top: 20px;">館内清掃について</h4>
                <table class="info-table">
                    <tr>
                        <th>平日</th>
                        <td>17:00前後・20:00〜21:00ごろ</td>
                    </tr>
                    <tr>
                        <th>土日祝</th>
                        <td>12:00前後・20:00〜21:00ごろ</td>
                    </tr>
                </table>
                <p class="note">掃除機がけ・ドリンクコーナーのメンテナンス等で、一時的なドリンクコーナーのご利用制限・騒音等でご迷惑をおかけします。快適な店内環境の維持にご協力をお願いいたします。</p>
            </div>
            <div class="card">
                <h3>料金</h3>

                <h4 class="pricing-label pricing-monthly">月額プラン</h4>
                <!-- プラン一体型テーブル（名称 + 利用可能時間帯 + 料金） -->
                <div class="plan-unified" style="overflow-x:auto;">
                    <!-- 時間スケールヘッダー -->
                    <div class="plan-unified-row plan-unified-header-row">
                        <div class="plan-unified-name"></div>
                        <div class="plan-unified-chart"><div class="plan-time-scale"><span style="left:0%">6</span><span style="left:17.6%">9</span><span style="left:23.5%">10</span><span style="left:64.7%">17</span><span style="left:76.5%">19</span><span style="left:88.2%">21</span><span style="left:94.1%">22</span><span style="left:100%">23</span></div></div>
                        <div class="plan-unified-price" style="font-size:0.7rem; color:#999;">月額（税込）</div>
                    </div>
                    <!-- レギュラープラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">レギュラー</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:64.7%;width:35.3%;background:#4CAF50;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:17.6%;width:76.5%;background:#4CAF50;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:17.6%;width:70.6%;background:#4CAF50;"></div></div></div>
                        <div class="plan-unified-price"><strong>14,080円</strong></div>
                    </div>
                    <!-- レギュラー+プラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">レギュラー+</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:17.6%;width:82.4%;background:#2E7D32;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:17.6%;width:76.5%;background:#2E7D32;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:17.6%;width:70.6%;background:#2E7D32;"></div></div></div>
                        <div class="plan-unified-price"><strong>19,580円</strong></div>
                    </div>
                    <!-- レギュラーM+プラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">レギュラーM+</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#8BC34A;"></div><div class="plan-bar-fill" style="left:64.7%;width:35.3%;background:#8BC34A;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:94.1%;background:#8BC34A;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:88.2%;background:#8BC34A;"></div></div></div>
                        <div class="plan-unified-price"><strong>17,490円</strong></div>
                    </div>
                    <!-- レギュラーモーニングプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">レギュラーモーニング</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#A5D6A7;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#A5D6A7;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#A5D6A7;"></div></div></div>
                        <div class="plan-unified-price"><strong>7,150円</strong></div>
                    </div>
                    <!-- ウィークデイプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">ウィークデイ</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:100%;background:#2196F3;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span></div><div class="plan-bar"><span class="plan-bar-label">日</span></div></div>
                        <div class="plan-unified-price"><strong>14,080円</strong></div>
                    </div>
                    <!-- ウィークデイモーニングプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">ウィークデイモーニング</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#90CAF9;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span></div><div class="plan-bar"><span class="plan-bar-label">日</span></div></div>
                        <div class="plan-unified-price"><strong>5,500円</strong></div>
                    </div>
                    <!-- ウィークデイライトプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">ウィークデイライト</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:17.6%;width:58.8%;background:#00ACC1;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span></div><div class="plan-bar"><span class="plan-bar-label">日</span></div></div>
                        <div class="plan-unified-price"><strong>12,870円</strong></div>
                    </div>
                    <!-- ホリデイプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">ホリデイ</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:94.1%;background:#E91E63;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:88.2%;background:#E91E63;"></div></div></div>
                        <div class="plan-unified-price"><strong>12,870円</strong></div>
                    </div>
                    <!-- ホリデイモーニングプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">ホリデイモーニング</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#F48FB1;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:23.5%;background:#F48FB1;"></div></div></div>
                        <div class="plan-unified-price"><strong>4,400円</strong></div>
                    </div>
                    <!-- プレミアムプラン -->
                    <div class="plan-unified-row">
                        <div class="plan-unified-name">プレミアム</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:100%;background:#9C27B0;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:94.1%;background:#9C27B0;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:88.2%;background:#9C27B0;"></div></div></div>
                        <div class="plan-unified-price"><strong>23,980円</strong></div>
                    </div>
                    <!-- 【60分】毎日！習慣化プラン -->
                    <div class="plan-unified-row plan-unified-habit">
                        <div class="plan-unified-name">【60分】毎日！習慣化プラン</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:100%;background:#8D6E63;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:94.1%;background:#8D6E63;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:88.2%;background:#8D6E63;"></div></div></div>
                        <div class="plan-unified-price"><strong>6,600円</strong></div>
                    </div>
                    <!-- 【120分】毎日！習慣化プラン -->
                    <div class="plan-unified-row plan-unified-habit">
                        <div class="plan-unified-name">【120分】毎日！習慣化プラン</div>
                        <div class="plan-unified-chart"><div class="plan-bar"><span class="plan-bar-label">平</span><div class="plan-bar-fill" style="left:0%;width:100%;background:#5D4037;"></div></div><div class="plan-bar"><span class="plan-bar-label">土</span><div class="plan-bar-fill" style="left:0%;width:94.1%;background:#5D4037;"></div></div><div class="plan-bar"><span class="plan-bar-label">日</span><div class="plan-bar-fill" style="left:0%;width:88.2%;background:#5D4037;"></div></div></div>
                        <div class="plan-unified-price"><strong>11,000円</strong></div>
                    </div>
                    <div class="plan-time-legend" style="margin-top:8px;"><span>平＝平日 土＝土曜 日＝日祝</span><span>色付き＝利用可能時間帯</span></div>
                </div>

                <h4 class="pricing-label pricing-habit">毎日！習慣化プランについて</h4>
                <p style="font-size:0.85rem; color:#666; margin-bottom:10px;">毎日少しずつ勉強する習慣をつけるためのプランです。1日あたりの利用時間に上限があります。</p>
                <table class="info-table" style="table-layout: fixed;">
                    <colgroup><col style="width: 18%;"><col style="width: 82%;"></colgroup>
                    <tr>
                        <th>利用時間</th>
                        <td>1日合計（60／120）分まで（営業時間内ならいつでも利用可）</td>
                    </tr>
                    <tr>
                        <th>分割利用OK</th>
                        <td>「朝30分 ＋ 夜30分」など、1日の利用時間を分割することも可能です。</td>
                    </tr>
                    <tr>
                        <th>超過料金</th>
                        <td>1日の利用時間が（60／120）分を超えた場合は、<strong>1分単位で追加料金</strong>が発生します。</td>
                    </tr>
                    <tr>
                        <th>上限終了後</th>
                        <td>1日の上限を使い切った後は、本プランでのチェックインはできません。引き続き利用する場合は、別途<span style="color: #1565C0; font-weight: bold;">時間利用</span>パックをご購入ください。</td>
                    </tr>
                </table>

                <h4 class="pricing-label pricing-extra">プラン時間外料金</h4>
                <ul>
                    <li>契約プラン外の時間帯の利用は<span class="app-badge">時間利用（ドロップイン）</span>パックの購入が必要です</li>
                    <li>利用を延長される場合は、<strong>1分につき13円（税込）</strong>の追加料金が発生します</li>
                    <li>料金はチェックアウト時に、登録済みのクレジットカードで<strong>自動精算</strong>されます</li>
                </ul>

                <h4 class="pricing-label pricing-dropin">時間利用（ドロップイン）</h4>
                <table class="info-table">
                    <tr>
                        <th>利用料金</th>
                        <td><strong>1時間パック（税込770円）</strong></td>
                    </tr>
                    <tr>
                        <th>対応時間</th>
                        <td><strong>有人営業時間帯のみ</strong>（平日 17-21時 / 土日祝 12-21時）<br><span class="note">※無人営業時間では、時間利用パックの購入はできません</span></td>
                    </tr>
                    <tr>
                        <th>延長料金</th>
                        <td><strong>1分につき13円（税込）</strong></td>
                    </tr>
                    <tr>
                        <th>決済方法</th>
                        <td>チェックアウト時にクレジットカードで<strong>自動精算</strong></td>
                    </tr>
                </table>

                <h4 class="pricing-label pricing-option">オプション</h4>
                <table class="info-table">
                    <tr>
                        <th>ロッカー(小) / ロッカー(大)</th>
                        <td><strong>1,650円(税込)</strong> / <strong>2,200円(税込)</strong></td>
                    </tr>
                </table>
            </div>

            <div class="card" style="border-left: 5px solid var(--primary-color);">
                <h3>入会時に必要なもの</h3>
                <ul>
                    <li>入会金 <strong>11,000円（税込）</strong> ＋ 当月日割り分月会費 ＋ 翌月分月会費</li>
                    <li><strong>クレジットカード</strong></li>
                    <li><strong>スマートフォン</strong></li>
                    <li>身分証（<strong>氏名</strong>、<strong>現住所</strong>が記載されているもの）<br><span class="note">※未成年の方は保護者同意書が必要となります</span></li>
                </ul>
            </div>

            <div class="card" style="border-left: 4px solid #f44336;">
                <h3 style="color: #C62828; border-left-color: #f44336;">15歳以上の現役高校生の方</h3>
                <ul>
                    <li>プランに関わらずご利用時間は <strong>21:00まで</strong>となります</li>
                    <li>入会時には<strong>保護者同意書が必要</strong>となります<br><span class="note">※保護者から一筆いただければ、22:00までの利用も可能です</span></li>
                </ul>
            </div>

            <!-- ===== スタジオルール ===== -->
            <div class="card important" style="margin-top: 30px; border-left: 5px solid var(--primary-color);">
                <h3 style="text-align: center; font-size: 1.3rem; border-left: none; padding-left: 0;">～ スタジオルール ～</h3>
            </div>

            <!-- ルールカードグリッド（4列） -->
            <div class="rule-card-grid">
                <div class="rule-card" style="border-color: #E91E63;">
                    <div class="rule-card-title" style="background: #E91E63;">&#10102; 音や声について</div>
                    <div class="rule-card-body">
                        <p>ラウンジでの会話、お電話・WEB会議等は<strong>10分以内</strong>に。声が大きくなりすぎないようご注意ください。ワークスペースでは<strong>話声や通話はご遠慮</strong>ください。お心当たりのある方は会議室やテルブースをご利用ください。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #4CAF50;">
                    <div class="rule-card-title" style="background: #4CAF50;">&#10103; 貸出備品について</div>
                    <div class="rule-card-body">
                        <p>デスクライトや荷物かご、ブランケット等は<strong>元の場所にお戻し</strong>ください。お持ち帰りにならないようご注意ください。充電器等は<strong>受付カウンター</strong>へご返却を。お忘れ物は<strong>2週間</strong>保管後、処分いたします。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #E91E63;">
                    <div class="rule-card-title" style="background: #E91E63;">&#10104; 服装について</div>
                    <div class="rule-card-body">
                        <p>適度な緊張感を大切にしております。ジャージ・サンダル等でのご入店は<strong>公序良俗・衛生面の観点からお控え</strong>ください。<strong>フレグランスフリー</strong>にご協力ください。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #4CAF50;">
                    <div class="rule-card-title" style="background: #4CAF50;">&#10105; 営業や勧誘について</div>
                    <div class="rule-card-body">
                        <p>他の方への<strong>営業活動は禁止</strong>です。物品勧誘・セミナー・コンサルティング・マルチ商法・ネットワークビジネス・宗教勧誘は固くお断り。発覚した場合<strong>退店・除名処分</strong>の対象です。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #FF9800;">
                    <div class="rule-card-title" style="background: #FF9800;">&#10106; お席の移動について</div>
                    <div class="rule-card-body">
                        <p>お席に荷物を置いたままの離席は<strong>1時間まで</strong>。1時間以上の離席でスタッフがお荷物を移動する場合があります。<strong>2席以上の確保はお断り</strong>しております。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #2196F3;">
                    <div class="rule-card-title" style="background: #2196F3;">&#10107; 貴重品について</div>
                    <div class="rule-card-body">
                        <p>お席を離れる際は貴重品は<strong>自己の責任</strong>にてお持ちください。ノートや紙類等の<strong>置き忘れ</strong>にご注意ください。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #FF9800;">
                    <div class="rule-card-title" style="background: #FF9800;">&#10108; 打刻について</div>
                    <div class="rule-card-body">
                        <p>ご利用開始とご利用終了時に<strong>打刻</strong>をお願いします。打刻されないまま営業時間終了で<strong>自動チェックアウト</strong>になります。エラーの場合はメールまたは店頭にて修正申請を。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #FFC107;">
                    <div class="rule-card-title" style="background: #FFC107; color: #333;">&#10109; 駐輪・駐車について</div>
                    <div class="rule-card-body">
                        <p>BPスタジオでは<strong>自転車の駐輪・バイク・車でのご来店はお断り</strong>しております。ルール違反による撤去や紛争等の責任は負いかねます。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #2196F3;">
                    <div class="rule-card-title" style="background: #2196F3;">&#10110; 温度について</div>
                    <div class="rule-card-body">
                        <p>温度は各スタジオを丸ごと<strong>エアコンで一元管理</strong>しております。個別の温度調整には対応しかねます。<strong>ブランケット等</strong>をご利用ください。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #795548;">
                    <div class="rule-card-title" style="background: #795548;">&#10111; 喫煙について</div>
                    <div class="rule-card-body">
                        <p>当スタジオは<strong>全面禁煙</strong>です。施設内・エントランス・お手洗い等での喫煙は固くお断り。近隣の喫煙所をご利用ください。<strong>電子タバコ等も同様</strong>です。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #FF5722;">
                    <div class="rule-card-title" style="background: #FF5722;">&#9451; ゴミについて</div>
                    <div class="rule-card-body">
                        <p><strong>ゴミの分別</strong>にご協力を。飲み残しは流しへ、紙コップは専用ダストボックスへ、ペットボトルはラベルと蓋を分別。ノートの中身は紙のゴミ箱へ。</p>
                    </div>
                </div>
                <div class="rule-card" style="border-color: #FFC107;">
                    <div class="rule-card-title" style="background: #FFC107; color: #333;">&#9452; 飲食物について</div>
                    <div class="rule-card-body">
                        <p>匂いの強いもの・カップ麺・<strong>アルコール類の持ち込みはご遠慮</strong>ください。お食事は<strong>ラウンジ</strong>で。タンブラーや水筒はフタのしっかり閉まるものを。</p>
                    </div>
                </div>
                <div style="grid-column: 1 / -1; border-top: 2px dashed #9C27B0; margin: 8px 0 4px; padding-top: 6px;">
                    <p style="margin: 0; font-size: 0.75rem; color: #7B1FA2; font-weight: bold; text-align: center;">▼ スタジオ別ルール ▼</p>
                </div>
            </div>
            <!-- スタジオ別ルール（2列レイアウト） -->
            <div style="display: flex; gap: 0; margin-top: 10px;">
                <!-- BPスタジオ（左） -->
                <div style="flex: 1; padding-right: 10px; border-right: 3px solid #9C27B0;">
                    <h4 style="text-align: center; color: #E65100; margin: 0 0 8px; font-size: 0.95rem;">&#x1F7E0; BPスタジオ</h4>
                    <div class="rule-card" style="border-color: #E65100;">
                        <div class="rule-card-title" style="background: #E65100;">&#9453; テルブースについて</div>
                        <div class="rule-card-body">
                            <p><strong>完全防音ではない</strong>ので、個人情報などの取り扱いにはご注意ください。扉は閉めてご利用いただき、<strong>お食事</strong>や、お荷物を置いたままでの<strong>お席の確保はお控え</strong>ください。混雑時の<strong>長時間利用はご遠慮</strong>ください。</p>
                        </div>
                    </div>
                    <div class="rule-card" style="border-color: #E65100; margin-top: 8px;">
                        <div class="rule-card-title" style="background: #E65100;">&#9454; 自動ドアについて</div>
                        <div class="rule-card-body">
                            <p>当ビル正面入口の自動ドアの使用は<strong>緊急時以外は禁止</strong>されています。お帰りの際はラウンジに繋がる<strong>当スタジオのドア</strong>をご使用ください。</p>
                        </div>
                    </div>
                </div>
                <!-- 新宿スタジオ（右） -->
                <div style="flex: 1; padding-left: 10px;">
                    <h4 style="text-align: center; color: #1565C0; margin: 0 0 8px; font-size: 0.95rem;">&#x1F535; 新宿スタジオ</h4>
                    <div class="rule-card" style="border-color: #1565C0;">
                        <div class="rule-card-title" style="background: #1565C0;">&#9453; 会議室について</div>
                        <div class="rule-card-body">
                            <p>会議室は<strong>15分110円</strong>でご利用いただけます。ご予約は<strong>WEBページ</strong>からご予約ください。</p>
                        </div>
                    </div>
                    <div class="rule-card" style="border-color: #1565C0; margin-top: 8px;">
                        <div class="rule-card-title" style="background: #1565C0;">&#9454; 混雑時について</div>
                        <div class="rule-card-body">
                            <p>混雑時は<strong>BPスタジオへの移動</strong>をお願いする場合がございます。両スタジオをご活用いただき、快適にお過ごしください。</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 20px; background: #fff; border-left: 5px solid var(--primary-color);">
                <h3>有人・無人時間帯の違い</h3>

                <table class="info-table" style="margin-bottom: 15px;">
                    <thead>
                        <tr>
                            <th style="width: 20%; background: #fff;"></th>
                            <th style="width: 40%; background: #E8F5E9; color: #2E7D32;">有人時間帯</th>
                            <th style="width: 40%; background: #FFEBEE; color: #C62828;">無人時間帯</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>平日</th>
                            <td style="text-align: center; font-weight: bold; color: #2E7D32; background: #F1F8E9;">17:00〜21:00</td>
                            <td style="text-align: center; font-weight: bold; color: #C62828; background: #FFF8F8;">6:00〜17:00 / 21:00〜23:00</td>
                        </tr>
                        <tr>
                            <th>土曜</th>
                            <td style="text-align: center; font-weight: bold; color: #2E7D32; background: #F1F8E9;">12:00〜21:00</td>
                            <td style="text-align: center; font-weight: bold; color: #C62828; background: #FFF8F8;">6:00〜12:00 / <strong>21:00〜22:00</strong></td>
                        </tr>
                        <tr>
                            <th>日祝</th>
                            <td style="text-align: center; font-weight: bold; color: #2E7D32; background: #F1F8E9;">12:00〜21:00</td>
                            <td style="text-align: center; font-weight: bold; color: #C62828; background: #FFF8F8;">6:00〜12:00</td>
                        </tr>
                    </tbody>
                </table>

                <table class="info-table">
                    <thead>
                        <tr>
                            <th style="width: 20%; background: #fff;">項目</th>
                            <th style="width: 40%; background: #E8F5E9; color: #2E7D32;">有人時間帯</th>
                            <th style="width: 40%; background: #FFEBEE; color: #C62828;">無人時間帯</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>スタッフ</th>
                            <td style="text-align: center; background: #F1F8E9;"><strong style="color: #2E7D32; font-size: 1.1em;">いる</strong></td>
                            <td style="text-align: center; background: #FFF8F8;"><strong style="color: #C62828; font-size: 1.1em;">いない</strong></td>
                        </tr>
                        <tr>
                            <th>入館方法</th>
                            <td colspan="2" style="text-align: center;">入口ドアは施錠 ― <strong>スタディGOアプリで解錠</strong>が必要</td>
                        </tr>
                        <tr>
                            <th>備品の貸出</th>
                            <td style="background: #F1F8E9;">受付にて充電器等の貸出あり</td>
                            <td style="background: #FFF8F8;">充電器等の一部備品は<strong>利用不可</strong><br>（セルフ備品は利用可）</td>
                        </tr>
                        <tr>
                            <th>各種手続き</th>
                            <td style="background: #F1F8E9;">すべて対応可能<br>（休会・プラン解約・オプション契約等）</td>
                            <td style="background: #FFF8F8;">プラン解約・オプション契約/解約手続きは<strong>不可</strong><br>→ 有人時間帯にお越しください</td>
                        </tr>
                        <tr>
                            <th>空調・照明</th>
                            <td style="background: #F1F8E9;">スタッフが変更可能<br><span class="note">※会員様は操作できません</span></td>
                            <td style="background: #FFF8F8;">自動で稼働<br><span class="note">※会員様は操作できません</span></td>
                        </tr>
                        <tr>
                            <th>困ったとき</th>
                            <td style="background: #F1F8E9;">スタッフに直接お声がけください</td>
                            <td style="background: #FFF8F8;">緊急連絡先：<strong>050-3199-1446</strong><br><span class="note">※メール・Lステップでも可能</span></td>
                        </tr>
                        <tr>
                            <th>退席時</th>
                            <td colspan="2" style="text-align: center;">机を綺麗にしてお帰りください</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </section>


        <!-- 勉強カフェ > スタジオ紹介 -->
        <section id="cafe-studio-compare" data-category="cafe">
            <h2>スタジオ比較表</h2>

            <div class="card" style="border-left: 5px solid var(--primary-color);">
                <h3 style="text-align: center; font-size: 1.3rem;">スタジオ比較表</h3>
                <p class="note" style="text-align: center; margin-bottom: 10px;">勉強カフェ新宿エリアには2つのスタジオがあります。どちらも同じ会員プラン・営業時間でご利用いただけます。</p>
                <p class="note" style="text-align: center; margin-bottom: 10px; color: #C62828; font-weight: bold;">※ご契約期間中は、契約したスタジオのみご利用いただけます。</p>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th style="width: 22%;">比較項目</th>
                            <th style="width: 39%; background: #1565C0;">新宿スタジオ（南口）</th>
                            <th style="width: 39%; background: #E65100;">新宿BPスタジオ（西口）</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>最寄り駅</td>
                            <td>新宿駅 6番出口 <strong>徒歩1分</strong></td>
                            <td>新宿西口駅 <strong>徒歩5分</strong></td>
                        </tr>
                        <tr>
                            <td>フロア</td>
                            <td>ビル<strong>6F</strong></td>
                            <td><strong>1F</strong>（路面店舗）</td>
                        </tr>
                        <tr>
                            <td>雰囲気</td>
                            <td>シックでモダン<br>落ち着いた大人の空間</td>
                            <td>ガラス張りで開放的<br>ビンテージ家具の温かみ</td>
                        </tr>
                        <tr>
                            <td>個室スペース</td>
                            <td><strong>会議室</strong>（MTGルーム）<br><span style="color: #C62828; font-weight: bold;">完全予約制</span>：15分110円<br><span class="note">利用希望時はスタッフへお声がけください。<br>社内利用の場合もございます。</span></td>
                            <td><strong>テルブース</strong>（個室ブース）<br>電話・WEB会議・音読用<br><span class="note">完全防音ではありません。<br>飲み物：OK / 食事：NG<br>長時間の独占はお控えいただき、<br>周りの方へのご配慮をお願いいたします。</span></td>
                        </tr>
                        <tr>
                            <td>共通設備</td>
                            <td colspan="2">
                                <div style="display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; padding: 5px 0;">
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F4F6; Wi-Fi</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F50C; 全席電源</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x2615; ドリンクバー</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F5A8; 複合機</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F50B; 各種充電器</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F9E3; ブランケット</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F4A1; スタンドライト</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x270F; 文房具</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1FA91; 昇降デスク</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F9CA; 製氷機</span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; background: #F5F5F5; border: 1px solid #E0E0E0; border-radius: 20px; padding: 4px 10px; font-size: 0.85rem;">&#x1F4F9; 防犯カメラ</span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>ホームページ<br><span class="note">（勉強カフェ）</span></td>
                            <td><a href="https://learning-gym.com/shinjuku-s/" target="_blank" style="color: #1976D2; font-weight: bold;">learning-gym.com/shinjuku-s/</a></td>
                            <td><a href="https://learning-gym.com/bp-s/" target="_blank" style="color: #1976D2; font-weight: bold;">learning-gym.com/bp-s/</a></td>
                        </tr>
                        <tr>
                            <td>ホームページ<br><span class="note">（スタディGO）</span></td>
                            <td><a href="https://studygo.jp/store?shopId=3" target="_blank" style="color: #1976D2; font-weight: bold;">studygo.jp/store?shopId=3</a></td>
                            <td><a href="https://studygo.jp/store?shopId=2" target="_blank" style="color: #1976D2; font-weight: bold;">studygo.jp/store?shopId=2</a></td>
                        </tr>
                        <tr>
                            <td>見学予約経路</td>
                            <td colspan="2">
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; padding: 5px 0;">
                                    <div style="flex: 1; min-width: 120px; max-width: 160px; border: 2px solid #06C755; border-radius: 12px; padding: 10px 8px; text-align: center; background: #E8F5E9;">
                                        <div style="font-size: 1.5rem;">&#x1F4AC;</div>
                                        <strong style="color: #06C755; font-size: 0.95rem;">LINE</strong><br>
                                        <span class="note">Lステップ<br>自動応答で予約</span>
                                    </div>
                                    <div style="flex: 1; min-width: 120px; max-width: 160px; border: 2px solid #1565C0; border-radius: 12px; padding: 10px 8px; text-align: center; background: #E3F2FD;">
                                        <div><img src="benkyocafe-logo.webp" alt="勉強カフェ" style="height: 32px; object-fit: contain;"></div>
                                        <strong style="color: #1565C0; font-size: 0.95rem;">勉強カフェHP</strong><br>
                                        <span class="note">各スタジオの<br>HPから予約</span>
                                    </div>
                                    <div style="flex: 1; min-width: 120px; max-width: 160px; border: 2px solid #388E3C; border-radius: 12px; padding: 10px 8px; text-align: center; background: #E8F5E9;">
                                        <div><img src="studygo-logo.png" alt="スタディGO" style="height: 32px; object-fit: contain;"></div>
                                        <strong style="color: #388E3C; font-size: 0.95rem;">スタディGO</strong><br>
                                        <span class="note">アプリ内で<br>日時を選択</span>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>印刷機</td>
                            <td colspan="2" style="text-align: center;"><strong>あり</strong>（複合機）</td>
                        </tr>
                        <tr>
                            <td>防犯カメラ</td>
                            <td colspan="2" style="text-align: center;"><strong>あり</strong></td>
                        </tr>
                        <tr>
                            <td>混雑時間帯</td>
                            <td style="text-align: center;">
                                <strong>平日</strong><br>
                                18:00〜21:00（特に19:00前後）<br>
                                <strong>土日祝</strong><br>
                                13:00〜17:00
                            </td>
                            <td style="text-align: center;">
                                <strong>平日</strong><br>
                                18:00〜21:00（特に19:00前後）<br>
                                <strong>土日祝</strong><br>
                                13:00〜17:00
                            </td>
                        </tr>
                        <tr>
                            <td>緊急連絡先<br><span class="note">（無人時間帯）</span></td>
                            <td colspan="2" style="text-align: center;"><strong>050-3199-1446</strong><br><span class="note">※メール・Lステップでも可能です</span></td>
                        </tr>
                        <tr>
                            <td>こんな方におすすめ</td>
                            <td>駅近で通いやすさ重視<br>会議室を使いたい方</td>
                            <td>開放的な環境で作業したい<br>立って作業したい方</td>
                        </tr>
                    </tbody>
                </table>
                <p class="note" style="margin-top: 10px;">※混雑時は相互のスタジオへご案内する場合がございます。</p>
            </div>

            <div class="card" id="printer">
                <h3>印刷機（コピー機）</h3>
                <p>両スタジオに複合機を設置しています。</p>

                <h4>ご利用料金</h4>
                <table class="info-table" style="table-layout: fixed;">
                    <colgroup><col style="width: 45%;"><col style="width: 55%;"></colgroup>
                    <tr>
                        <th>白黒コピー</th>
                        <td><strong>1枚 10円</strong></td>
                    </tr>
                    <tr>
                        <th>白黒両面コピー</th>
                        <td><strong>1枚 10円</strong></td>
                    </tr>
                    <tr>
                        <th>カラーコピー</th>
                        <td><strong>1枚 40円</strong></td>
                    </tr>
                    <tr>
                        <th>カラー両面コピー</th>
                        <td><strong>1枚 40円</strong></td>
                    </tr>
                    <tr>
                        <th>FAX</th>
                        <td><strong>1枚 50円</strong></td>
                    </tr>
                    <tr>
                        <th>スキャン</th>
                        <td><strong>無料</strong></td>
                    </tr>
                </table>
                <div class="tips" style="margin-top: 10px;">
                    <p><strong>会員特典：</strong>白黒コピーは<strong>10枚まで無料</strong>です。</p>
                </div>

                <h4 style="margin-top: 20px;">お支払い方法</h4>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th style="width: 30%; background: #fff;"></th>
                            <th style="width: 35%; background: #E8F5E9; color: #2E7D32;">有人時間帯</th>
                            <th style="width: 35%; background: #FFEBEE; color: #C62828;">無人時間帯</th>
                        </tr>
                    </thead>
                    <tr>
                        <th>支払い方法</th>
                        <td style="background: #F1F8E9;">各種キャッシュレス決済<br><span class="note">※現金不可</span></td>
                        <td style="background: #FFF8F8;"><strong>PayPay</strong>のみ<br><span class="note">※受付のQRコードを読み取り</span></td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h3>防犯・防災について</h3>

                <h4>防犯</h4>
                <ul>
                    <li>無人営業時間がございますため、<strong>スタジオ内各所に防犯カメラを設置</strong>しております</li>
                </ul>

                <h4 style="margin-top: 15px; color: #C62828;">入退室について</h4>
                <ul>
                    <li>入退室を正確に管理するために、<strong>お一人ずつのご入室</strong>をお願いいたします。不正利用が発覚した場合、除名処分を行います。</li>
                    <li>自身のアプリで解錠し他の会員様や非会員様を入店・利用させることは<strong>禁止</strong>です。</li>
                </ul>

                <h4 style="margin-top: 15px;">避難経路</h4>
                <p>災害時に利用する非常口の場所を<strong>事前にご確認</strong>ください。</p>

                <h5 style="margin-top: 10px; color: #1565C0;">新宿スタジオ（南口）</h5>
                <p class="preparing-notice">避難経路図（画像準備中）</p>

                <h5 style="margin-top: 10px; color: #E65100;">新宿BPスタジオ（西口）</h5>
                <p class="preparing-notice">避難経路図（画像準備中）</p>

                <h4 style="margin-top: 15px;">避難場所</h4>
                <table class="info-table">
                    <thead>
                        <tr>
                            <th style="width: 30%;"></th>
                            <th style="width: 35%;">新宿スタジオ（南口）</th>
                            <th style="width: 35%;">新宿BPスタジオ（西口）</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>一時避難場所</th>
                            <td class="preparing-notice">（後日記入）</td>
                            <td class="preparing-notice">（後日記入）</td>
                        </tr>
                        <tr>
                            <th>広域避難場所</th>
                            <td class="preparing-notice">（後日記入）</td>
                            <td class="preparing-notice">（後日記入）</td>
                        </tr>
                        <tr>
                            <th>避難所</th>
                            <td class="preparing-notice">（後日記入）</td>
                            <td class="preparing-notice">（後日記入）</td>
                        </tr>
                    </tbody>
                </table>
                <p class="note">※災害発生時はスタッフの指示に従ってください。無人時間帯は各自で避難してください。</p>
            </div>

            <div class="card">
                <h3>緊急連絡先</h3>
                <div class="contact-info">
                    <p><strong>無人営業時間中の緊急連絡先</strong></p>
                    <p>電話：050-3199-1446</p>
                    <p class="note">※メッセージ・メールでも可能です</p>
                </div>
            </div>

            <!-- 区切り線：当日対応 / 別日対応 -->
            <div style="text-align: center; margin: 30px 0; position: relative;">
                <hr style="border: none; border-top: 3px solid #C62828; margin: 0;">
                <span style="background: #fff; padding: 0 15px; position: relative; top: -12px; color: #C62828; font-weight: bold; font-size: 1.1rem;">&#x25BC; 下記は別日に対応 &#x25BC;</span>
            </div>

            <!-- 転籍 -->
            <div class="card">
                <h3>転籍</h3>
                <p>クーポン機能の実装（3/10目途）に合わせて対応フローを整備予定です。</p>
                <div class="card critical" style="margin-top: 10px; box-shadow: none;">
                    <p><strong>それまでに転籍の対応が発生した場合は、國松まで連絡してください。</strong></p>
                </div>
            </div>

            <!-- 機器トラブル対応 -->
            <div class="card">
                <h3>給茶機トラブル対応</h3>
                <p>給茶機にエラーが表示された場合は、以下の対処を行ってください。</p>
                <table class="trouble-table">
                    <tr>
                        <th>エラー表示</th>
                        <th>原因</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>「水を補給してください」</td>
                        <td>水タンクの水切れ</td>
                        <td>水タンクに水を補充し、リセットボタンを押す</td>
                    </tr>
                    <tr>
                        <td>「茶葉を補給してください」</td>
                        <td>茶葉カートリッジの残量不足</td>
                        <td>新しい茶葉カートリッジに交換</td>
                    </tr>
                    <tr>
                        <td>「排水してください」</td>
                        <td>排水トレイが満杯</td>
                        <td>排水トレイの水を捨てて元に戻す</td>
                    </tr>
                    <tr>
                        <td>ランプ点滅（赤）</td>
                        <td>内部エラー</td>
                        <td>電源を切り、30秒後に再起動。改善しない場合は運営に連絡</td>
                    </tr>
                    <tr>
                        <td>お湯が出ない</td>
                        <td>加熱不良 / 水切れ</td>
                        <td>水タンクを確認。問題なければ電源リセット</td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h3>コーヒーサーバーメンテナンス</h3>
                <h4>日常メンテナンス（毎日）</h4>
                <ol>
                    <li>ドリップトレイの水を捨てて洗浄</li>
                    <li>抽出口周辺を湿った布で拭き取り</li>
                    <li>コーヒー豆の残量を確認（残り1/4以下なら補充）</li>
                    <li>水タンクの水量を確認・補充</li>
                </ol>
                <h4>定期メンテナンス（週1回）</h4>
                <ol>
                    <li>内部洗浄モードを実行（電源ボタン長押し3秒）</li>
                    <li>ミルク系メニューがある場合はミルクラインの洗浄</li>
                    <li>抽出ユニットを取り出して水洗い</li>
                </ol>
                <h4>エラー対処</h4>
                <table class="trouble-table">
                    <tr>
                        <th>症状</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>コーヒーが薄い</td>
                        <td>豆の残量確認、グラインダーの詰まりチェック</td>
                    </tr>
                    <tr>
                        <td>水漏れ</td>
                        <td>ドリップトレイの位置確認、パッキンのずれチェック。改善しなければ運営に連絡</td>
                    </tr>
                    <tr>
                        <td>動作しない</td>
                        <td>電源プラグの接続確認 → 電源リセット → 改善しなければ運営連絡</td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h3>機器エラーコード一覧</h3>
                <p>各機器のエラーコードと対処法をまとめています。</p>
                <table class="trouble-table">
                    <tr>
                        <th>機器</th>
                        <th>エラーコード / 症状</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>給茶機</td>
                        <td>E01 / E02</td>
                        <td>電源リセット。繰り返す場合はメーカーに連絡</td>
                    </tr>
                    <tr>
                        <td>コーヒーサーバー</td>
                        <td>赤ランプ点滅</td>
                        <td>抽出ユニットを確認・再セット。改善しなければ運営連絡</td>
                    </tr>
                    <tr>
                        <td>製氷機</td>
                        <td>氷ができない</td>
                        <td>給水バルブの開閉確認、フィルター清掃</td>
                    </tr>
                    <tr>
                        <td>コピー機</td>
                        <td>紙詰まり</td>
                        <td>表示に従い詰まった紙を除去。頻発する場合は保守連絡</td>
                    </tr>
                    <tr>
                        <td>Akerun</td>
                        <td>解錠しない</td>
                        <td>Bluetooth/通信状況確認 → アプリ再起動 → 手動鍵で対応</td>
                    </tr>
                </table>
            </div>

            <div class="card">
                <h3>その他機器トラブル</h3>
                <h4>空調</h4>
                <table class="trouble-table">
                    <tr>
                        <th>症状</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>エアコンが動かない</td>
                        <td>リモコンの電池確認 → ブレーカー確認 → 運営に連絡</td>
                    </tr>
                    <tr>
                        <td>冷暖房が効かない</td>
                        <td>フィルター清掃の確認、設定温度の見直し</td>
                    </tr>
                </table>

                <h4>Wi-Fi</h4>
                <table class="trouble-table">
                    <tr>
                        <th>症状</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>接続できない</td>
                        <td>ルーターの電源を抜いて30秒後に再接続</td>
                    </tr>
                    <tr>
                        <td>速度が遅い</td>
                        <td>接続端末数を確認。ルーター再起動で改善する場合あり</td>
                    </tr>
                </table>

                <h4>印刷機（コピー機）</h4>
                <table class="trouble-table">
                    <tr>
                        <th>症状</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>紙詰まり</td>
                        <td>画面の指示に従い紙を除去。前面・背面カバーを確認</td>
                    </tr>
                    <tr>
                        <td>トナー切れ</td>
                        <td>予備トナーに交換。在庫がなければ発注依頼</td>
                    </tr>
                    <tr>
                        <td>印刷できない</td>
                        <td>ネットワーク接続確認 → 電源リセット → 保守連絡</td>
                    </tr>
                </table>

                <h4>Akerun（スマートロック）</h4>
                <table class="trouble-table">
                    <tr>
                        <th>症状</th>
                        <th>対処法</th>
                    </tr>
                    <tr>
                        <td>アプリで解錠できない</td>
                        <td>Bluetooth ON確認 → アプリ再起動 → 手動鍵で対応</td>
                    </tr>
                    <tr>
                        <td>電池切れ警告</td>
                        <td>速やかに電池交換（CR123A）。予備電池は棚に保管</td>
                    </tr>
                </table>
            </div>
        </section>




        <!-- 勉強カフェ > 導入システムの違い -->
        <section id="cafe-systems" data-category="cafe">
            <h2>導入システムの違い</h2>
            <div class="card">
                <h3>各サービスの違い</h3>
                <p>勉強カフェでは、過去に複数のサービス・システムが運用されてきました。現在の運用との違いを把握しておきましょう。</p>
                <table class="info-table">
                    <tr>
                        <th>スタディGO</th>
                        <td><strong>現行システム</strong>。アプリでの入退室管理・契約・決済を一元化</td>
                    </tr>
                    <tr>
                        <th>BPアプリ</th>
                        <td>旧システム。スタディGO導入前に使用。</td>
                    </tr>
                </table>
                <h4 style="margin-top:15px;">廃止されたサービス</h4>
                <ul>
                    <li>即日アップグレード → <strong>廃止</strong></li>
                    <li>新宿エリアパス → <strong>廃止</strong></li>
                </ul>
            </div>
            <div class="card">
                <h3>BPアプリとは</h3>
                <p>スタディGO導入以前に勉強カフェで使用していた旧システムです。</p>
                <ul>
                    <li>BPアプリ自体には<strong>決済機能はありません</strong></li>
                    <li>お客様の<strong>プランや利用状況の管理</strong>を行うアプリです</li>
                    <li>受付の<strong>専用機器で打刻</strong>（チェックイン/チェックアウト）ができます</li>
                    <li>当月までであれば、<strong>打刻の修正が可能</strong>であることが大きな特徴です</li>
                </ul>
            </div>

            <div class="card important">
                <h3>会員種別ルール比較表</h3>
                <p style="text-align:center; margin-bottom:15px;">既存会員（BPアプリ）とスタディGO会員の運用ルールの違いを一覧で確認できます。</p>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>既存会員（BPアプリ）</th>
                            <th>スタディGO会員</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>チェックイン方法</td>
                            <td>BPアプリでQR読取</td>
                            <td>スタディGOアプリでQR読取</td>
                        </tr>
                        <tr>
                            <td>打刻修正</td>
                            <td>スタッフが管理画面で修正<br><span class="note">（当月中のみ対応可能）</span></td>
                            <td><strong>基本不可</strong></td>
                        </tr>
                        <tr>
                            <td>延長料金</td>
                            <td>会費ペイで後日請求</td>
                            <td>自動精算（1分13円）</td>
                        </tr>
                        <tr>
                            <td>支払い方法</td>
                            <td>口座振替 / クレカ</td>
                            <td>クレジットカードのみ</td>
                        </tr>
                        <tr>
                            <td>解約手続き</td>
                            <td>店頭でGoogleフォームにて申請<br><span class="note">（締日：毎月10日まで）</span></td>
                            <td>アプリ上で手続き<br><span class="note">（締日：毎月10日まで）</span></td>
                        </tr>
                        <tr>
                            <td>時間利用（ドロップイン）</td>
                            <td>打刻のみ<br><span class="note">（他の手続き不要）</span></td>
                            <td>スタディGOアプリで受付</td>
                        </tr>
                        <tr>
                            <td>ロッカー管理</td>
                            <td>店頭でGoogleフォームにて申請</td>
                            <td>アプリ上で契約/解約</td>
                        </tr>
                        <tr>
                            <td>見学予約</td>
                            <td>HP / 電話</td>
                            <td>HP / 電話 / スタディGOアプリ</td>
                        </tr>
                    </tbody>
                </table>
                <div class="tips">
                    <p><strong>ポイント：</strong>スタディGO会員はアプリ完結型。支払いはクレカのみ、解約は締日に注意が必要です。</p>
                </div>
            </div>

            <div class="card">
                <h3>打刻について（BPアプリ）</h3>
                <ul>
                    <li>受付の<strong>専用機器</strong>でチェックイン/チェックアウトの打刻ができます</li>
                    <li><strong>当月中</strong>であれば、打刻の修正が可能です</li>
                    <li>打刻エラーがあった際はメールや店頭にて修正の申請をお願いします</li>
                </ul>
                <div class="tips">
                    <p><strong>BPアプリの特徴：</strong>決済機能は持たず、お客様のプランや利用状況の管理を行うアプリです。延長料金等は会費ペイで後日請求となります。</p>
                </div>
            </div>
        </section>






        <!-- 3/1～変更点まとめ > スタディGO変更点 -->
        <section id="bp-to-studygo" data-category="change" data-modified>
            <h2>スタディGO変更点</h2>

            <div class="card" style="border-left: 5px solid #1976D2;">
                <h3>何が変わった？</h3>
                <p><strong>「アプリ完結型」</strong>に変わりました。契約・決済・入退室がすべてスタディGOアプリに統合されています。</p>

                <div style="background: #F5F5F5; border-radius: 8px; padding: 12px 16px; margin: 10px 0 15px;">
                    <p style="font-weight: bold; margin: 0 0 8px; font-size: 0.95rem;">変更内容まとめ</p>
                    <ul style="margin: 0; padding-left: 18px; font-size: 0.9rem; line-height: 1.8;">
                        <li><b>入会手続き</b> ─ アプリで一括登録（所要時間が約半分に）</li>
                        <li><b>チェックイン</b> ─ 専用機器 → アプリでQRコード読み取りに変更</li>
                        <li><b>入退室</b> ─ Akerun → スタディGOアプリで解錠</li>
                        <li><b>超過料金</b> ─ 後日請求 → 即日自動決済（1分13円）</li>
                        <li><b>時間外利用</b> ─ 有人時間帯のみ利用可（770円/h・即日決済）</li>
                        <li><b>ドロップイン</b> ─ アプリで受付・決済（未登録者は受付不可）</li>
                        <li><b>短期パス</b> ─ どちらでも店頭決済（変更なし）</li>
                        <li><b>プラン変更・休会</b> ─ 月1回・10日ルール厳守・申請取り消し不可</li>
                        <li><b>支払い方法</b> ─ クレカのみ（口座振替は廃止）</li>
                        <li><b>会員情報・支払い情報変更</b> ─ アプリで直接変更可能に</li>
                        <li><b>領収書</b> ─ スタッフ手書き → 電子領収書がメールで自動送付（スタッフ対応不要）</li>
                        <li><b>休会</b> ─ アプリで申請するだけ（店頭来店不要・スタッフ手続きなし）</li>
                        <li><b>連絡方法</b> ─ Lステップ継続（見学予約・店外契約時はアプリメッセージも使用）</li>
                        <li><b>廃止</b> ─ 時間制プラン / 新宿エリアパス / 即日アップグレード / 会員様の時間外利用割引（550円）</li>
                    </ul>
                </div>

                <p style="font-size: 0.95rem; color: #333; margin-bottom: 8px; font-weight: bold;"><span style="color: #C62828; font-size: 1.1rem;">&#9632;</span> 赤字 = 特に注意すべき変更点　<span style="color: #0288D1; font-size: 1.1rem;">&#9632;</span> 水色背景 = アプリで完結（スタッフ対応不要）</p>
                <table class="comparison-table" style="table-layout: fixed; width: 100%; margin-top: 10px;">
                    <colgroup>
                        <col style="width: 20%;">
                        <col style="width: 40%;">
                        <col style="width: 40%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th style="background: #EFEBE9; color: #5D4037;">旧）BPアプリ</th>
                            <th style="background: #E3F2FD; color: #1565C0;">新）スタディGO</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ▼ 入会・契約 -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">入会・契約</td></tr>
                        <tr>
                            <td><strong>入会手続き</strong></td>
                            <td>会費ペイ＋BPアプリ＋Akerun＋LINE登録<br><span style="font-size: 0.8rem; color: #888;">所要時間：約30〜40分</span></td>
                            <td style="background: #E1F5FE;">アプリで一括登録（+Lステップ）<br><span style="font-size: 0.8rem; color: #888;">メール認証→個人情報→カード登録→プラン契約<br>所要時間：約15〜20分</span></td>
                        </tr>
                        <tr>
                            <td><strong>会員番号</strong></td>
                            <td>BCS〜 / BCBP〜</td>
                            <td>BCS〜<strong>G</strong> / BCBP〜<strong>G</strong><br><span style="font-size: 0.8rem; color: #888;">末尾にGを付加して区別</span></td>
                        </tr>
                        <tr>
                            <td><strong>支払い方法</strong></td>
                            <td>口座振替 / クレカ</td>
                            <td style="color: #C62828; font-weight: bold;">クレカのみ</td>
                        </tr>
                        <tr>
                            <td><strong>決済システム</strong></td>
                            <td>別サービス：会費ペイ</td>
                            <td style="background: #E1F5FE;">アプリ内で一元管理</td>
                        </tr>
                        <!-- ▼ 打刻・入退室 -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">打刻・入退室</td></tr>
                        <tr>
                            <td><strong>チェックイン</strong></td>
                            <td>受付の専用機器にQRコードをかざす</td>
                            <td>アプリでQRコードを読み取り</td>
                        </tr>
                        <tr>
                            <td><strong>QRコード設置場所</strong></td>
                            <td>受付</td>
                            <td>入口の扉 ＋ 受付（初回ドロップイン用）</td>
                        </tr>
                        <tr>
                            <td><strong>打刻修正</strong></td>
                            <td>スタッフが管理画面から修正可能</td>
                            <td style="color: #C62828;">チェックイン時刻：チェックアウト前まで修正可<br>チェックアウト忘れ：アプリで店舗コード入力<br><a href="#trouble-checkin" class="section-link" data-link-section="bp-to-studygo" data-link-h3="チェックイン・チェックアウトのトラブル対応" style="font-size: 0.85rem; color: #1565C0; text-decoration: underline; cursor: pointer; display: inline-block; margin-top: 4px;">→ ⑤ チェックイン・チェックアウトのトラブル対応を参照</a></td>
                        </tr>
                        <tr>
                            <td><strong>入退室（解錠）</strong></td>
                            <td>Akerunアプリ or ICカード</td>
                            <td style="background: #E1F5FE;">スタディGOアプリで解錠</td>
                        </tr>
                        <!-- ▼ 料金・時間外 -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">料金・時間外</td></tr>
                        <tr>
                            <td><strong>超過料金</strong></td>
                            <td>会費ペイで後日請求（翌月末）</td>
                            <td style="background: #E1F5FE; color: #C62828; font-weight: bold;">自動精算・即日決済（1分13円）</td>
                        </tr>
                        <tr>
                            <td><strong>時間外利用</strong></td>
                            <td>打刻のみで営業時間すべて利用可能</td>
                            <td style="color: #C62828; font-weight: bold;">有人時間帯のみ利用可能（770円/h）<br><span style="font-size: 0.8rem;">※即日決済</span></td>
                        </tr>
                        <tr>
                            <td><strong>ドロップイン</strong></td>
                            <td>現地決済のみ</td>
                            <td>アプリで受付・決済<br><span style="font-size: 0.8rem; color: #888;">770円/h、1Day最大 3,300円<br>スタディGO未登録者は受付不可</span></td>
                        </tr>
                        <tr>
                            <td><strong>短期パス</strong></td>
                            <td colspan="2" style="text-align: center;">店頭決済</td>
                        </tr>
                        <tr>
                            <td><strong>料金確認</strong></td>
                            <td>スタッフに確認</td>
                            <td style="background: #E1F5FE;">アプリ内で確認可能<br><span style="font-size: 0.8rem; color: #888;">・新規契約・時間外利用：即時<br>・サブスク更新：毎月15日</span></td>
                        </tr>
                        <tr>
                            <td><strong>領収書</strong></td>
                            <td>スタッフに依頼<br><span style="font-size: 0.8rem; color: #888;">手書きで発行</span></td>
                            <td style="background: #E1F5FE;">決済ごとに電子領収書がメールで届く<br><span style="font-size: 0.8rem; color: #888;">月の利用金額は翌月1日にまとめて発行可能</span></td>
                        </tr>
                        <!-- ▼ 各種変更・解約 -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">各種変更・解約</td></tr>
                        <tr>
                            <td><strong>会員情報変更</strong></td>
                            <td rowspan="2">アプリで変更URLを申請<br><span style="font-size: 0.8rem; color: #888;">URL到着までラグあり</span></td>
                            <td rowspan="2" style="background: #E1F5FE;">アプリで直接変更可能</td>
                        </tr>
                        <tr>
                            <td><strong>支払い情報変更</strong></td>
                        </tr>
                        <tr>
                            <td><strong>プラン変更</strong></td>
                            <td>アプリで申請<br><span style="font-size: 0.8rem; color: #888;">基本取り消し不可</span></td>
                            <td style="color: #C62828; font-weight: bold;">アプリで申請（10日ルール厳守）<br><span style="font-size: 0.8rem;">※毎月10日までに申請・月1回・取り消し不可</span></td>
                        </tr>
                        <tr>
                            <td><strong>プラン解約（退会）</strong></td>
                            <td>店頭でGoogleフォーム</td>
                            <td style="color: #C62828;">店頭でGoogleフォーム回答<br><span style="font-size: 0.8rem;">※10日21時までにスタッフが管理画面で処理しないと自動請求で翌月継続</span></td>
                        </tr>
                        <tr>
                            <td><strong>休会</strong></td>
                            <td>店頭でGoogleフォーム</td>
                            <td style="background: #E1F5FE;">アプリで10日までに申請<br><span style="font-size: 0.8rem; color: #888;">店頭来店不要・スタッフ手続きなし</span></td>
                        </tr>
                        <!-- ▼ オプション -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">オプション</td></tr>
                        <tr>
                            <td><strong>ロッカー契約</strong></td>
                            <td>Googleフォーム＋会費ペイ事後決済</td>
                            <td>アプリで契約（日割）・即時決済<br><span style="font-size: 0.8rem; color: #C62828;">※契約・解約はアプリで可能だが、契約時はロッカーの場所決めのため店頭来店が必要</span></td>
                        </tr>
                        <tr>
                            <td><strong>ロッカー解約</strong></td>
                            <td>店頭でGoogleフォーム</td>
                            <td style="background: #E1F5FE;">アプリで解約</td>
                        </tr>
                        <tr>
                            <td><strong>ロッカー管理</strong></td>
                            <td colspan="2" style="text-align: center;">スプレッドシートで管理</td>
                        </tr>
                        <!-- ▼ 連絡・管理 -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">連絡・管理</td></tr>
                        <tr>
                            <td><strong>連絡方法</strong></td>
                            <td colspan="2" style="text-align: center;">Lステップ（LINE）<br><span style="font-size: 0.8rem; color: #888;">※スタディGOで見学予約・店外での契約時はアプリメッセージも使用</span></td>
                        </tr>
                        <tr>
                            <td><strong>チェックイン中の<br>会員確認</strong></td>
                            <td colspan="2" style="text-align: center;">管理画面から確認</td>
                        </tr>
                        <!-- ▼ 廃止・新設 -->
                        <tr><td colspan="3" style="background: #455A64; font-weight: bold; color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-bottom: 2px solid #263238;">廃止・新設</td></tr>
                        <tr>
                            <td><strong>時間制プラン</strong></td>
                            <td>あり</td>
                            <td style="color: #C62828; font-weight: bold;">廃止</td>
                        </tr>
                        <tr>
                            <td><strong>新宿エリアパス</strong></td>
                            <td>あり</td>
                            <td style="color: #C62828; font-weight: bold;">廃止</td>
                        </tr>
                        <tr>
                            <td><strong>即日アップグレード</strong></td>
                            <td>あり</td>
                            <td style="color: #C62828; font-weight: bold;">廃止</td>
                        </tr>
                        <tr>
                            <td><strong>時間外利用割引<br><span style="font-size: 0.8rem; font-weight: normal;">（会員様550円/h）</span></strong></td>
                            <td>あり</td>
                            <td style="color: #C62828; font-weight: bold;">廃止（770円/h統一）</td>
                        </tr>
                        <tr>
                            <td><strong>習慣化プラン</strong></td>
                            <td>なし</td>
                            <td style="color: #1565C0; font-weight: bold;">スタディGOのみ実施</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card" style="border-left: 5px solid #43A047;">
                <h3>入会フローの違い</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px; background: #EFEBE9; border-radius: 8px; padding: 12px;">
                        <h4 style="color: #5D4037; margin: 0 0 8px;">旧）BPアプリ入会フロー</h4>
                        <ol style="margin: 0; padding-left: 20px; font-size: 0.88rem; line-height: 1.7;">
                            <li>Lステップ・HP予約 or 飛び込み来店</li>
                            <li>勉強カフェ案内表でご案内</li>
                            <li>スタジオ案内（施設見学）</li>
                            <li>トライアル（お試し利用 30〜60分）</li>
                            <li>ご利用ルールの説明</li>
                            <li style="color: #C62828; background: #FFCDD2; padding: 4px 8px; border-radius: 4px; font-weight: bold;">ご契約 → <strong>会費ペイ QR・Akerun・BPアプリ登録</strong></li>
                            <li><strong>公式LINE</strong>への登録、身分証コピー</li>
                            <li>マイゴールシートの記入</li>
                            <li style="color: #C62828; background: #FFCDD2; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Akerun・BPアプリご利用説明</li>
                        </ol>
                        <p style="color: #5D4037; font-weight: bold; margin: 8px 0 0; font-size: 0.85rem;">所要時間：約30〜40分</p>
                    </div>
                    <div style="flex: 1; min-width: 250px; background: #E3F2FD; border-radius: 8px; padding: 12px;">
                        <h4 style="color: #1565C0; margin: 0 0 8px;">新）スタディGO入会フロー</h4>
                        <ol style="margin: 0; padding-left: 20px; font-size: 0.88rem; line-height: 1.7;">
                            <li>Lステップ・HP・<span style="color: #C62828; font-weight: bold;">スタディGO予約</span> or 飛び込み来店</li>
                            <li>勉強カフェ案内表でご案内</li>
                            <li>スタジオ案内（施設見学）</li>
                            <li>トライアル（お試し利用 30〜60分）</li>
                            <li>ご利用ルールの説明</li>
                            <li style="color: #1565C0; background: #BBDEFB; padding: 4px 8px; border-radius: 4px; font-weight: bold;">ご契約 → <strong>スタディGO登録・プラン契約</strong></li>
                            <li><strong>公式LINE</strong>への登録、身分証コピー</li>
                            <li>マイゴールシートの記入</li>
                            <li style="color: #1565C0; background: #BBDEFB; padding: 4px 8px; border-radius: 4px; font-weight: bold;">スタディGOご利用説明</li>
                        </ol>
                        <p style="color: #1565C0; font-weight: bold; margin: 8px 0 0; font-size: 0.85rem;">所要時間：約15〜20分</p>
                    </div>
                </div>
                <div class="info" style="margin-top: 10px;">
                    <p>スタディGOではアプリで一括登録するため、<strong>スタッフのオペレーションが約30%に軽減</strong>されます。</p>
                </div>
            </div>

            <div class="card" style="border-left: 5px solid #FF6F00;">
                <h3>スタッフが特に注意すべきポイント</h3>
                <div style="background: #FFF8E1; border: 1px solid #FFD54F; border-radius: 8px; padding: 10px 15px; margin-bottom: 15px; font-size: 0.9rem;">
                    <p style="margin: 0 0 6px; font-weight: bold; color: #E65100;">注意レベルについて</p>
                    <p style="margin: 0; line-height: 1.7;">各項目の重要度を★の数で表しています。★が多いほど注意が必要です。<br>
                    <span style="color: #B71C1C; font-weight: bold;">★★★★★</span> 最重要（必ず説明・対応が必要）
                    <span style="color: #D84315; font-weight: bold;">★★★★☆</span> 重要
                    <span style="color: #E65100; font-weight: bold;">★★☆☆☆</span> 確認事項</p>
                </div>
                <table class="info-table">
                    <tr>
                        <th style="background: #B71C1C; width: 25%; color: #FFFFFF;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★★★★</span>
                            時間外料金は即日決済
                        </th>
                        <td>BPアプリは翌月末請求だったが、スタディGOは<strong>即日自動課金</strong>。新規会員には必ず説明すること。<br><strong>アプリの不具合でない限り、チェックイン・チェックアウトはお客様の責任となり、返金は行わない。</strong></td>
                    </tr>
                    <tr>
                        <th style="background: #B71C1C; color: #FFFFFF;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★★★★</span>
                            プラン変更・休会は月1回・取り消し不可
                        </th>
                        <td>10日ルール自体はBPアプリと同じ。ただし、スタディGOでは<strong>申請後の取り消しができない</strong>。さらに<strong>プラン変更・休会は月に1度しかできない</strong>ため、申請前にお客様へ十分に確認すること。入会時のプラン選択時にも必ず説明する。</td>
                    </tr>
                    <tr>
                        <th style="background: #B71C1C; color: #FFFFFF;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★★★★</span>
                            入会時のプラン説明
                        </th>
                        <td>入会時のプラン選択はやり直しがきかないため、以下を<strong>必ず説明</strong>すること。
                            <ul style="margin: 8px 0 0 15px; font-size: 0.9rem;">
                                <li>プラン時間帯の<strong>前</strong>の無人営業時間は利用できない（延長は可能だが、時間前の利用は不可）</li>
                                <li>プラン時間外に利用したい場合は、<strong>有人時間帯にドロップインプランを購入</strong>すれば利用可能</li>
                                <li style="color: #C62828; font-weight: bold;">プラン時間終了後 ＋ 有人時間も終了 → 利用不可（ドロップインは有人時間帯のみ）</li>
                                <li style="color: #C62828; font-weight: bold;">入会後のプラン選びなおしは翌月扱い → 最初のプラン選択が非常に重要</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <th style="background: #B71C1C; color: #FFFFFF;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★★★★</span>
                            即日入会時の設定変更
                        </th>
                        <td>
                            <div style="background: #B71C1C; color: #FFFFFF; padding: 8px 12px; border-radius: 6px; margin-bottom: 10px; font-size: 0.9rem;">
                                <strong>最重要オペレーション：</strong>見学当日にそのまま入会するケースはほぼ毎回発生。設定の戻し忘れは<strong>全ての新規契約者に影響</strong>する。
                            </div>
                            <p style="font-size: 0.9rem;">管理画面「店舗管理」→「最短利用開始日」を <strong>0日</strong> に変更 → 契約完了後 <strong style="color: #C62828;">必ず1日に戻す</strong></p>
                            <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="即日入会の手順" style="color: #1565C0; font-size: 0.85rem;">→ 即日入会の手順（詳細）を参照</a></p>
                        </td>
                    </tr>
                    <tr>
                        <th style="background: #D84315; color: #FFFFFF;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★★★☆</span>
                            チェックアウト忘れに注意
                        </th>
                        <td>QRコードを読み込んでチェックインした後に、アプリ上で施設の扉を解錠できる仕組みです。つまり<strong>チェックインしないと入室できない</strong>ため、チェックイン忘れはほぼ発生しません。<br><br>
                            <strong style="color: #C62828;">最も注意が必要なのはチェックアウト忘れです。</strong>チェックアウトしないまま退店すると、★★★★★の「時間外料金は即日決済」に該当し、<strong>営業終了時間まで課金が継続</strong>してしまいます。お客様に余計な料金が発生するため、<strong>退店時のチェックアウトは必ず行うよう案内</strong>してください。<br>
                            <span style="font-size: 0.85rem; color: #666;">チェックアウト忘れ時の対応：アプリ →「QR読取」→「QRが読み取れない場合」→ 店舗コード入力</span></td>
                    </tr>
                    <tr>
                        <th style="background: #FFF3E0; color: #E65100;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★☆☆☆</span>
                            Akerun対応不要
                        </th>
                        <td>入館はスタディGOアプリで解錠。<strong>Akerunについてスタッフの対応は不要</strong>です。</td>
                    </tr>
                    <tr>
                        <th style="background: #FFF3E0; color: #E65100;">
                            <span style="display: block; font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 4px;">★★☆☆☆</span>
                            ドロップインの変更
                        </th>
                        <td>スタディGO未登録者のドロップインは<strong>受付不可</strong>。店頭でスタディGOでの利用をご案内すること。有人営業時間のみ対応。</td>
                    </tr>
                </table>
            </div>

            <div class="card" style="border-left: 5px solid #1565C0;">
                <h3>月額プラン会員の利用パターン</h3>
                <p>月額会員の来店時は<strong>プラン時間内</strong>（追加なし）、<strong>時間超過</strong>（1分13円自動精算）、<strong>時間外利用</strong>（ドロップインとして770円/時間）の3パターンがあります。</p>
                <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="チェックイン・チェックアウト" style="color: #1565C0;">→ 詳細は「チェックイン・チェックアウト」セクションを参照</a></p>
            </div>

            <div class="card" style="border-left: 5px solid #E65100;">
                <h3 id="trouble-checkin">チェックイン・チェックアウトのトラブル対応</h3>
                <p><strong>チェックイン忘れ</strong>：管理画面「チェックイン実績」で時刻修正 ／ <strong>チェックアウト忘れ</strong>：アプリで店舗コード入力 ／ <strong>誤チェックアウト</strong>：再度QR読取でチェックイン</p>
                <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="チェックイン・チェックアウト" style="color: #1565C0;">→ 詳細は「チェックイン・チェックアウト」セクションを参照</a></p>
            </div>

            <div class="card" style="border-left: 5px solid #7B1FA2;">
                <h3>オプション（ロッカー）の注意事項</h3>
                <h4 style="color: #2E7D32; margin-top: 10px;">契約時の注意</h4>
                <ul style="margin: 5px 0 10px 15px; font-size: 0.9rem;">
                    <li>ロッカーは<strong>店頭での手続きが必要</strong>（スタッフ有人時間帯にご来店）</li>
                    <li>実際に利用できるのは、店頭で場所が決まったとき</li>
                    <li>鍵の紛失・破損時は再発行手数料 <strong>3,300円</strong></li>
                </ul>
                <h4 style="color: #C62828;">解約時の注意</h4>
                <ul style="margin: 5px 0 10px 15px; font-size: 0.9rem;">
                    <li>解約はアプリで申請（<strong>店頭来店不要</strong>）</li>
                    <li>解約日までにロッカー内の荷物をすべて持ち帰ること（残置物がある場合は翌月分請求の可能性あり）</li>
                    <li>鍵は受付に返却。紛失の場合は再発行手数料 <strong>3,300円</strong></li>
                </ul>
            </div>

            <div class="card" style="border-left: 5px solid #E0E0E0; background: #FAFAFA; opacity: 0.7; font-size: 0.85rem;">
                <h3 style="color: #9E9E9E; border-left-color: #E0E0E0;">今後対応予定</h3>
                <ul style="color: #9E9E9E;">
                    <li>避難情報（避難経路図・一時避難場所・広域避難場所・避難所）</li>
                    <li>転籍セクション（クーポン機能実装後に整備 3/10目途）</li>
                    <li>ロープレ動画</li>
                    <li>管理画面ログインパスワードの管理方法の見直し</li>
                </ul>
            </div>

        </section>


        <section id="overview" class="accordion-section" data-category="studygo" data-modified>
            <h2 class="section-header">スタディGOの特徴とDL</h2>
            <div class="section-content">
            <div class="card">
                <h3>スタディGO機能一覧</h3>
                <div class="app-feature-grid">
                    <!-- 月額申し込み（薄い茶色） -->
                    <div class="app-feature-item feat-monthly">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="6" y="4" width="32" height="36" rx="3" fill="#8D6E63" opacity="0.2"/>
                                <rect x="6" y="4" width="32" height="10" rx="3" fill="#8D6E63"/>
                                <text x="22" y="12" text-anchor="middle" font-size="7" fill="white" font-weight="bold">月額</text>
                                <line x1="12" y1="20" x2="32" y2="20" stroke="#8D6E63" stroke-width="1.5"/>
                                <line x1="12" y1="25" x2="32" y2="25" stroke="#8D6E63" stroke-width="1.5"/>
                                <line x1="12" y1="30" x2="25" y2="30" stroke="#8D6E63" stroke-width="1.5"/>
                                <circle cx="30" cy="34" r="6" fill="#8D6E63"/>
                                <text x="30" y="37" text-anchor="middle" font-size="8" fill="white" font-weight="bold">&#10003;</text>
                            </svg>
                        </div>
                        <span class="app-feature-label">月額申し込み</span>
                    </div>
                    <!-- 時間利用・ドロップイン（水色） -->
                    <div class="app-feature-item feat-dropin">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="22" cy="22" r="17" fill="#E3F2FD" stroke="#1E96D1" stroke-width="2"/>
                                <line x1="22" y1="10" x2="22" y2="22" stroke="#1E96D1" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="22" y1="22" x2="30" y2="28" stroke="#1E96D1" stroke-width="2" stroke-linecap="round"/>
                                <circle cx="22" cy="22" r="2" fill="#1E96D1"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">時間利用<br>（ドロップイン）</span>
                    </div>
                    <!-- 見学予約（薄い緑色） -->
                    <div class="app-feature-item feat-tour">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="6" y="6" width="32" height="32" rx="4" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
                                <rect x="6" y="6" width="32" height="10" rx="4" fill="#4CAF50"/>
                                <rect x="14" y="2" width="3" height="8" rx="1.5" fill="#388E3C"/>
                                <rect x="27" y="2" width="3" height="8" rx="1.5" fill="#388E3C"/>
                                <text x="22" y="13" text-anchor="middle" font-size="6" fill="white" font-weight="bold">予約</text>
                                <circle cx="16" cy="25" r="3" fill="#4CAF50" opacity="0.3"/>
                                <circle cx="28" cy="25" r="3" fill="#4CAF50"/>
                                <text x="28" y="28" text-anchor="middle" font-size="6" fill="white" font-weight="bold">&#10003;</text>
                                <circle cx="22" cy="33" r="3" fill="#4CAF50" opacity="0.3"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">見学予約</span>
                    </div>
                    <!-- チェックイン・チェックアウト（スマホカメラ＋QR） -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <!-- スマホ本体 -->
                                <rect x="2" y="2" width="22" height="40" rx="3" fill="#333"/>
                                <rect x="4" y="6" width="18" height="30" rx="1" fill="#E3F2FD"/>
                                <!-- カメラレンズ（上部） -->
                                <circle cx="13" cy="4" r="1.2" fill="#555"/>
                                <!-- 画面内にQRをスキャン中の表現 -->
                                <rect x="7" y="12" width="12" height="12" rx="1" stroke="#1976D2" stroke-width="1" fill="none" stroke-dasharray="2,1"/>
                                <rect x="9" y="14" width="3" height="3" fill="#1976D2"/>
                                <rect x="13" y="14" width="2" height="2" fill="#1976D2"/>
                                <rect x="9" y="18" width="2" height="2" fill="#1976D2"/>
                                <rect x="12" y="18" width="3" height="3" fill="#1976D2"/>
                                <!-- QRコード（右側） -->
                                <rect x="28" y="10" width="14" height="14" rx="2" fill="white" stroke="#333" stroke-width="1.5"/>
                                <rect x="30" y="12" width="4" height="4" fill="#333"/>
                                <rect x="36" y="12" width="4" height="4" fill="#333"/>
                                <rect x="30" y="18" width="4" height="4" fill="#333"/>
                                <rect x="36" y="18" width="2" height="2" fill="#333"/>
                                <rect x="38" y="20" width="2" height="2" fill="#333"/>
                                <!-- スキャン線 -->
                                <line x1="28" y1="17" x2="42" y2="17" stroke="#f44336" stroke-width="1" stroke-dasharray="2,1"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">チェックイン・チェックアウト</span>
                    </div>
                    <!-- 5. クレジットカードの登録と決済 -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="3" y="10" width="38" height="24" rx="3" fill="#FFA726"/>
                                <rect x="3" y="17" width="38" height="5" fill="#E65100"/>
                                <rect x="7" y="26" width="12" height="3" rx="1" fill="#FFE0B2"/>
                                <rect x="7" y="30" width="8" height="2" rx="1" fill="#FFE0B2"/>
                                <circle cx="35" cy="29" r="3.5" fill="#FFE0B2" opacity="0.7"/>
                                <circle cx="31" cy="29" r="3.5" fill="#FFE0B2" opacity="0.5"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">クレジットカード<br>登録と決済</span>
                    </div>
                    <!-- 6. Akerun解錠 -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="20" y="4" width="20" height="36" rx="2" fill="#EFEBE9" stroke="#8D6E63" stroke-width="1.5"/>
                                <circle cx="35" cy="22" r="2" fill="#8D6E63"/>
                                <rect x="4" y="16" width="14" height="16" rx="2" fill="#4CAF50"/>
                                <path d="M11 12 L11 16" stroke="#4CAF50" stroke-width="3" stroke-linecap="round"/>
                                <path d="M11 12 Q11 8 15 8" stroke="#4CAF50" stroke-width="3" stroke-linecap="round" fill="none"/>
                                <circle cx="11" cy="23" r="2.5" fill="white"/>
                                <rect x="10" y="24" width="2" height="4" rx="1" fill="white"/>
                                <path d="M17 18 L20 20" stroke="#4CAF50" stroke-width="1.5"/>
                                <path d="M17 22 L20 22" stroke="#4CAF50" stroke-width="1.5"/>
                                <path d="M17 26 L20 24" stroke="#4CAF50" stroke-width="1.5"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">Akerun解錠</span>
                    </div>
                    <!-- 7. 勉強記録・利用明細の確認 -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="6" y="4" width="32" height="36" rx="3" fill="#E8F5E9" stroke="#4CAF50" stroke-width="1.5"/>
                                <line x1="12" y1="12" x2="32" y2="12" stroke="#4CAF50" stroke-width="1.5"/>
                                <line x1="12" y1="18" x2="28" y2="18" stroke="#4CAF50" stroke-width="1.5"/>
                                <line x1="12" y1="24" x2="30" y2="24" stroke="#4CAF50" stroke-width="1.5"/>
                                <line x1="12" y1="30" x2="24" y2="30" stroke="#4CAF50" stroke-width="1.5"/>
                                <circle cx="32" cy="32" r="7" fill="#4CAF50"/>
                                <polyline points="28,32 31,35 36,29" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">勉強記録<br>利用明細の確認</span>
                    </div>
                    <!-- 8. メッセージ -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="4" y="8" width="36" height="24" rx="4" fill="#42A5F5"/>
                                <polygon points="12,32 20,32 14,38" fill="#42A5F5"/>
                                <line x1="12" y1="16" x2="32" y2="16" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                <line x1="12" y1="22" x2="28" y2="22" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                <line x1="12" y1="28" x2="22" y2="28" stroke="white" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">メッセージ</span>
                    </div>
                    <!-- 9. 情報変更 -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 6 L24.5 8.2 L28 7.5 L28.8 11 L32 12.5 L31 16 L33.5 18.5 L31.5 21.5 L33 24.5 L30 26 L30 29.5 L27 29.5 L25 32.5 L22 31 L19 32.5 L17 29.5 L14 29.5 L14 26 L11 24.5 L12.5 21.5 L10.5 18.5 L13 16 L12 12.5 L15.2 11 L16 7.5 L19.5 8.2 Z" fill="#757575"/>
                                <circle cx="22" cy="19" r="7" fill="white"/>
                                <circle cx="22" cy="19" r="4.5" fill="#757575"/>
                                <rect x="10" y="34" width="24" height="3" rx="1.5" fill="#BDBDBD"/>
                                <circle cx="18" cy="35.5" r="3" fill="#757575" stroke="white" stroke-width="1"/>
                                <rect x="10" y="39" width="24" height="3" rx="1.5" fill="#BDBDBD"/>
                                <circle cx="28" cy="40.5" r="3" fill="#757575" stroke="white" stroke-width="1"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">支払い情報<br>会員情報の変更</span>
                    </div>
                    <!-- 10. 検索 -->
                    <div class="app-feature-item">
                        <div class="app-feature-icon">
                            <svg viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg">
                                <rect x="2" y="10" width="12" height="22" rx="1" fill="#78909C"/>
                                <rect x="4" y="13" width="3" height="3" rx="0.5" fill="#B0BEC5"/>
                                <rect x="10" y="13" width="3" height="3" rx="0.5" fill="#B0BEC5"/>
                                <rect x="4" y="19" width="3" height="3" rx="0.5" fill="#B0BEC5"/>
                                <rect x="10" y="19" width="3" height="3" rx="0.5" fill="#B0BEC5"/>
                                <rect x="4" y="25" width="3" height="3" rx="0.5" fill="#B0BEC5"/>
                                <rect x="10" y="25" width="3" height="3" rx="0.5" fill="#B0BEC5"/>
                                <circle cx="30" cy="18" r="9" fill="none" stroke="#555" stroke-width="2.5"/>
                                <line x1="36" y1="24" x2="42" y2="30" stroke="#555" stroke-width="2.5" stroke-linecap="round"/>
                                <path d="M30 12 Q26 12 26 16 Q26 19 30 22 Q34 19 34 16 Q34 12 30 12Z" fill="#f44336" opacity="0.7"/>
                                <circle cx="30" cy="16" r="1.8" fill="white"/>
                            </svg>
                        </div>
                        <span class="app-feature-label">他施設の利用<br>勉強場所の探索</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>アプリのダウンロード</h3>
                <p>下記のQRコードをスマートフォンで読み取ると、各ストアのダウンロードページに移動します。</p>
                <div class="qr-download-grid">
                    <div class="qr-download-item qr-ios">
                        <img src="qr-ios.png" alt="iOS版 スタディGO ダウンロードQRコード" class="qr-code-img">
                        <p class="qr-label">iOS（iPhone）</p>
                    </div>
                    <div class="qr-download-item qr-android">
                        <img src="qr-android.png" alt="Android版 スタディGO ダウンロードQRコード" class="qr-code-img">
                        <p class="qr-label">Android</p>
                    </div>
                </div>
            </div>
            </div>
        </section>


        <!-- スタディGO > 対応フロー -->
        <section id="procedures" data-category="studygo">
            <h2>★対応フロー</h2>

            <!-- 対応フロー 全体像（ボタン切替式） -->
            <div class="flow-overview-card">
                <div class="flow-overview-title">対応フロー 全体像（スタッフ／お客様の役割一覧）</div>

                <!-- カテゴリボタン（横並び） -->
                <div class="flow-btn-group">
                    <button class="flow-btn active" data-target="flow-panel-kengaku">見学・お客様対応</button>
                    <button class="flow-btn" data-target="flow-panel-getugaku">月額契約</button>
                    <button class="flow-btn" data-target="flow-panel-checkin">チェックイン・チェックアウト</button>
                    <button class="flow-btn" data-target="flow-panel-kaiyaku">プラン解約（退会）・休会</button>
                </div>

                <!-- 詳細パネル（クリックで切替表示） -->
                <div class="flow-panel-area">
                    <!-- 1. 見学・お客様対応 -->
                    <div id="flow-panel-kengaku" class="flow-panel">
                        <div class="flow-panel-title">見学・お客様対応</div>
                        <div class="dual-flow">
                            <div class="dual-flow-col dual-flow-staff">
                                <div class="dual-flow-header">&#128100; スタッフ</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>予約確認（メール・管理画面）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>お客様情報の確認</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>確認連絡（メッセージ）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">4</div><div class="dual-flow-step-body"><h4>来店受付（名前確認→席案内）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">5</div><div class="dual-flow-step-body"><h4>アイスブレイク・ヒアリング</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">6</div><div class="dual-flow-step-body"><h4>サービス説明・案内・プラン説明</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">7</div><div class="dual-flow-step-body"><h4>来店報告シートの記入</h4></div></div>
                                </div>
                            </div>
                            <div class="dual-flow-col dual-flow-customer">
                                <div class="dual-flow-header">&#128100; お客様</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>見学予約（アプリ/HP/電話/LINE）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>来店</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>体験利用（希望時）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">4</div><div class="dual-flow-step-body"><h4>アンケート記入（入会しない場合）</h4></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 2. 月額契約 -->
                    <div id="flow-panel-getugaku" class="flow-panel" style="display:none;">
                        <div class="flow-panel-title">月額契約</div>
                        <div class="dual-flow">
                            <div class="dual-flow-col dual-flow-staff">
                                <div class="dual-flow-header">&#128100; スタッフ</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>新規契約の確認（会員番号）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>来店手続きの案内</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>利用説明（案内・プラン・解約等）</h4></div></div>
                                    <div class="dual-flow-step admin"><div class="dual-flow-step-num">4</div><div class="dual-flow-step-body"><h4>初回来店手続き（Lステップ・身分証）<span class="admin-label">共通</span></h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">5</div><div class="dual-flow-step-body"><h4>ご案内資料のお渡し</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">6</div><div class="dual-flow-step-body"><h4>入会報告（チャットワーク）</h4></div></div>
                                </div>
                            </div>
                            <div class="dual-flow-col dual-flow-customer">
                                <div class="dual-flow-header">&#128100; お客様</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>アプリDL・会員登録</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>クレジットカード登録</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>月額プラン契約</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">4</div><div class="dual-flow-step-body"><h4>来店（有人時間帯）</h4></div></div>
                                    <div class="dual-flow-step admin"><div class="dual-flow-step-num">5</div><div class="dual-flow-step-body"><h4>初回来店手続き（アンケート・身分証）<span class="admin-label">共通</span></h4></div></div>
                                </div>
                            </div>
                        </div>
                        <!-- 即日入会の手順 -->
                        <div class="flow-panel-alert">
                            <div class="flow-panel-alert-title">&#9888; 即日入会の手順（必ず順番通りに）</div>
                            <ol>
                                <li>管理画面 →「店舗管理」→ 編集アイコンをクリック</li>
                                <li>「最短利用開始日」を <strong>0日</strong> に変更して保存</li>
                                <li>お客様にアプリで契約してもらう</li>
                                <li class="flow-panel-alert-critical">契約完了を確認したら、すぐに「最短利用開始日」を 1日 に戻す</li>
                            </ol>
                        </div>
                    </div>
                    <!-- 3. チェックイン・チェックアウト -->
                    <div id="flow-panel-checkin" class="flow-panel" style="display:none;">
                        <div class="flow-panel-title">チェックイン・チェックアウト</div>
                        <div class="dual-flow">
                            <div class="dual-flow-col dual-flow-staff">
                                <div class="dual-flow-header">&#128100; スタッフ</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>チェックイン画面の確認</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>チェックイン忘れ→案内→管理画面で時刻修正</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>チェックアウト忘れ→店舗コード入力を案内</h4></div></div>
                                </div>
                            </div>
                            <div class="dual-flow-col dual-flow-customer">
                                <div class="dual-flow-header">&#128100; お客様</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>QR読み取り（チェックイン）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>チェックイン画面をスタッフに提示</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>QR読み取り（チェックアウト）</h4></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 4. プラン解約（退会）・休会 -->
                    <div id="flow-panel-kaiyaku" class="flow-panel" style="display:none;">
                        <div class="flow-panel-title">プラン解約（退会）</div>
                        <div class="dual-flow">
                            <div class="dual-flow-col dual-flow-staff">
                                <div class="dual-flow-header">&#128100; スタッフ</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>ダッシュボードで解約予定者を確認</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>ロッカー対応（荷物撤去・鍵返却・解約処理）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">3</div><div class="dual-flow-step-body"><h4>管理画面で退会処理・チャットワーク報告</h4></div></div>
                                </div>
                            </div>
                            <div class="dual-flow-col dual-flow-customer">
                                <div class="dual-flow-header">&#128100; お客様</div>
                                <div class="dual-flow-steps">
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">1</div><div class="dual-flow-step-body"><h4>アプリで解約申請（毎月10日21時締め）</h4></div></div>
                                    <div class="dual-flow-step"><div class="dual-flow-step-num">2</div><div class="dual-flow-step-body"><h4>有人時間帯に来店 → Googleフォーム回答</h4></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="flow-panel-alert">
                            <strong>休会について：</strong>お客様がアプリから申請するだけで完了します（店頭来店不要・スタッフ処理不要）。
                        </div>
                    </div>
                </div>
            </div>

            <!-- 見学・お客様対応 -->
            <div class="card" style="border-left: 5px solid #26A69A; background: #E0F2F1;">
                <h3>見学・お客様対応</h3>

                <h4 style="color: #2E7D32;">見学予約の事前対応（スタディGO経由）</h4>
                <table class="info-table">
                    <tr>
                        <th>予約確認</th>
                        <td>メール通知を確認 → 管理画面「来店予約一覧」で予約確認</td>
                    </tr>
                    <tr>
                        <th>お客様情報確認</th>
                        <td>管理画面「来店予約一覧」の<strong>氏名を選択</strong>して、お客様情報を確認</td>
                    </tr>
                    <tr>
                        <th>お客様に連絡</th>
                        <td>メッセージでお客様に確認連絡
                            <div class="card" style="margin-top: 10px; background: #FFF9C4; border-left: 4px solid #E65100; padding: 12px 15px; font-size: 0.9rem; line-height: 1.8;">
                                <strong style="color: #E65100;">【送信文章テンプレート】</strong><br><br>
                                この度はご契約いただき、誠にありがとうございます。<br><br>
                                初回ご利用前の手続きのため、下記のお時間内でご来店いただける日時を教えていただけますでしょうか。<br><br>
                                ■ 受付可能時間<br>
                                平日： 17:00 〜 21:00<br>
                                土日祝： 12:00 〜 21:00<br><br>
                                ご来店の際は、受付スタッフへ「契約済み」である旨をお伝えください。<br>
                                日程の返信をいただいた後、こちらで確定のご連絡をいたします。<br><br>
                                よろしくお願いいたします。
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>不来店時</th>
                        <td>予約時間から30分経過後「見学キャンセル」に変更</td>
                    </tr>
                </table>

                <h4 style="margin-top: 25px; color: #7B1FA2;">見学予約の事前対応（スタディGO以外）</h4>
                <table class="info-table">
                    <tr>
                        <th>予約確認</th>
                        <td>HP・電話・LINE（Lステップ）経由で見学予約が入った場合、予約内容（日時・氏名・連絡先）を確認<br><span class="note" style="color: #C62828;">※平日13:30〜17:00などの<strong>無人営業時間</strong>の場合は、マネージャーに対応可否を確認してください</span></td>
                    </tr>
                    <tr>
                        <th>来店フォーム登録</th>
                        <td><strong>Googleフォーム</strong>（来店フォーム）で内容を登録。スプレッドシート「来店報告シート」と<strong>カレンダー</strong>に予約が登録されていることを確認</td>
                    </tr>
                    <tr>
                        <th>不来店時</th>
                        <td>LINE・メール・電話でお客様に連絡し、予約時間から30分経過後キャンセル扱いとする</td>
                    </tr>
                </table>

                <h4 style="margin-top: 25px; color: #2E7D32;">お客様対応（無料見学会・トライアル）の対応手順</h4>
                <div class="flow-steps">
                    <div class="flow-step"><h4>1. 来店受付</h4><p>ご予約の方がいらっしゃったら<strong>名前の確認</strong> → 席へご案内</p></div>
                    <div class="flow-step" style="border-left-color: #FF9800; background: #FFF8E1;">
                        <h4>2. アイスブレイク</h4>
                        <p>飲み物を取ってもらい、<strong>説明を聞きながらお飲みいただける</strong>旨をお伝え</p>
                        <p style="margin-top: 8px;">挨拶をし、<strong>無料見学会 / トライアル / 入会申込</strong>のどれかを確認</p>
                        <p style="margin-top: 8px;"><strong>勉強カフェについてご存知ですか？</strong>と確認。知らない場合は<strong>紹介ムービー</strong>を見せる</p>
                        <p style="margin-top: 8px;">簡単なヒアリングを行います：</p>
                        <ul style="margin: 5px 0 0 15px; font-size: 0.85rem;">
                            <li>何を目的に勉強場所を探されているか</li>
                            <li>普段どのような勉強・作業をされているか</li>
                            <li>利用頻度や希望の時間帯</li>
                        </ul>
                    </div>
                    <div class="flow-step"><h4>3. 勉強カフェの説明</h4><p>サービス内容の説明を行う</p></div>
                    <div class="flow-step"><h4>4. スタジオ案内</h4><p>実際にスタジオ内を案内する<br><span class="note">※貴重品だけ持ってもらう</span></p></div>
                    <div class="flow-step"><h4>5. プラン説明</h4><p><strong>プラン＆営業時間（無人・有人）</strong>の確認。プラン表を見せて説明</p></div>
                    <div class="flow-step"><h4>6. 体験開始</h4><p>1時間利用するなら<strong>ビジターボード</strong>を用意して体験開始</p></div>
                    <div class="flow-step"><h4>7. 体験終了</h4><p>入会しない場合は<strong>アンケートの記入</strong>をお願い。<strong>資料を渡す</strong>のを忘れないように</p></div>
                </div>
                <div class="tips" style="margin-top: 10px;">
                    <p><strong>追加タスク：</strong>日別来店・来店報告シートの記入も忘れずに。飛び込みの場合は来店フォームも記入。</p>
                </div>
            </div>

            <!-- 月額契約 -->
            <div class="card" style="background: #FFF9C4;">
                <h3>月額契約</h3>
                <p>新規月額契約の流れです。来店時の契約とオンライン契約の2パターンがあります。</p>

                <div class="pattern-legend">
                    <div class="pattern-legend-item"><span class="pattern-legend-dot customer"></span> お客様フロー</div>
                    <div class="pattern-legend-item"><span class="pattern-legend-dot staff"></span> スタッフフロー</div>
                    <div class="pattern-legend-item"><span style="display:inline-block;width:14px;height:3px;background:#4CAF50;vertical-align:middle;border-radius:2px;"></span> 共通</div>
                    <div class="pattern-legend-item"><span style="display:inline-block;width:14px;height:3px;background:#FF9800;vertical-align:middle;border-radius:2px;"></span> このパターンのみ</div>
                </div>

                <div class="pattern-flow">
                    <!-- 来店契約パターン -->
                    <div class="pattern-col">
                        <div class="pattern-header pattern-header-store">来店契約パターン<br><span style="font-size: 0.75rem; font-weight: normal;">見学 → そのまま入会</span></div>
                        <div class="pattern-steps">
                            <div class="pattern-step step-unique">
                                <div class="pattern-step-num customer">1</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">来店・見学 <span class="pattern-step-badge badge-unique">来店のみ</span></h5>
                                    <p>有人時間帯に来店</p>
                                </div>
                            </div>
                            <div class="pattern-step step-unique">
                                <div class="pattern-step-num staff">2</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">見学対応・プラン説明 <span class="pattern-step-badge badge-unique">来店のみ</span></h5>
                                    <p>スタジオ案内、プラン・営業時間の説明</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">3</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">アプリDL・会員登録 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>アプリのダウンロード → 会員登録</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">4</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">クレジットカード登録 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>クレジットカード情報を登録</p>
                                </div>
                            </div>
                            <div class="pattern-step step-unique step-warning">
                                <div class="pattern-step-num staff">5</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">即日入会設定 <span class="pattern-step-badge badge-unique">来店のみ</span></h5>
                                    <p>管理画面「店舗管理」→「最短利用開始日」を <strong>0日</strong> に変更</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">6</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">月額プラン契約 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>アプリ内でプラン・利用開始日を選択し契約</p>
                                </div>
                            </div>
                            <div class="pattern-step step-unique step-warning">
                                <div class="pattern-step-num staff">7</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label" style="color: #C62828;">設定を戻す <span class="pattern-step-badge badge-unique">来店のみ</span></h5>
                                    <p style="color: #C62828; font-weight: bold;">「最短利用開始日」を <strong>1日</strong> に必ず戻す</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">8</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">利用説明 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>休会・解約の説明、緊急連絡先、スマートロック操作の実演</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num both">9</div>
                                <div class="pattern-step-body">
                                    <h5 class="both-label">初回来店手続き <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <ul>
                                        <li>Lステップ（LINE）の登録</li>
                                        <li>入会アンケートの回答</li>
                                        <li>身分証明書のコピー</li>
                                        <li>マイゴールシートの記入</li>
                                        <li>解錠方法の確認</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">10</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">ご案内資料のお渡し <span class="pattern-step-badge badge-common">共通</span></h5>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">11</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">入会報告 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>チャットワーク【入会情報】に会員番号・氏名を報告</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- オンライン契約パターン -->
                    <div class="pattern-col">
                        <div class="pattern-header pattern-header-online">オンライン契約パターン<br><span style="font-size: 0.75rem; font-weight: normal;">Web契約 → 後日来店</span></div>
                        <div class="pattern-steps">
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">1</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">アプリDL・会員登録 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>アプリのダウンロード → 会員登録</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">2</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">クレジットカード登録 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>クレジットカード情報を登録</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">3</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">月額プラン契約 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>アプリ内でプラン・<strong>利用開始日</strong>を選択し契約</p>
                                </div>
                            </div>
                            <div class="pattern-divider">&#9660; オンライン完結 ／ 以降スタッフ対応 &#9660;</div>
                            <div class="pattern-step step-unique">
                                <div class="pattern-step-num staff">4</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">新規契約の確認 <span class="pattern-step-badge badge-unique">オンラインのみ</span></h5>
                                    <p>契約状態を確認。別メールで<strong>会員番号</strong>を確認</p>
                                </div>
                            </div>
                            <div class="pattern-step step-unique">
                                <div class="pattern-step-num staff">5</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">来店手続きの案内 <span class="pattern-step-badge badge-unique">オンラインのみ</span></h5>
                                    <p>メッセージで来店案内・アポイント取得</p>
                                </div>
                            </div>
                            <div class="pattern-step step-unique">
                                <div class="pattern-step-num customer">6</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">来店 <span class="pattern-step-badge badge-unique">オンラインのみ</span></h5>
                                    <p>有人時間帯に来店する</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">7</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">利用説明 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <ul>
                                        <li>スタジオ案内</li>
                                        <li>プラン・営業時間（無人・有人）の確認</li>
                                        <li>休会・解約の説明（締め日の案内）</li>
                                        <li>緊急連絡先の伝達</li>
                                        <li>スマートロック・チェックイン方法の実演</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num both">8</div>
                                <div class="pattern-step-body">
                                    <h5 class="both-label">初回来店手続き <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <ul>
                                        <li>Lステップ（LINE）の登録</li>
                                        <li>入会アンケートの回答</li>
                                        <li>身分証明書のコピー</li>
                                        <li>マイゴールシートの記入</li>
                                        <li>解錠方法の確認</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">9</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">ご案内資料のお渡し <span class="pattern-step-badge badge-common">共通</span></h5>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">10</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">入会報告 <span class="pattern-step-badge badge-common">共通</span></h5>
                                    <p>チャットワーク【入会情報】に会員番号・氏名を報告</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 即日入会 -->
                <div class="card critical" style="margin-top: 20px; box-shadow: none;">
                    <h3 style="border-left: none; padding-left: 0;">&#9888; 即日入会の手順</h3>
                    <p>見学当日にそのまま入会する場合の手順です。<strong>設定の戻し忘れ</strong>は他のお客様に影響するため、特に注意してください。</p>
                    <div class="staff-action" style="background: #FFF3E0; border-left-color: #f44336;">
                        <div class="staff-action-header" style="color: #B71C1C; border-bottom-color: #EF9A9A;">即日入会の手順（必ず順番通りに）</div>
                        <ol>
                            <li>管理画面 →「店舗管理」→ 編集アイコンをクリック</li>
                            <li>「最短利用開始日」を <strong>0日</strong> に変更して保存</li>
                            <li>お客様にアプリで契約してもらう</li>
                            <li style="color: #B71C1C; font-weight: bold; font-size: 1.1em;">契約完了を確認したら、すぐに「最短利用開始日」を 1日 に戻す</li>
                        </ol>
                    </div>
                </div>

                <h4>月額プランの仕組み</h4>
                <table class="info-table">
                    <tr>
                        <th>入会金</th>
                        <td><strong>11,000円</strong>（店舗別初期費用）</td>
                    </tr>
                    <tr>
                        <th>契約時の請求</th>
                        <td>入会金 + 利用開始月分（日割り）+ 翌月分月額料金</td>
                    </tr>
                    <tr>
                        <th>最低継続期間</th>
                        <td>利用開始月とその翌月の<strong>2ヶ月</strong></td>
                    </tr>
                    <tr>
                        <th>締日ルール</th>
                        <td>毎月<strong>10日21時まで</strong> → 当月末で終了（翌月1日から適用）<br>
                            <strong>11日以降</strong> → 翌月末で終了（翌々月1日から適用）</td>
                    </tr>
                    <tr>
                        <th>自動請求</th>
                        <td>当月10日までに解約申請が無ければ、15日に翌月分請求。1日に1ヶ月単位で自動請求</td>
                    </tr>
                </table>

                <h4>スマートロック（Akerun）</h4>
                <p>スタディGOアプリと連携して入退室を管理しています。</p>
                <ul>
                    <li>BPスタジオのワークスペースを除き、<strong>ラウンジの扉はどちらのスタジオもオートロック</strong>の仕組みです</li>
                    <li>ユーザーは<strong>スタディGOアプリを使わないと入室できません</strong></li>
                </ul>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. アプリ起動</h4>
                        <p>スタディGOアプリを開く</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. QR読取</h4>
                        <p>「チェックイン」からQRコードを読み取る</p>
                    </div>
                    <div class="flow-step">
                        <h4>3. 画面確認</h4>
                        <p>チェックイン画面を確認</p>
                    </div>
                    <div class="flow-step">
                        <h4>4. 入室</h4>
                        <p>「ドアを解錠しました！」と表示されたら入室可能</p>
                    </div>
                </div>
                <div class="tips" style="margin-top: 10px;">
                    <p><strong>スタディGO会員：</strong>入口のQRコードを読み取って入室します。</p>
                    <p><strong>旧会員（スタディGO移行前）：</strong>Akerunアプリから解錠できます。</p>
                </div>
            </div>

            <!-- チェックイン・チェックアウト（旧C+D+E統合） -->
            <div class="card" style="background: #E3F2FD;">
                <h3>チェックイン・チェックアウト</h3>
                <p>月額会員・時間利用（ドロップイン）共通のチェックイン・チェックアウトの流れ、およびエラー時の対応です。</p>

                <h4>時間利用（ドロップイン）のフロー</h4>
                <div class="pattern-legend" style="margin-bottom: 8px;">
                    <div class="pattern-legend-item"><span class="pattern-legend-dot customer"></span> お客様</div>
                    <div class="pattern-legend-item"><span class="pattern-legend-dot staff"></span> スタッフ</div>
                </div>

                <!-- 初めて / 2回目以降 の2パターン -->
                <div class="pattern-flow">
                    <div class="pattern-col">
                        <div class="pattern-header" style="background: #FFF3E0; color: #E65100; border-bottom: 2px solid #FFB74D;">初めてのお客様</div>
                        <div class="pattern-steps">
                            <div class="pattern-step step-unique">
                                <div class="pattern-step-num customer">-</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">アプリDL・会員登録 <span class="pattern-step-badge badge-unique">初回のみ</span></h5>
                                    <p>スタディGOアプリのダウンロード → 会員登録 → クレカ登録</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">1</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">来店</h5>
                                    <p>有人時間帯に来店する</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">2</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">チェックイン</h5>
                                    <p>アプリでQRコード読み取り → 時間利用プラン選択 → 契約（チェックイン）</p>
                                    <p style="font-size: 0.75rem; color: #888;">※1日最大料金を先に請求</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">3</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">画面確認</h5>
                                    <p>チェックイン完了画面を確認する</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">4</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">チェックアウト・精算</h5>
                                    <p>利用終了時にQRコード読み取りでチェックアウト → 精算</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="pattern-col">
                        <div class="pattern-header" style="background: #E8EAF6; color: #283593; border-bottom: 2px solid #7986CB;">2回目以降のお客様</div>
                        <div class="pattern-steps">
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">1</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">来店</h5>
                                    <p>有人時間帯に来店する</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">2</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">チェックイン</h5>
                                    <p>アプリでQRコード読み取り → 時間利用プラン選択 → 契約（チェックイン）</p>
                                    <p style="font-size: 0.75rem; color: #888;">※1日最大料金を先に請求</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num staff">3</div>
                                <div class="pattern-step-body">
                                    <h5 class="staff-label">画面確認</h5>
                                    <p>チェックイン完了画面を確認する</p>
                                </div>
                            </div>
                            <div class="pattern-step step-common">
                                <div class="pattern-step-num customer">4</div>
                                <div class="pattern-step-body">
                                    <h5 class="customer-label">チェックアウト・精算</h5>
                                    <p>利用終了時にQRコード読み取りでチェックアウト → 精算</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 比較表 -->
                <h4>月額利用と時間利用（ドロップイン）の違い</h4>
                <table class="comparison-table" style="table-layout: fixed; width: 100%;">
                    <colgroup>
                        <col style="width: 20%;">
                        <col style="width: 40%;">
                        <col style="width: 40%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>月額プラン利用</th>
                            <th>時間利用（ドロップイン）</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>対象</strong></td>
                            <td>月額プラン契約中の会員</td>
                            <td>誰でも利用可能（要アプリ登録）</td>
                        </tr>
                        <tr>
                            <td><strong>利用可能時間</strong></td>
                            <td>契約プランの時間帯</td>
                            <td><strong>有人時間帯のみ</strong></td>
                        </tr>
                        <tr>
                            <td><strong>料金</strong></td>
                            <td>月額固定（時間超過時は超過料金）</td>
                            <td>770円/時間（1日最大 3,300円）</td>
                        </tr>
                        <tr>
                            <td><strong>チェックイン方法</strong></td>
                            <td>QRコード読み取り → チェックイン</td>
                            <td>QRコード読み取り → 時間利用プラン選択 → 契約（チェックイン）</td>
                        </tr>
                        <tr>
                            <td><strong>チェックイン時の決済</strong></td>
                            <td>なし（月額請求）</td>
                            <td>1日最大料金を先に請求</td>
                        </tr>
                        <tr>
                            <td><strong>チェックアウト時の精算</strong></td>
                            <td>時間超過分の算出・請求</td>
                            <td>最大料金からの精算（返金または追加請求）</td>
                        </tr>
                        <tr>
                            <td><strong>入退室</strong></td>
                            <td>スタディGOアプリで解錠</td>
                            <td>スタッフが解錠対応（有人時間帯のみ）</td>
                        </tr>
                    </tbody>
                </table>

                <!-- チェックイン提示ガイド（SVGイラスト） -->
                <div class="important-box" style="margin-top: 20px;">
                    <p>スタッフがいる時間帯は、チェックイン完了画面を見せてもらってください。</p>
                </div>
                <div class="checkin-steps-guide">
                    <div class="checkin-step-card step-ok">
                        <div class="step-badge">STEP 1</div>
                        <div class="step-illustration">
                            <svg viewBox="0 0 160 140" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="45" cy="25" r="10" fill="none" stroke="#333" stroke-width="2.5"/>
                                <line x1="45" y1="35" x2="45" y2="75" stroke="#333" stroke-width="2.5"/>
                                <line x1="45" y1="50" x2="25" y2="65" stroke="#333" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="45" y1="50" x2="75" y2="45" stroke="#333" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="45" y1="75" x2="30" y2="100" stroke="#333" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="45" y1="75" x2="55" y2="100" stroke="#333" stroke-width="2.5" stroke-linecap="round"/>
                                <rect x="72" y="35" width="18" height="30" rx="2" fill="#333"/>
                                <rect x="74" y="38" width="14" height="22" rx="1" fill="#E8F5E9"/>
                                <text x="81" y="52" text-anchor="middle" font-size="10" fill="#4CAF50" font-weight="bold">&#10003;</text>
                                <rect x="115" y="10" width="35" height="95" rx="3" fill="#8D6E63"/>
                                <rect x="118" y="13" width="29" height="40" rx="2" fill="#A1887F"/>
                                <rect x="118" y="57" width="29" height="40" rx="2" fill="#A1887F"/>
                                <circle cx="125" cy="58" r="3" fill="#FFD54F"/>
                                <path d="M108 55 L113 58 L108 61" stroke="#4CAF50" stroke-width="2" fill="none"/>
                            </svg>
                        </div>
                        <h4>アプリで入店</h4>
                        <p>チェックインして<br>ドアを解錠</p>
                    </div>
                    <div class="checkin-step-arrow">&#10132;</div>
                    <div class="checkin-step-card step-ok">
                        <div class="step-badge">STEP 2</div>
                        <div class="step2-screenshots">
                            <p class="screenshot-label">この画面をスタッフに見せてください</p>
                            <div class="screenshot-pair">
                                <div class="screenshot-item">
                                    <img src="checkin-screen.png" alt="チェックイン完了画面" style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #ccc;">
                                    <p style="font-size: 0.75rem; color: #555; margin-top: 4px; text-align: center;">チェックイン完了画面</p>
                                </div>
                                <div class="screenshot-item">
                                    <img src="checkin-screen2.png" alt="チェックイン中画面" style="max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #ccc;">
                                    <p style="font-size: 0.75rem; color: #555; margin-top: 4px; text-align: center;">チェックイン中画面</p>
                                </div>
                            </div>
                        </div>
                        <h4>スタッフに提示</h4>
                        <p>席に着く前に、必ずこの画面を見せてください</p>
                    </div>
                    <div class="checkin-step-arrow">&#10132;</div>
                    <div class="checkin-step-card step-ng">
                        <div class="step-badge badge-ng">NG例</div>
                        <div class="step-illustration">
                            <svg viewBox="0 0 140 140" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="35" cy="25" r="10" fill="none" stroke="#999" stroke-width="2.5"/>
                                <line x1="35" y1="35" x2="35" y2="70" stroke="#999" stroke-width="2.5"/>
                                <line x1="35" y1="48" x2="20" y2="60" stroke="#999" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="35" y1="48" x2="50" y2="58" stroke="#999" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="35" y1="70" x2="22" y2="92" stroke="#999" stroke-width="2.5" stroke-linecap="round"/>
                                <line x1="35" y1="70" x2="48" y2="92" stroke="#999" stroke-width="2.5" stroke-linecap="round"/>
                                <path d="M55 50 L80 50" stroke="#9E9E9E" stroke-width="2" stroke-dasharray="4,3" fill="none"/>
                                <polygon points="80,46 88,50 80,54" fill="#9E9E9E"/>
                                <rect x="92" y="42" width="38" height="3" rx="1" fill="#8D6E63"/>
                                <rect x="94" y="45" width="3" height="20" fill="#6D4C41"/>
                                <rect x="125" y="45" width="3" height="20" fill="#6D4C41"/>
                                <rect x="100" y="52" width="18" height="15" rx="2" fill="#A1887F"/>
                                <rect x="102" y="67" width="4" height="10" fill="#8D6E63"/>
                                <rect x="114" y="67" width="4" height="10" fill="#8D6E63"/>
                                <rect x="100" y="42" width="3" height="14" fill="#A1887F"/>
                                <circle cx="70" cy="100" r="18" fill="none" stroke="#f44336" stroke-width="3.5"/>
                                <line x1="60" y1="90" x2="80" y2="110" stroke="#f44336" stroke-width="3.5"/>
                                <line x1="80" y1="90" x2="60" y2="110" stroke="#f44336" stroke-width="3.5"/>
                            </svg>
                        </div>
                        <h4>素通りはNG</h4>
                        <p>無断利用と間違われない<br>ようにご協力を！</p>
                    </div>
                </div>

                <!-- チェックイン・チェックアウトの流れ -->
                <h4>チェックインの流れ</h4>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. QR読取</h4>
                        <p>ユーザーがアプリでQRコードを読み取る</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. チェックイン完了</h4>
                        <p>チェックイン完了画面が表示（時間利用はプラン選択後に契約（チェックイン））</p>
                    </div>
                    <div class="flow-step">
                        <h4>3. 画面確認</h4>
                        <p>必要があればスタッフが画面を確認</p>
                    </div>
                </div>
                <p class="note">※QR読取エラー時は店舗コードでもチェックイン可能です（非推奨）</p>

                <h4>チェックアウトの流れ</h4>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. QR読取</h4>
                        <p>ユーザーがアプリでQRコードを読み取る</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. 精算完了</h4>
                        <p>チェックアウト完了・精算画面が表示される</p>
                    </div>
                </div>
                <div class="warning">
                    <p><strong>重要：</strong>チェックアウトが行われるまで利用があったものとみなされ、課金対象の場合は課金されます。営業終了時間に強制チェックアウトが行われます。</p>
                </div>

                <h4 style="color: #1565C0;">月額プラン会員の利用パターン</h4>
                <p>月額プラン会員が有人時間帯に来店した場合の対応パターンです。</p>
                <table class="comparison-table" style="table-layout: fixed; width: 100%;">
                    <colgroup>
                        <col style="width: 25%;">
                        <col style="width: 35%;">
                        <col style="width: 40%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>パターン</th>
                            <th>チェックイン方法</th>
                            <th>料金</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>プラン時間内</strong><br><span class="note">通常利用</span></td>
                            <td>QR読取 → チェックイン</td>
                            <td>月額料金に含まれる（追加なし）</td>
                        </tr>
                        <tr>
                            <td><strong>プラン時間を超過</strong><br><span class="note">うっかり延長</span></td>
                            <td>チェックアウト時に自動精算</td>
                            <td style="color: #C62828; font-weight: bold;">1分あたり13円の超過料金</td>
                        </tr>
                        <tr>
                            <td><strong>プラン時間外に利用</strong><br><span class="note">契約時間帯の前後</span></td>
                            <td>QR読取 → <strong>ドロップイン</strong>として<br>時間利用プラン選択 → 契約</td>
                            <td><strong>770円/時間</strong>（1日最大 3,300円）<br><span class="note">※月額料金とは別に請求</span></td>
                        </tr>
                    </tbody>
                </table>
                <div class="warning" style="margin-top: 10px;">
                    <p><strong>重要：</strong>月額プラン会員でも、契約時間外に利用したい場合はドロップイン（時間利用）として別途チェックインが必要です。プラン時間外は自動的に入室できるわけではありません。</p>
                </div>

                <h4>時間利用（ドロップイン）の想定シーン</h4>
                <ul>
                    <li>月額利用を検討しているが、まずはお試しとして利用</li>
                    <li><strong>月額会員だが、プラン時間外に利用したい場合</strong>（ドロップインとして利用）</li>
                    <li>月額会員だが、〇〇分プランの残時間が無い状態</li>
                    <li>勉強場所を近辺で探していた人</li>
                </ul>
                <div class="tips">
                    <p>月額会員でもプラン時間前に時間利用（ドロップイン）→ プラン時間内に突入 → プラン時間外の超過利用が可能です。これを容認する場合、鍵付与の際にプラン時間内に限定せず、営業時間全ての鍵付与を行う必要があります。</p>
                </div>

                <h4 style="margin-top: 25px; color: #E65100;">チェックイン・チェックアウトを忘れた場合</h4>
                <table class="info-table">
                    <tr>
                        <th>チェックイン忘れ</th>
                        <td><strong>スタッフ：</strong>その場でチェックインしてもらう → 管理画面「チェックイン実績」→「編集」で時刻を修正<br><strong>お客様：</strong>スタッフに申し出てチェックインを行う</td>
                    </tr>
                    <tr>
                        <th>チェックアウト忘れ</th>
                        <td><strong>スタッフ・お客様共通：</strong>アプリ→「QR読取」→「QRが読み取れない場合」→ 店舗コードを入力<br><span class="note">※店舗コードはQRのポップに記載</span></td>
                    </tr>
                </table>

                <h4 style="margin-top: 15px; color: #C62828;">間違ってチェックアウトした場合</h4>
                <table class="info-table">
                    <tr>
                        <th>チェックインの間違い</th>
                        <td><strong>ありえません</strong>（QR読取 → 確認画面の操作が必要なため、誤操作でチェックインされることはありません）</td>
                    </tr>
                    <tr>
                        <th>チェックアウトの間違い</th>
                        <td><strong>再度チェックインが必要です。</strong>間違ってチェックアウトしてしまった場合は、もう一度QRコードを読み取ってチェックインしてください。</td>
                    </tr>
                </table>
            </div>

            <!-- カードG: 解約（退会）・休会 -->
            <div class="card" style="background: #FFF9C4;">
                <h3>プラン解約（退会）・休会</h3>
                <p>退会と休会では手続き方法が異なります。以下を確認してください。</p>

                <h4 style="color: #C62828; margin-top: 15px; border-bottom: 2px solid #C62828; padding-bottom: 4px;">プラン解約（退会）── 店頭手続き必須</h4>

                <div class="dual-flow">
                    <div class="dual-flow-col dual-flow-customer">
                        <div class="dual-flow-header"><span class="dual-flow-icon">&#128100;</span> お客様</div>
                        <div class="dual-flow-steps">
                            <div class="dual-flow-step">
                                <div class="dual-flow-step-num">1</div>
                                <div class="dual-flow-step-body">
                                    <h4>来店（有人時間帯）</h4>
                                    <p>10日の21時までに来店</p>
                                </div>
                            </div>
                            <div class="dual-flow-step">
                                <div class="dual-flow-step-num">2</div>
                                <div class="dual-flow-step-body">
                                    <h4>Googleフォーム回答</h4>
                                    <p>店頭で退会用Googleフォームに回答</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dual-flow-col dual-flow-staff">
                        <div class="dual-flow-header"><span class="dual-flow-icon">&#128119;</span> スタッフ</div>
                        <div class="dual-flow-steps">
                            <div class="dual-flow-step">
                                <div class="dual-flow-step-num">3</div>
                                <div class="dual-flow-step-body">
                                    <h4>ロッカー対応</h4>
                                    <p>ロッカー契約がある場合 → 荷物撤去・鍵返却を確認 → アプリでロッカー解約処理</p>
                                </div>
                            </div>
                            <div class="dual-flow-step admin">
                                <div class="dual-flow-step-num">4</div>
                                <div class="dual-flow-step-body">
                                    <h4 style="color: #C62828;">管理画面で退会処理 <span class="admin-label">必須</span></h4>
                                    <p style="color: #C62828; font-weight: bold;">10日の21時（有人時間終了）までに管理画面で処理を完了させる</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="warning" style="margin-top: 12px;">
                    <p><strong>重要：</strong>Googleフォームの回答だけでは退会になりません。<strong>スタッフが管理画面で処理を完了</strong>して初めて退会が成立します。<br>10日21時までに処理が間に合わないと、15日にプランが自動請求され翌月も継続となります。<br>お客様には<strong>10日より前の有人時間帯に来店</strong>するよう案内してください。</p>
                </div>

                <table class="info-table" style="margin-top: 12px;">
                    <tr>
                        <th>手続き方法</th>
                        <td><strong>店頭でGoogleフォーム回答</strong> ＋ スタッフが管理画面で処理</td>
                    </tr>
                    <tr>
                        <th>締日</th>
                        <td>前月11日〜当月<strong>10日21時まで</strong> → 当月末退会</td>
                    </tr>
                    <tr>
                        <th>受付時間</th>
                        <td><strong>有人時間帯のみ</strong>（平日 17:00〜21:00 ／ 土 12:00〜21:00 ／ 日祝 12:00〜21:00）</td>
                    </tr>
                </table>

                <h4 style="color: #1565C0; margin-top: 20px; border-bottom: 2px solid #1565C0; padding-bottom: 4px;">休会 ── アプリで申請（店頭不要）</h4>
                <table class="info-table" style="margin-top: 10px;">
                    <tr>
                        <th>手続き方法</th>
                        <td><strong>アプリで申請するだけ</strong>（店頭来店不要・スタッフ処理不要）</td>
                    </tr>
                    <tr>
                        <th>締日</th>
                        <td>毎月<strong>10日まで</strong>に申請 → 当月末から休会</td>
                    </tr>
                    <tr>
                        <th>注意</th>
                        <td style="color: #C62828; font-weight: bold;">休会からの再開には2か月分の決済が必要。休会も月に1度しかできない（取り消し不可）</td>
                    </tr>
                </table>
            </div>

        </section>


        <!-- スタディGO > 管理画面操作方法 -->
        <section id="admin-panel" data-category="studygo">
            <h2>管理画面操作方法</h2>

            <!-- ① ダッシュボード（URL・ID・通知を統合） -->
            <div class="card" id="dashboard">
                <h3>ダッシュボード</h3>
                <p>管理画面ログイン：<a href="https://dashboard.studygo.jp/alliance/login" target="_blank">https://dashboard.studygo.jp/alliance/login</a></p>
                <div class="dash-login-row">
                    <img src="images/ログイン画面.jpg" alt="管理画面ログイン画面" class="admin-screenshot" onclick="openScreenshot(this)">
                    <div class="dash-login-info">
                        <table class="info-table">
                            <tr>
                                <th>勉強カフェ新宿スタジオ</th>
                                <td>メールアドレス：benkyocafe.shinjuku@gmail.com<br>パスワード：Base@1209</td>
                            </tr>
                            <tr>
                                <th>勉強カフェBPスタジオ</th>
                                <td>メールアドレス：benkyo-cafe.sbp@b-pt.jp<br>パスワード：Base@1209</td>
                            </tr>
                        </table>
                        <div class="tips" style="margin-top: 10px;">
                            <p>2段階認証で、メールアドレスに送られてくる6桁の番号を入力して、ログインしてください。</p>
                        </div>
                    </div>
                </div>

                <h4>ダッシュボード画面の見方</h4>
                <p>ログイン後のトップ画面（ダッシュボード）で以下の内容が確認できます：</p>
                <div class="dash-overview-row">
                    <div class="dash-overview-img">
                        <img src="images/ダッシュボード.jpg" alt="ダッシュボード画面" class="admin-screenshot" onclick="openScreenshot(this)">
                    </div>
                    <div class="dash-overview-items">
                        <div class="dash-item fail">
                            <div class="dash-item-title">支払いに失敗したお客様</div>
                            <div class="dash-item-desc"><strong>決済エラー</strong>が発生。マネージャーに報告</div>
                        </div>
                        <div class="dash-item msg">
                            <div class="dash-item-title">未返信のメッセージがあるお客様</div>
                            <div class="dash-item-desc">「メッセージへ」からやり取り可能。<strong>必ずその日のうちに返信</strong></div>
                        </div>
                        <div class="dash-item new">
                            <div class="dash-item-title">新規契約したお客様</div>
                            <div class="dash-item-desc">店外契約の場合はメッセージで<strong>来店手続きの連絡</strong>が必要</div>
                        </div>
                        <div class="dash-item cancel">
                            <div class="dash-item-title">解約予定のお客様</div>
                            <div class="dash-item-desc"><strong>店頭に来店</strong>してもらい、フォーム入力+スタッフ作業が必要</div>
                        </div>
                        <div class="dash-item pause">
                            <div class="dash-item-title">休会予定のお客様</div>
                            <div class="dash-item-desc">ロッカー契約がある場合は<strong>荷物撤去・鍵返却</strong>の確認</div>
                        </div>
                    </div>
                </div>

                <div class="card critical" style="margin-top: 15px; box-shadow: none;">
                    <h3 style="border-left: none; padding-left: 0;">「確認済み」ボタンは絶対に押さないでください</h3>
                    <p>「確認済み」を押すと、ダッシュボードからその項目が消えてしまいます。対応が完了していない段階で押すと、<strong>未対応のまま見落とす原因</strong>になります。</p>
                    <p><strong>マネージャーが対応完了を確認した上で操作します。</strong>スタッフは押さないでください。</p>
                </div>

                <p style="margin-top: 15px;">通知の詳細は <a href="#" class="section-link" data-quick-section="admin-panel" data-quick-h3="メール通知">⑦ メール通知</a> を参照してください。</p>
            </div>

            <!-- ② 会員管理 -->
            <div class="card" id="member-management">
                <h3>会員管理</h3>
                <img src="images/会員管理②.jpg" alt="会員管理画面" class="admin-screenshot" onclick="openScreenshot(this)">
                <p>会員一覧から各会員の詳細情報を確認できます。</p>
                <h4>会員情報の確認方法</h4>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. 会員一覧</h4>
                        <p>「会員管理」メニューを開く</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. 詳細表示</h4>
                        <p>一番右のテキストマーク📓を押す</p>
                    </div>
                </div>
                <h4>確認できる情報</h4>
                <div class="info-chips">
                    <span class="info-chip">ID</span>
                    <span class="info-chip">氏名</span>
                    <span class="info-chip">メールアドレス</span>
                    <span class="info-chip">電話番号</span>
                    <span class="info-chip">生年月日</span>
                    <span class="info-chip">職業</span>
                    <span class="info-chip">勉強内容</span>
                    <span class="info-chip">契約履歴</span>
                    <span class="info-chip">決済履歴</span>
                </div>
                <p class="note">※IDはスタディGO固有の番号です。勉強カフェの会員番号とは異なります。</p>
                <p class="note">※会員番号は契約時にスタジオのメールアドレスに別途送られてきます。管理画面には表示されません。</p>
                <div class="staff-action">
                    <div class="staff-action-header">スタッフのやること</div>
                    <ul>
                        <li><strong>新規入会時</strong>：メールで届いた<strong>会員番号</strong>を管理画面の該当会員の<strong>メモ欄に記入</strong>してください。</li>
                        <li><strong>入会報告</strong>：チャットワーク【入会情報】新宿S・BPスタジオ に<strong>会員番号</strong>と<strong>氏名</strong>を必ず報告してください。</li>
                    </ul>
                </div>
            </div>

            <!-- ③ 店舗管理 -->
            <div class="card" id="store-management">
                <h3>店舗管理</h3>
                <img src="images/店舗管理1.jpg" alt="店舗管理画面" class="admin-screenshot" onclick="openScreenshot(this)">
                <p>店舗の基本設定や料金プランの管理を行う画面です。一番右のアイコンから各店舗の詳細設定を開けます。</p>

                <div class="card critical" style="box-shadow: none; margin-bottom: 15px;">
                    <h3 style="border-left: none; padding-left: 0;">最短利用開始日</h3>
                    <p>通常は<strong>1日</strong>に設定されています。即日入会の場合のみ<strong>0日</strong>に一時変更し、契約完了後に<strong>必ず元に戻してください</strong>。</p>
                    <img src="images/最短の利用開始日.jpg" alt="最短の利用開始日の設定場所" class="admin-screenshot" onclick="openScreenshot(this)">
                    <p class="screenshot-caption">店舗詳細画面の下部にある「最短の利用開始日」欄</p>
                    <p class="warning-text" style="font-size: 1.1em;">設定を0日のまま放置すると、すべての新規契約者が即日利用開始できてしまいます。</p>
                </div>

                <div class="warning">
                    <p><strong>注意：</strong>店舗管理の設定変更は影響範囲が大きいため、変更が必要な場合はマネージャーに確認してから行ってください。</p>
                </div>
            </div>

            <!-- ④ チェックイン実績 -->
            <div class="card" id="checkin-history">
                <h3>チェックイン実績</h3>
                <img src="images/チェックイン実績.jpg" alt="チェックイン実績画面" class="admin-screenshot" onclick="openScreenshot(this)">
                <p>期間を選択することで、チェックインの履歴を調べることができます。</p>
                <h4>確認方法</h4>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. 画面を開く</h4>
                        <p>「チェックイン実績」メニューを開く</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. 店舗選択</h4>
                        <p>対象の店舗で絞り込み</p>
                    </div>
                    <div class="flow-step">
                        <h4>3. 期間指定</h4>
                        <p>日付で範囲を指定して検索</p>
                    </div>
                </div>
                <h4>チェックイン実績で確認できること</h4>
                <ul>
                    <li>チェックイン・チェックアウト日時</li>
                    <li>利用時間</li>
                    <li>精算情報</li>
                </ul>
                <p class="note">チェックアウト後は明細確認可能、チェックアウト前は時間編集可能です。</p>

                <div class="staff-action">
                    <div class="staff-action-header">スタッフのやること</div>
                    <ul>
                        <li><strong>同日のチェックイン忘れの修正</strong>はここから行います。</li>
                    </ul>
                    <ol>
                        <li>「チェックイン実績」を開く</li>
                        <li>当日の日付で検索</li>
                        <li>該当ユーザーのチェックイン行の「編集」をクリック</li>
                        <li>正しいチェックイン時刻に修正して保存</li>
                    </ol>
                    <p class="note" style="margin-top: 8px;">※別日のチェックイン修正は店舗側ではできません。</p>
                </div>
            </div>

            <!-- ⑤ 来店予約一覧（見学予約） -->
            <div class="card" id="visit-reservation">
                <h3>来店予約一覧</h3>
                <img src="images/来店予約一覧.jpg" alt="来店予約一覧画面" class="admin-screenshot" onclick="openScreenshot(this)">
                <p>見学予約の管理を行う画面です。ユーザーがアプリから見学予約を行うと、この一覧に表示されます。</p>
                <h4>予約ステータスの管理</h4>
                <table class="info-table">
                    <tr>
                        <th style="color: #E65100;">△不明（未確認）</th>
                        <td><strong>予約が入った直後のデフォルト表示。</strong>仮予約の状態であり、スタッフの対応が必要です</td>
                    </tr>
                    <tr>
                        <th>予約確定</th>
                        <td>見学対応が可能な場合に設定（<strong>お客様にメールが届きます</strong>）</td>
                    </tr>
                    <tr>
                        <th>見学実施</th>
                        <td>予約日時に来店があった場合に設定</td>
                    </tr>
                    <tr>
                        <th>見学キャンセル</th>
                        <td>予約日時に来店がなかった場合に設定（<strong>お客様にメールが届きます</strong>）</td>
                    </tr>
                </table>

                <div class="staff-action">
                    <div class="staff-action-header">スタッフのやること</div>
                    <ol>
                        <li><strong>メール通知を確認</strong> → 管理画面「来店予約一覧」で予約内容・<strong>お客様情報を確認</strong></li>
                        <li>ステータスを<strong>「予約確定」に変更</strong>する</li>
                        <li><strong>メッセージでお客様に確認連絡</strong>を送る
                            <div class="card" style="margin-top: 10px; background: #FFF9C4; border-left: 4px solid #E65100; padding: 12px 15px; font-size: 0.9rem; line-height: 1.8;">
                                <strong style="color: #E65100;">【送信文章テンプレート】</strong><br><br>
                                この度はご契約いただき、誠にありがとうございます。<br><br>
                                初回ご利用前の手続きのため、下記のお時間内でご来店いただける日時を教えていただけますでしょうか。<br><br>
                                ■ 受付可能時間<br>
                                平日： 17:00 〜 21:00<br>
                                土日祝： 12:00 〜 21:00<br><br>
                                ご来店の際は、受付スタッフへ「契約済み」である旨をお伝えください。<br>
                                日程の返信をいただいた後、こちらで確定のご連絡をいたします。<br><br>
                                よろしくお願いいたします。
                            </div>
                        </li>
                        <li><strong>見学当日</strong>：来店があれば「見学実施」に変更。見学対応を行う</li>
                        <li><strong>来店がなかった場合</strong>：予約時間を30分過ぎても来店がなければ「見学キャンセル」に変更する</li>
                    </ol>
                </div>
            </div>

            <!-- ⑥ メッセージ -->
            <div class="card" id="message">
                <h3>メッセージ</h3>
                <p>アプリ内でお客様とやり取りできるメッセージ機能です。</p>
                <h4>メッセージの利用場面</h4>
                <ul>
                    <li>見学予約が入った際の確認連絡やリスケ対応</li>
                    <li>店外で契約したユーザーへの来店案内・手続き連絡</li>
                </ul>
                <h4>確認方法</h4>
                <ul>
                    <li>ダッシュボードの「メッセージへ」またはメニューの「メッセージ」から確認</li>
                    <li>ユーザーからのメッセージがあるとメール通知が届く</li>
                </ul>
                <div class="staff-action">
                    <div class="staff-action-header">スタッフの対応フロー</div>
                    <ol>
                        <li>メール通知が届く（スタジオのメールアドレスに届く）</li>
                        <li>管理画面にログイン → ダッシュボードの「メッセージへ」をクリック</li>
                        <li>該当ユーザーのメッセージを開き、内容を確認して返信する</li>
                        <li><strong>対応判断に迷う場合</strong> → マネージャーにチャットワークで相談してから返信</li>
                    </ol>
                </div>
            </div>

            <!-- ⑦ メール通知 -->
            <div class="card" id="email-notification">
                <h3>メール通知</h3>
                <p>契約・解約・メッセージなどの通知がスタジオのメールアドレスに届きます。</p>
                <table class="info-table">
                    <tr>
                        <th>新宿スタジオ</th>
                        <td>benkyocafe.shinjuku@gmail.com</td>
                    </tr>
                    <tr>
                        <th>BPスタジオ</th>
                        <td>benkyo-cafe.sbp@b-pt.jp</td>
                    </tr>
                </table>
                <h4>届く通知の種類</h4>
                <ul>
                    <li>見学予約の通知</li>
                    <li>月額プラン契約・解約の通知</li>
                    <li>プラン変更・休会の通知</li>
                    <li>オプション（ロッカー）契約・解約の通知</li>
                    <li>お客様からのメッセージ受信通知</li>
                    <li>勉強カフェ会員番号の自動送信（月額契約後に BCBP○○ / BCS○○ がお客様・スタジオへ送信）</li>
                </ul>
            </div>

            <!-- ⑩ 営業日・営業時間管理 -->
            <div class="card" id="business-hours-management">
                <div class="manager-warning">この設定は通常マネージャーが行います。スタッフが変更する場合は必ずマネージャーに確認してください。</div>
                <h3>営業日・営業時間管理</h3>
                <img src="images/営業日・営業時間管理.jpg" alt="営業日・営業時間管理画面" class="admin-screenshot" onclick="openScreenshot(this)">
                <p>営業日や営業時間の変更を管理する画面です。</p>
                <h4>主な操作</h4>
                <table class="info-table">
                    <tr>
                        <th>臨時休業</th>
                        <td>年末年始やビル点検など、臨時で休業する日を設定</td>
                    </tr>
                    <tr>
                        <th>営業時間変更</th>
                        <td>特定の日の営業時間を変更する場合に設定</td>
                    </tr>
                </table>
                <div class="tips">
                    <p>営業時間の変更は店内掲示・Lステップ等にてご案内いたします。管理画面での設定変更が必要な場合はマネージャーに確認してください。</p>
                </div>
            </div>
        </section>


        <section id="app-flow" data-category="studygo">
            <h2>アプリ画面遷移ガイド</h2>
            <p style="margin-bottom: 20px;">会員様がアプリで各手続きを行う際の画面遷移を、操作ごとにわかりやすく解説します。</p>
            <div class="card">
                <h3>時間利用（ドロップイン）</h3>
                <p>QRコード読み取りから利用開始までの画面遷移です。ボタンまたはスクロールで画面を確認できます。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/チェックイン1.PNG" alt="QR読み取り画面" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">QR読み取り</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/ドロップイン2.PNG" alt="店舗チェックイン・プラン選択" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン選択<br>（時間利用を選択）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/ドロップイン3.PNG" alt="時間パック選択" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">時間パック選択<br>（1時間/3時間等）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">4</span>
                            <img src="images/ドロップイン4.PNG" alt="プラン詳細・支払い方法確認" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン詳細<br>料金・支払い確認</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">5</span>
                            <img src="images/ドロップイン5.PNG" alt="注意事項確認・利用開始" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">注意事項確認<br>「利用開始する」</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step app-flow-step-error">
                            <span class="app-flow-step-num" style="background:#C62828;">!</span>
                            <img src="images/ドロップイン6　失敗.PNG" alt="営業時間外エラー" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">営業時間外の場合<br>エラーが表示される</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">6</span>
                            <img src="images/ドロップイン6.PNG" alt="チェックイン完了" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">チェックインが<br>完了しました</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
            </div>

            <div class="card">
                <h3>月額プラン契約</h3>
                <p>店舗検索から月額プラン契約完了までの画面遷移です。ボタンまたはスクロールで画面を確認できます。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">0</span>
                            <img src="images/月額契約0.PNG" alt="店舗検索（地図）" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">店舗検索<br>（地図表示）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/月額契約1.PNG" alt="店舗を選択" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">店舗を選択</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/月額契約2.PNG" alt="店舗詳細ページ" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">店舗詳細<br>「月額申込する」</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/月額契約3.PNG" alt="月額プラン一覧" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン選択<br>（習慣化プラン等）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">4</span>
                            <img src="images/月額契約4.PNG" alt="利用開始日選択" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">利用開始日選択<br>+クーポン入力</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">5</span>
                            <img src="images/月額契約5.PNG" alt="カレンダーで日付選択" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">カレンダーで<br>日付を選択</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">6</span>
                            <img src="images/月額契約6.PNG" alt="利用開始確認・初回手続き説明" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">利用開始確認<br>初回手続き説明</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">7</span>
                            <img src="images/月額契約7.PNG" alt="確認して次へ" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">確認して「次へ」</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">8</span>
                            <img src="images/月額契約8 ロッカー.PNG" alt="オプション（ロッカー）選択" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">オプション選択<br>（ロッカー小/大）</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>

                <h4 style="margin-top: 16px; margin-bottom: 8px;">ステップ⑨：契約内容確認（2パターン）</h4>
                <div class="app-flow-strip app-flow-branch-row">
                    <div class="app-flow-step">
                        <span class="app-flow-step-num">A</span>
                        <img src="images/月額契約9.PNG" alt="契約内容確認（ロッカーなし）" onclick="openScreenshot(this)">
                        <span class="app-flow-step-label">パターンA<br>月額契約のみ<br>（ロッカーなし）</span>
                    </div>
                    <div class="app-flow-step">
                        <span class="app-flow-step-num">B</span>
                        <img src="images/月額契約9　ロッカーあり.PNG" alt="契約内容確認（ロッカーあり）" onclick="openScreenshot(this)">
                        <span class="app-flow-step-label">パターンB<br>月額契約＋ロッカー<br>（初期費用+ロッカー込）</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>チェックイン～開錠～チェックアウトまで</h3>
                <p>来店時のQR読み取りからAkerun開錠、退店時のチェックアウトまでの画面遷移です。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/チェックイン1.PNG" alt="QR読み取り" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">QR読み取り</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/Akerun1.PNG" alt="チェックイン中" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">チェックイン中<br>（会員カード表示）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/Akerun2.PNG" alt="ドアを開錠しました" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">ドアを開錠しました！<br>（Akerun連携）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">4</span>
                            <img src="images/チェックアウト1.PNG" alt="QR読み取り（チェックアウト）" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">QR読み取り<br>（チェックアウト）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">5</span>
                            <img src="images/チェックアウト2.PNG" alt="チェックアウト確認" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">チェックアウト<br>確認ダイアログ</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">6</span>
                            <img src="images/チェックアウト3.PNG" alt="おつかれさまでした" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">おつかれさまでした！<br>（レビュー画面）</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
            </div>

            <div class="card">
                <h3>オプション（ロッカー契約）契約・解約</h3>
                <p class="preparing-notice">情報が入り次第、更新されます。</p>
            </div>
            <div class="card">
                <h3>プラン変更</h3>
                <p>現在のプランから別のプランへ変更する際の画面遷移です。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/プラン変更1.PNG" alt="利用プラン変更・解約" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン変更・解約<br>変更先を選択</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/プラン変更2.PNG" alt="利用プラン変更確認" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン変更確認<br>（変更後の詳細）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/プラン変更3.PNG" alt="利用プラン変更確認（続き）" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">確認して<br>「プランを変更する」</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">4</span>
                            <img src="images/プラン変更4.PNG" alt="利用プラン変更完了" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン変更完了</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
            </div>

            <div class="card">
                <h3>休会</h3>
                <p>プランを休会する際の画面遷移です。</p>
                <div class="tips">
                    <p><strong>休会からの再開には2か月分の決済が必要です。</strong>休会を検討されている会員様にはこの点をお伝えください。</p>
                </div>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/休会1.PNG" alt="利用プラン休会" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">休会するプランを<br>選択</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/休会2.PNG" alt="利用プラン休会（注意事項）" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">注意事項確認<br>「次へ」</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/休会3.PNG" alt="利用プラン休会確認" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">休会確認<br>+理由アンケート</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">4</span>
                            <img src="images/休会4.PNG" alt="利用プラン休会完了" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">休会完了</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
            </div>

            <div class="card">
                <h3>プラン解約（退会）</h3>
                <p>プランの解約には<strong>店頭での手続き</strong>が必要です。アプリから来店予約を行い、店頭で手続きを完了します。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/プラン解約（退会）1.PNG" alt="利用プラン解約" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">解約するプランを<br>選択（店頭手続き必要）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/プラン解約（退会）2.PNG" alt="来店予約カレンダー" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">来店予約<br>日時を選択</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/プラン解約（退会）3.PNG" alt="来店予約内容確認" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">予約内容確認<br>+解約理由アンケート</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">4</span>
                            <img src="images/プラン解約（退会）4.PNG" alt="来店予約完了" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">来店予約完了<br>（仮予約）</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
            </div>

            <div class="card">
                <h3>再開・プラン変更（マイページから）</h3>
                <p>マイページからプラン変更・休会・解約の操作を開始する画面遷移です。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/再開・プラン変更1.PNG" alt="マイページ" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">マイページ<br>「プランを変更・解約する」</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/再開・プラン変更2.PNG" alt="利用プラン変更・解約" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">プラン変更・解約画面<br>（各操作の起点）</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
                <div class="tips" style="margin-top: 12px;">
                    <p><strong>画面②が「プラン変更」「休会」「解約」すべての起点画面です。</strong>この画面から、変更先プラン選択・休会ボタン・解約ボタンそれぞれに進めます。</p>
                </div>
            </div>

            <div class="card">
                <h3>連絡先・支払い方法の変更</h3>
                <p>マイページから利用者情報や支払い方法を変更する画面遷移です。</p>
                <div class="app-flow-container">
                    <button class="app-flow-scroll-btn left" onclick="this.nextElementSibling.scrollBy({left:-300,behavior:'smooth'})">&lsaquo;</button>
                    <div class="app-flow-strip">
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">1</span>
                            <img src="images/連絡先・支払い方法の変更1.PNG" alt="マイページメニュー" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">マイページ<br>メニュー一覧</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">2</span>
                            <img src="images/連絡先・支払い方法の変更2.PNG" alt="利用者情報" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">利用者情報表示<br>（各項目を変更可能）</span>
                        </div>
                        <div class="app-flow-arrow">→</div>
                        <div class="app-flow-step">
                            <span class="app-flow-step-num">3</span>
                            <img src="images/連絡先・支払い方法の変更3.PNG" alt="支払い情報登録・変更" onclick="openScreenshot(this)">
                            <span class="app-flow-step-label">支払い方法変更<br>（クレジットカード登録）</span>
                        </div>
                    </div>
                    <button class="app-flow-scroll-btn right" onclick="this.previousElementSibling.scrollBy({left:300,behavior:'smooth'})">&rsaquo;</button>
                </div>
            </div>
        </section>

        <section id="settings" data-category="studygo">
            <h2><span class="warning-triangle-icon">!</span>要注意<span class="warning-triangle-icon">!</span>各種設定</h2>

            <div class="card">
                <div class="manager-warning">この設定は通常マネージャーが行います。スタッフが変更する場合は必ずマネージャーに確認してください。</div>
                <h3>見学予約カレンダーの設定</h3>
                <p>「営業日・営業時間管理」から設定します。</p>
                <h4>設定項目</h4>
                <ul>
                    <li><strong>締め切り設定</strong> - いつまで見学予約を受け付けるか（例：「前日の20:00まで」「当日の見学開始時刻の1時間前」など）</li>
                    <li><strong>基本見学可能時間</strong> - 「◎見学可能」となる時間帯</li>
                    <li><strong>対応不明</strong> - チェックを入れると「△対応不明」（仮予約）で表示</li>
                    <li><strong>対応不可</strong> - チェックを入れるとその曜日の見学予約を停止</li>
                </ul>
                <div class="tips">
                    <p>無人店舗の場合は基本は全て「△対応不明」とする運用が想定されます。</p>
                </div>
            </div>

            <div class="card">
                <div class="manager-warning">この設定は通常マネージャーが行います。スタッフが変更する場合は必ずマネージャーに確認してください。</div>
                <h3>営業日・営業時間設定（月額会員向け）</h3>
                <p>スタディGOの月額会員の受け入れ可能時間・曜日を設定します。</p>
                <div class="warning">
                    <ul>
                        <li>頻繁な変更は推奨しません</li>
                        <li>現在提供中のプランと干渉しないようにご注意ください</li>
                        <li>月額契約中ユーザーに事前連絡が必要な場合があります</li>
                        <li>終了時間1分前にチェックイン中ユーザーの強制チェックアウトが行われます</li>
                    </ul>
                </div>
            </div>

            <div class="card">
                <div class="manager-warning">この設定は通常マネージャーが行います。スタッフが変更する場合は必ずマネージャーに確認してください。</div>
                <h3>営業日・営業時間設定（都度利用向け）</h3>
                <p>時間利用（ドロップイン）の受け入れ可能時間・曜日を設定します。有人営業時間帯の設定が想定されます。</p>
                <div class="warning">
                    <p>「月額会員向け」と「都度利用向け」は独立したカレンダーのため連動しません。両方の設定を変更し、整合させる必要があります。</p>
                </div>
            </div>

            <div class="card">
                <div class="manager-warning">この設定は通常マネージャーが行います。スタッフが変更する場合は必ずマネージャーに確認してください。</div>
                <h3>店舗管理での設定</h3>
                <p>「店舗管理」→ 一番右の編集アイコンをクリック</p>
                <table class="info-table">
                    <tr>
                        <th>チェックイン時表示</th>
                        <td>入室方法や暗証番号、利用ルールなどを記載</td>
                    </tr>
                    <tr>
                        <th>契約前同意事項</th>
                        <td>契約前にユーザーに同意を求める内容を記載</td>
                    </tr>
                    <tr style="background: #FFEBEE;">
                        <th style="background: #FFCDD2; color: #B71C1C; font-weight: bold;">最短利用開始日</th>
                        <td>
                            <strong>「n日以降」の営業日と設定可能</strong><br>
                            0=当日から契約して利用可<br>
                            <strong>1=契約の翌日から利用可（通常はこの設定）</strong><br>
                            2=契約の2日後から利用可
                            <p class="warning-text" style="margin-top: 8px;">即日入会時のみ0に変更し、契約完了後に必ず1に戻してください。</p>
                        </td>
                    </tr>
                </table>
                <p class="note">※見学対応時にその日から入会させたいときはその時のみ設定変更</p>
            </div>
        </section>


        <!-- スタッフマニュアル > OP作業 -->
        <section id="staff-op" data-category="staff">
            <h2>OP作業（オープン作業）</h2>
            <div class="card">
                <h3>出勤時チェックリスト</h3>
                <div class="checklist">
                    <label><input type="checkbox"> Akerunで入口ドアを解錠・入店</label>
                    <label><input type="checkbox"> 照明・空調・空気清浄機の電源ON</label>
                    <label><input type="checkbox"> PC・iPadの設置・起動</label>
                    <label><input type="checkbox"> 出勤打刻（タッチオンタイム）</label>
                    <label><input type="checkbox"> 掃除機がけ（全エリア）</label>
                    <label><input type="checkbox"> トイレ清掃・ペーパータオル補充</label>
                    <label><input type="checkbox"> 机・椅子の整頓・アルコール拭き</label>
                    <label><input type="checkbox"> ドリンクコーナーOP（コーヒーマシン・給茶機）</label>
                    <label><input type="checkbox"> 備品セッティング・貸出備品の整理</label>
                    <label><input type="checkbox"> 留守番電話の解除</label>
                    <label><input type="checkbox"> Akerunオートロック解除（有人時間帯）</label>
                    <label><input type="checkbox"> 外看板の設置・ポスト確認</label>
                    <label><input type="checkbox"> 深夜Akerun履歴確認（22時〜5時の不正利用チェック）</label>
                    <label><input type="checkbox"> 会費ペイ支払い状況の確認（旧BPアプリ会員のみ）</label>
                    <label><input type="checkbox"> スタディGO管理画面のダッシュボード確認</label>
                    <label><input type="checkbox"> メールチェック・チャットワーク確認</label>
                    <label><input type="checkbox"> SNS（X）更新</label>
                </div>
            </div>
            <div class="card">
                <h3>ドリンクコーナーOP</h3>
                <ul>
                    <li>コーヒーマシンの電源ON・水タンク確認</li>
                    <li>給茶機の準備・受け皿の清掃</li>
                    <li>紙コップ・マドラー・砂糖・ミルク等の補充</li>
                    <li>ウォーターサーバーの残量確認</li>
                    <li>カウンター周りの拭き掃除</li>
                </ul>
            </div>
            <div class="card">
                <h3>Akerun設定（有人時間帯）</h3>
                <p>有人時間帯はオートロックを解除し、お客様がスムーズに入退室できるようにします。</p>
                <ol>
                    <li>Akerun管理画面にログイン</li>
                    <li>オートロック設定を<strong>OFF</strong>に変更</li>
                </ol>
                <p class="note">※退勤時にオートロックを<strong>ON</strong>に戻すことを忘れずに。</p>
            </div>
            <div class="card">
                <h3>曜日別追加作業</h3>
                <table class="info-table">
                    <tr>
                        <th>火曜</th>
                        <td>観葉植物の水やり・状態チェック</td>
                    </tr>
                    <tr>
                        <th>水曜・土曜</th>
                        <td>アスクル・UCC発注確認</td>
                    </tr>
                    <tr>
                        <th>木曜</th>
                        <td>ドアノブ除菌・シュレッダー処理</td>
                    </tr>
                    <tr>
                        <th>金曜</th>
                        <td>MTGルーム清掃（該当店舗）</td>
                    </tr>
                    <tr>
                        <th>土曜・火曜</th>
                        <td>エントランス清掃</td>
                    </tr>
                </table>
            </div>
        </section>


        <!-- スタッフマニュアル > CL作業 -->
        <section id="staff-cl" data-category="staff">
            <h2>CL作業（クローズ作業）</h2>
            <div class="card">
                <h3>退勤時の作業</h3>
                <div class="checklist">
                    <label><input type="checkbox"> 店内のお客様への声がけ（閉店時間のご案内）</label>
                    <label><input type="checkbox"> 忘れ物チェック</label>
                    <label><input type="checkbox"> ドリンクコーナーの片付け・清掃</label>
                    <label><input type="checkbox"> ゴミの回収・ゴミ袋の交換</label>
                    <label><input type="checkbox"> 窓の施錠確認</label>
                    <label><input type="checkbox"> PCのシャットダウン</label>
                    <label><input type="checkbox"> Akerunオートロック設定を<strong>ON</strong>に戻す</label>
                    <label><input type="checkbox"> 空調・照明のOFF（タイマー設定の場合は確認）</label>
                    <label><input type="checkbox"> 退勤打刻（タッチオンタイム）</label>
                    <label><input type="checkbox"> チャットワークで退勤報告</label>
                </div>
            </div>
            <div class="card">
                <h3>ドリンクコーナー片付け</h3>
                <ul>
                    <li>コーヒーマシンの電源OFF・洗浄</li>
                    <li>カウンター周りの拭き掃除</li>
                    <li>残った飲料の処理</li>
                </ul>
            </div>
            <div class="card">
                <h3>退勤報告</h3>
                <p>チャットワークの所定グループに以下を報告：</p>
                <ul>
                    <li>退勤時刻</li>
                    <li>来店者数</li>
                    <li>特記事項（トラブル、忘れ物、備品不足等）</li>
                    <li>新規入会があった場合はID・氏名</li>
                </ul>
            </div>
        </section>


        <!-- スタッフマニュアル > 清掃業務 -->
        <section id="staff-cleaning" data-category="staff">
            <h2>清掃業務</h2>
            <div class="card">
                <h3>日常清掃</h3>
                <div class="checklist">
                    <label><input type="checkbox"> 掃除機がけ（全エリア）</label>
                    <label><input type="checkbox"> 机・椅子の拭き掃除</label>
                    <label><input type="checkbox"> トイレ清掃</label>
                    <label><input type="checkbox"> ドリンクコーナー清掃</label>
                    <label><input type="checkbox"> ゴミ箱の確認・回収</label>
                    <label><input type="checkbox"> 玄関・エントランスの清掃</label>
                </div>
            </div>
            <div class="card">
                <h3>清掃時間帯</h3>
                <table class="info-table">
                    <tr>
                        <th>平日</th>
                        <td>17:00前後（出勤時）・20:00〜21:00ごろ</td>
                    </tr>
                    <tr>
                        <th>土日祝</th>
                        <td>12:00前後（出勤時）・20:00〜21:00ごろ</td>
                    </tr>
                </table>
                <p class="note">※掃除機がけ時はお客様へ事前にお声がけをお願いします。</p>
            </div>
            <div class="card">
                <h3>清掃時の注意</h3>
                <ul>
                    <li>掃除機をかける際は、お客様に一声おかけしてから作業を開始</li>
                    <li>お客様の荷物や持ち物には触れない</li>
                    <li>ドリンクコーナーは一時的に利用制限をかける場合がある旨を掲示</li>
                    <li>トイレ清掃中は「清掃中」の札を掲示</li>
                </ul>
            </div>
        </section>


        <!-- スタッフマニュアル > 接客・受付対応 -->
        <section id="staff-customer" data-category="staff">
            <h2>接客・受付対応</h2>
            <div class="card">
                <h3>基本マナー</h3>
                <ul>
                    <li>お客様が来店されたら<strong>「いらっしゃいませ」</strong>と笑顔でお迎え</li>
                    <li>チェックイン画面の確認（有人時間帯）</li>
                    <li>退店時は<strong>「ありがとうございました」</strong>とお見送り</li>
                    <li>常に丁寧語・敬語を使用</li>
                </ul>
            </div>
            <div class="card">
                <h3>見学対応</h3>
                <p>予約確認 → 店内案内 → プラン説明 → 質問対応 → 入会案内</p>
                <div class="warning">
                    <p><strong>注意</strong>：スタディGO以外のプランやサービスの紹介・説明はお控えください。</p>
                </div>
                <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="見学・お客様対応" style="color: #1565C0;">→ 見学・お客様対応の詳細フローを参照</a></p>
            </div>
            <div class="card">
                <h3>入会対応</h3>
                <p>アプリ案内 → 契約（お客様操作） → 身分証確認 → ルール説明 → 解錠確認 → 連絡先案内 → チャットワーク報告</p>
                <div class="warning">
                    <p><strong>即日入会</strong>の場合は管理画面「店舗管理」→「最短利用開始日」を0日に変更 → 契約完了後に必ず1日に戻す</p>
                </div>
                <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="月額契約" style="color: #1565C0;">→ 月額契約の詳細フローを参照</a></p>
            </div>
            <div class="card">
                <h3>よくある質問への回答例</h3>
                <table class="info-table">
                    <tr>
                        <th>Wi-Fiパスワードは？</th>
                        <td>店内掲示をご案内</td>
                    </tr>
                    <tr>
                        <th>電源はありますか？</th>
                        <td>各席にコンセントがございます</td>
                    </tr>
                    <tr>
                        <th>飲食は可能ですか？</th>
                        <td>ドリンクコーナーのご利用は自由です。食事はラウンジエリアでお願いしております</td>
                    </tr>
                    <tr>
                        <th>プラン変更したい</th>
                        <td>アプリから手続き可能です。詳細は運営にお問い合わせください</td>
                    </tr>
                </table>
            </div>
        </section>


        <!-- スタッフマニュアル > 各種手続き対応 -->
        <section id="staff-procedures" data-category="staff">
            <h2>各種手続き対応</h2>
            <div class="card" style="background: #FFF9C4;">
                <h3>入会手続きの流れ</h3>
                <p>見学対応 → アプリ案内 → 契約（お客様操作） → 身分証確認 → ルール説明 → 解錠確認 → 連絡先案内 → チャットワーク報告</p>
                <div class="warning">
                    <p><strong>即日入会の場合：</strong>管理画面「店舗管理」→「最短利用開始日」を0日に変更 → 契約完了後に<strong>必ず1日に戻す</strong></p>
                </div>
                <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="月額契約" style="color: #1565C0;">→ 月額契約の詳細フロー（WEB契約・来店契約パターン）を参照</a></p>
            </div>
            <div class="card" style="background: #FFF9C4;">
                <h3>プラン解約（退会）手続きの流れ</h3>
                <p>ヒアリング → プラン解約届記入 → ロッカー確認（該当者のみ） → 管理画面で退会処理 → チャットワーク報告</p>
                <p class="note">※締日: 10日21時まで → 当月末退会 ／ 11日以降 → 翌月末退会</p>
                <p class="note">※休会はお客様がアプリから申請するだけで完了（スタッフ対応不要）</p>
                <p style="margin-top: 8px;"><a href="#" class="section-link" data-link-section="procedures" data-link-h3="プラン解約（退会）・休会" style="color: #1565C0;">→ プラン解約・休会の詳細フローを参照</a></p>
            </div>
            <div class="card" style="background: #E3F2FD;">
                <h3>ビジター（時間利用）対応</h3>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. アプリ案内</h4>
                        <p>アプリのダウンロードをご案内</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. チェックイン</h4>
                        <p>QRコード読み取りで時間利用プラン選択</p>
                    </div>
                    <div class="flow-step">
                        <h4>3. 身分証確認</h4>
                        <p>身分証の確認</p>
                    </div>
                    <div class="flow-step">
                        <h4>4. ルール説明</h4>
                        <p>施設ルールの簡単な説明</p>
                    </div>
                </div>
                <p class="note">※有人時間帯のみ対応。外国人のお客様は対応に注意。</p>
            </div>
            <div class="card">
                <h3>ロッカー契約・解約</h3>
                <table class="info-table">
                    <tr>
                        <th>新規契約</th>
                        <td>
                            <ol>
                                <li>空きロッカーの確認</li>
                                <li>ロッカー番号・暗証番号の決定</li>
                                <li>アプリでオプション契約（お客様操作）</li>
                                <li>鍵の貸与と注意事項の説明</li>
                            </ol>
                        </td>
                    </tr>
                    <tr>
                        <th>解約</th>
                        <td>アプリから解約可能（店頭不要）。荷物撤去・鍵返却を確認</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h3>休会対応</h3>
                <p>休会はアプリから手続き可能です（店頭不要）。</p>
                <div class="tips">
                    <p><strong>休会からの再開には2か月分の決済が必要です。</strong>お客様にはこの点を事前にお伝えください。</p>
                </div>
            </div>
        </section>


        <!-- スタッフマニュアル > 備品・発注管理 -->
        <section id="staff-equipment-mgmt" data-category="staff">
            <h2>備品・発注管理</h2>
            <div class="card">
                <h3>消耗品の管理</h3>
                <table class="info-table">
                    <tr>
                        <th>ドリンク関連</th>
                        <td>紙コップ、マドラー、砂糖、ミルク、コーヒー豆</td>
                    </tr>
                    <tr>
                        <th>清掃関連</th>
                        <td>ウエットティッシュ、ゴミ袋、トイレットペーパー、ハンドソープ</td>
                    </tr>
                    <tr>
                        <th>事務関連</th>
                        <td>コピー用紙、ボールペン、入会申込書</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h3>発注の流れ</h3>
                <div class="flow-steps">
                    <div class="flow-step">
                        <h4>1. 在庫確認</h4>
                        <p>在庫が残り少なくなったら在庫リストを確認</p>
                    </div>
                    <div class="flow-step">
                        <h4>2. 発注依頼</h4>
                        <p>チャットワークで発注依頼を報告</p>
                    </div>
                    <div class="flow-step">
                        <h4>3. 検品・収納</h4>
                        <p>発注品が届いたら検品・所定の場所に収納</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>貸出備品の管理</h3>
                <ul>
                    <li>充電器（各種）</li>
                    <li>イヤホン</li>
                    <li>ブランケット</li>
                    <li>延長コード</li>
                </ul>
                <p class="note">※貸出備品は受付で管理し、退店時に返却を確認してください。</p>
            </div>
        </section>


        <!-- スタッフマニュアル > 報告・連絡 -->
        <section id="staff-report" data-category="staff">
            <h2>報告・連絡</h2>
            <div class="card">
                <h3>チャットワーク</h3>
                <p>日常の報告・連絡はチャットワークで行います。</p>
                <table class="info-table">
                    <tr>
                        <th>【入会情報】</th>
                        <td>新規入会があった場合にID・氏名を報告</td>
                    </tr>
                    <tr>
                        <th>退勤報告</th>
                        <td>退勤時刻、来店者数、特記事項</td>
                    </tr>
                    <tr>
                        <th>備品発注</th>
                        <td>消耗品の在庫不足・発注依頼</td>
                    </tr>
                    <tr>
                        <th>トラブル報告</th>
                        <td>設備故障、お客様トラブル等</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h3>連絡先一覧</h3>
                <div class="contact-info">
                    <p><strong>スタディGOサポート</strong></p>
                    <p>メール：info.studygo@b-pt.jp</p>
                    <p>電話：03-6302-0774（平日10:00〜18:00）</p>
                </div>
            </div>
        </section>


        <!-- スタッフマニュアル > ロープレ動画 -->
        <section id="staff-roleplay" data-category="staff">
            <h2>ロープレ動画</h2>
            <div class="card">
                <p class="preparing-notice">ロープレ動画は準備中です。完成次第、ここに掲載されます。</p>
                <p>動画が公開されるまで、以下の対応ポイントを参考にしてください。</p>
            </div>
            <div class="card">
                <h3>見学対応のポイント</h3>
                <div class="roleplay-points-list">
                    <div class="roleplay-point-item">
                        <h4>基本フロー</h4>
                        <p>挨拶 → 館内案内 → プラン説明 → 質疑応答 → 入会案内</p>
                    </div>
                    <div class="roleplay-point-item">
                        <h4>よくある質問対応</h4>
                        <p>料金の質問 → 他店との違い → 体験利用への誘導</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>入会対応のポイント</h3>
                <div class="roleplay-points-list">
                    <div class="roleplay-point-item">
                        <h4>店頭での入会対応フロー</h4>
                        <p>アプリDL案内 → プラン選択サポート → クレカ登録 → Akerun設定</p>
                    </div>
                    <div class="roleplay-point-item">
                        <h4>Web契約済み会員の初来店対応</h4>
                        <p>本人確認 → アプリ解錠確認 → 館内案内 → ルール説明</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>クレーム・トラブル対応のポイント</h3>
                <div class="roleplay-points-list">
                    <div class="roleplay-point-item">
                        <h4>騒音・マナー違反のクレーム対応</h4>
                        <p>傾聴 → 共感 → 事実確認 → 対処 → フォローアップ</p>
                    </div>
                    <div class="roleplay-point-item">
                        <h4>設備故障時のお客様対応</h4>
                        <p>状況確認 → お詫び → 代替案提示 → 報告</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3>電話対応のポイント</h3>
                <div class="roleplay-points-list">
                    <div class="roleplay-point-item">
                        <h4>電話対応の基本マナー</h4>
                        <p>3コール以内 → 名乗り → 用件確認 → メモ → 復唱確認</p>
                    </div>
                    <div class="roleplay-point-item">
                        <h4>見学予約・問い合わせの電話対応</h4>
                        <p>空き確認 → 日時調整 → 案内事項 → 確認復唱</p>
                    </div>
                </div>
            </div>
        </section>


        <!-- スタッフマニュアル > スタジオ別情報 -->
        <section id="staff-studio" data-category="staff">
            <h2>スタジオ別情報</h2>
            <div class="card">
                <h3>新宿スタジオ</h3>
                <table class="info-table">
                    <tr>
                        <th>管理画面</th>
                        <td>benkyocafe.shinjuku@gmail.com</td>
                    </tr>
                    <tr>
                        <th>特徴</th>
                        <td>会議室（MTGルーム）あり</td>
                    </tr>
                    <tr>
                        <th>設備</th>
                        <td>空気清浄機4台、除湿器、扇風機、コピー機（シャープMX-2650FN）</td>
                    </tr>
                    <tr>
                        <th>留守電解除</th>
                        <td>F3ボタンを2回押し</td>
                    </tr>
                    <tr>
                        <th>掃除機</th>
                        <td>BYから取り出し、WSから先にかける</td>
                    </tr>
                </table>
                <h4>新宿スタジオ固有の作業</h4>
                <ul>
                    <li>金曜：MTGルーム清掃</li>
                    <li>土曜・火曜：エントランス清掃</li>
                    <li>コピー機トラブル時連絡先：070-1452-8458</li>
                </ul>
            </div>
            <div class="card">
                <h3>BPスタジオ</h3>
                <table class="info-table">
                    <tr>
                        <th>管理画面</th>
                        <td>benkyo-cafe.sbp@b-pt.jp</td>
                    </tr>
                    <tr>
                        <th>特徴</th>
                        <td>テルブースあり</td>
                    </tr>
                    <tr>
                        <th>棚の配置</th>
                        <td>上段：事務用品、中段：清掃用具、下段：ドリンク在庫</td>
                    </tr>
                </table>
                <h4>BPスタジオ固有の作業</h4>
                <ul>
                    <li>棚の解錠（出勤時）・施錠（退勤時）</li>
                    <li>水曜・土曜：アスクル・UCC発注確認</li>
                    <li>火曜：観葉植物チェック（霧吹きで葉の表面に水やり）</li>
                    <li>製氷機メンテナンス（定期）</li>
                </ul>
            </div>
        </section>


    </main>

    <!-- ページ送りボタン -->
    <div class="page-nav" id="pageNav" style="display:none;">
        <div class="page-nav-row">
            <button class="page-nav-btn" id="prevButton" aria-label="戻る">&#8592; 戻る</button>
            <button class="page-nav-btn" id="nextButton" aria-label="次へ">次へ &#8594;</button>
        </div>
        <div class="page-nav-row">
            <button class="page-nav-btn page-nav-section-btn" id="prevSectionButton" aria-label="前のセクションへ">&#9650; 前のセクションへ</button>
            <button class="page-nav-btn page-nav-section-btn" id="nextSectionButton" aria-label="次のセクションへ">次のセクションへ &#9660;</button>
        </div>
    </div>

    <footer>
        <p>勉強カフェ スタディGO スタッフマニュアル</p>
        <p class="update-date">最終更新日: <span id="lastUpdate"></span></p>
    </footer>

    <script>
        // ===================================
        // スタッフログインシステム
        // ===================================
        const STAFF_LIST = [
            { name: '近藤', pin: '0000' },
            { name: '國松', pin: '0000' },
            { name: '岡林', pin: '0000' },
            { name: '山下', pin: '0000' },
            { name: 'カンノ', pin: '0000' },
            { name: '生島', pin: '0000' },
            { name: '古俣', pin: '0000' },
            { name: '清水', pin: '0000' },
            { name: '新井', pin: '0000' },
            { name: '前保', pin: '0000' },
        ];

        // スタッフPINの取得（localStorage優先、なければデフォルト）
        function getStaffPin(name) {
            const savedPins = JSON.parse(localStorage.getItem('studygo_staff_pins') || '{}');
            if (savedPins[name]) return savedPins[name];
            const staff = STAFF_LIST.find(s => s.name === name);
            return staff ? staff.pin : null;
        }

        // スタッフPINの保存
        function saveStaffPin(name, newPin) {
            const savedPins = JSON.parse(localStorage.getItem('studygo_staff_pins') || '{}');
            savedPins[name] = newPin;
            localStorage.setItem('studygo_staff_pins', JSON.stringify(savedPins));
        }

        // 現在ログイン中のユーザー名を取得
        function getCurrentUser() {
            return sessionStorage.getItem('studygo_current_user');
        }

        // ログインUIの初期化
        const loginOverlay = document.getElementById('loginOverlay');
        const loginNameSelect = document.getElementById('loginName');
        const loginPinInput = document.getElementById('loginPin');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const userInfo = document.getElementById('userInfo');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const headerGuide = document.getElementById('headerGuide');
        const logoutBtn = document.getElementById('logoutBtn');
        const pinChangeBtnHeader = document.getElementById('pinChangeBtn');
        const pinChangeOverlay = document.getElementById('pinChangeOverlay');
        const pinChangeClose = document.getElementById('pinChangeClose');
        const pinChangeSaveBtn = document.getElementById('pinChangeSaveBtn');
        const pinChangeError = document.getElementById('pinChangeError');
        const pinChangeSuccess = document.getElementById('pinChangeSuccess');

        // ドロップダウンにスタッフ名を追加
        STAFF_LIST.forEach(staff => {
            const opt = document.createElement('option');
            opt.value = staff.name;
            opt.textContent = staff.name;
            loginNameSelect.appendChild(opt);
        });

        // ログイン処理
        function doLogin() {
            const name = loginNameSelect.value;
            const pin = loginPinInput.value;
            loginError.textContent = '';

            if (!name) {
                loginError.textContent = 'スタッフ名を選択してください';
                return;
            }
            if (!pin || pin.length !== 4) {
                loginError.textContent = 'PINは4桁で入力してください';
                return;
            }

            const correctPin = getStaffPin(name);
            if (pin !== correctPin) {
                loginError.textContent = 'PINが正しくありません';
                loginPinInput.value = '';
                loginPinInput.focus();
                return;
            }

            // ログイン成功
            sessionStorage.setItem('studygo_current_user', name);
            loginOverlay.classList.remove('active');
            loginPinInput.value = '';
            showUserInfo(name);
            onLoginSuccess();
        }

        loginBtn.addEventListener('click', doLogin);
        loginPinInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') doLogin();
        });

        // ログアウト処理
        logoutBtn.addEventListener('click', function() {
            sessionStorage.removeItem('studygo_current_user');
            hideUserInfo();
            loginOverlay.classList.add('active');
            loginNameSelect.value = '';
            loginError.textContent = '';
            const adminDash = document.getElementById('admin-quiz-dashboard');
            if (adminDash) adminDash.style.display = 'none';
        });

        // ヘッダーのユーザー情報表示
        function showUserInfo(name) {
            userNameDisplay.textContent = name + 'さん';
            userInfo.style.display = 'flex';
            if (headerGuide) headerGuide.style.display = 'none';
        }

        function hideUserInfo() {
            userInfo.style.display = 'none';
            if (headerGuide) headerGuide.style.display = '';
        }

        // PIN変更モーダル
        pinChangeBtnHeader.addEventListener('click', function() {
            document.getElementById('currentPin').value = '';
            document.getElementById('newPin').value = '';
            document.getElementById('confirmPin').value = '';
            pinChangeError.textContent = '';
            pinChangeSuccess.textContent = '';
            pinChangeOverlay.classList.add('active');
        });

        pinChangeClose.addEventListener('click', function() {
            pinChangeOverlay.classList.remove('active');
        });

        pinChangeOverlay.addEventListener('click', function(e) {
            if (e.target === pinChangeOverlay) pinChangeOverlay.classList.remove('active');
        });

        pinChangeSaveBtn.addEventListener('click', function() {
            const user = getCurrentUser();
            if (!user) return;
            const current = document.getElementById('currentPin').value;
            const newP = document.getElementById('newPin').value;
            const confirm = document.getElementById('confirmPin').value;
            pinChangeError.textContent = '';
            pinChangeSuccess.textContent = '';

            if (current !== getStaffPin(user)) {
                pinChangeError.textContent = '現在のPINが正しくありません';
                return;
            }
            if (!newP || newP.length !== 4 || !/^\d{4}$/.test(newP)) {
                pinChangeError.textContent = '新しいPINは4桁の数字で入力してください';
                return;
            }
            if (newP !== confirm) {
                pinChangeError.textContent = '確認用PINが一致しません';
                return;
            }

            saveStaffPin(user, newP);
            pinChangeSuccess.textContent = 'PINを変更しました';
            setTimeout(() => { pinChangeOverlay.classList.remove('active'); }, 1200);
        });

        // ログイン後のコールバック（クイズ・お知らせの再読み込み）
        // ===================================
        // 対応フロー全体像 ボタン切替
        // ===================================
        document.querySelectorAll('.flow-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var targetId = this.getAttribute('data-target');
                document.querySelectorAll('.flow-panel').forEach(function(p) { p.style.display = 'none'; });
                document.querySelectorAll('.flow-btn').forEach(function(b) { b.classList.remove('active'); });
                var panel = document.getElementById(targetId);
                if (panel) panel.style.display = '';
                this.classList.add('active');
            });
        });

        function onLoginSuccess() {
            if (typeof loadNoticeStatus === 'function') loadNoticeStatus();
            if (typeof updateTrainingDashboard === 'function') updateTrainingDashboard();
            if (typeof updateQuizButtons === 'function') updateQuizButtons();
            if (typeof updateAdminDashboard === 'function') updateAdminDashboard();
            if (typeof syncQuizProgressFromServer === 'function') syncQuizProgressFromServer();
        }

        // ページ読み込み時のチェック
        const savedUser = getCurrentUser();
        if (savedUser) {
            showUserInfo(savedUser);
        } else {
            loginOverlay.classList.add('active');
        }

        // 最終更新日を表示（手動更新）
        document.getElementById('lastUpdate').textContent = '2026/2/24';

        // ハンバーガーメニュー
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        menuToggle.addEventListener('click', function() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('active');
        });

        sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            sidebarOverlay.classList.remove('active');
        });

        // サイドバー内のリンクをクリックしたらメニューを閉じる（モバイル時）
        function closeMobileMenu() {
            if (window.innerWidth <= 640) {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('active');
            }
        }

        // セクション管理（使い方ガイドを除外）
        const sections = document.querySelectorAll('main > section:not(.usage-guide-section):not([hidden])');
        const usageGuide = document.getElementById('usage-guide');
        const quickAccess = document.getElementById('quick-access');
        const navList = document.getElementById('navList');
        let activeSection = null;

        // ページ送りボタン
        const pageNav = document.getElementById('pageNav');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const prevSectionButton = document.getElementById('prevSectionButton');
        const nextSectionButton = document.getElementById('nextSectionButton');

        // 全セクションのh3を順番にフラットなリストで管理
        // 各要素: { h3Id, sectionId }
        let navItems = [];
        let currentNavIndex = -1;

        // 閲覧履歴スタック（戻る・次へボタン用）
        let navHistory = [];
        let navForward = [];

        function buildNavItems() {
            navItems = [];
            sections.forEach(section => {
                const sectionId = section.getAttribute('id');
                const h3List = section.querySelectorAll('h3');
                if (h3List.length === 0) {
                    // h3がないセクションはセクション自体を1項目とする
                    navItems.push({ h3Id: null, sectionId: sectionId });
                } else {
                    h3List.forEach(h3 => {
                        const h3Id = h3.getAttribute('id');
                        navItems.push({ h3Id: h3Id, sectionId: sectionId });
                    });
                }
            });
        }

        function findNavIndex(sectionId, h3Id) {
            if (h3Id) {
                const idx = navItems.findIndex(item => item.h3Id === h3Id);
                if (idx !== -1) return idx;
            }
            // セクションの最初の項目を返す
            return navItems.findIndex(item => item.sectionId === sectionId);
        }

        function updatePageNav() {
            if (!activeSection) {
                pageNav.style.display = 'none';
                return;
            }
            pageNav.style.display = 'flex';
            prevButton.disabled = (navHistory.length === 0);
            nextButton.disabled = (navForward.length === 0);
            prevSectionButton.disabled = (currentNavIndex <= 0);
            nextSectionButton.disabled = (currentNavIndex >= navItems.length - 1);
        }

        function navigateTo(index, addHistory = true) {
            if (index < 0 || index >= navItems.length) return;
            // 現在位置を履歴に記録
            if (addHistory && currentNavIndex >= 0) {
                navHistory.push({ navIndex: currentNavIndex, scrollY: window.scrollY });
                navForward = []; // 新しい操作をしたら進む履歴をクリア
            }
            const item = navItems[index];
            currentNavIndex = index;

            // 別セクションなら切り替え
            if (activeSection !== item.sectionId) {
                showSection(item.sectionId, false);
            }

            // サブメニューのアクティブ状態を更新
            updateSubMenuActive(item.h3Id);

            // h3にスクロール
            if (item.h3Id) {
                setTimeout(() => {
                    const target = document.getElementById(item.h3Id);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 50);
            } else {
                const sec = document.getElementById(item.sectionId);
                if (sec) sec.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            updatePageNav();
        }

        // サブメニューのアクティブ状態を更新する関数
        function updateSubMenuActive(h3Id) {
            document.querySelectorAll('#navList .sub-menu a').forEach(l => l.classList.remove('active'));
            if (h3Id) {
                const subLink = document.querySelector('#navList .sub-menu a[data-target="' + h3Id + '"]');
                if (subLink) {
                    subLink.classList.add('active');
                    scrollSidebarToActive(subLink);
                }
            }
        }

        // サイドバーをスクロールしてアクティブ項目を表示する
        function scrollSidebarToActive(el) {
            if (!el) return;
            const navListEl = document.getElementById('navList');
            const elRect = el.getBoundingClientRect();
            const listRect = navListEl.getBoundingClientRect();
            // 要素がnavListの表示範囲外なら、スクロールして見える位置に移動
            if (elRect.top < listRect.top || elRect.bottom > listRect.bottom - 10) {
                const scrollTarget = el.offsetTop - navListEl.offsetTop - 40;
                navListEl.scrollTo({ top: scrollTarget, behavior: 'smooth' });
            }
        }

        prevButton.addEventListener('click', function() {
            if (navHistory.length > 0) {
                // 現在位置を進む履歴に記録
                navForward.push({ navIndex: currentNavIndex, scrollY: window.scrollY });
                const prev = navHistory.pop();
                currentNavIndex = prev.navIndex;
                const item = navItems[currentNavIndex];
                if (item && activeSection !== item.sectionId) {
                    showSection(item.sectionId, false);
                }
                updateSubMenuActive(item ? item.h3Id : null);
                setTimeout(() => { window.scrollTo({ top: prev.scrollY, behavior: 'smooth' }); }, 50);
                updatePageNav();
            }
        });

        nextButton.addEventListener('click', function() {
            if (navForward.length > 0) {
                // 現在位置を戻る履歴に記録
                navHistory.push({ navIndex: currentNavIndex, scrollY: window.scrollY });
                const fwd = navForward.pop();
                currentNavIndex = fwd.navIndex;
                const item = navItems[currentNavIndex];
                if (item && activeSection !== item.sectionId) {
                    showSection(item.sectionId, false);
                }
                updateSubMenuActive(item ? item.h3Id : null);
                setTimeout(() => { window.scrollTo({ top: fwd.scrollY, behavior: 'smooth' }); }, 50);
                updatePageNav();
            }
        });

        prevSectionButton.addEventListener('click', function() {
            if (currentNavIndex > 0) {
                navigateTo(currentNavIndex - 1);
            }
        });

        nextSectionButton.addEventListener('click', function() {
            if (currentNavIndex < navItems.length - 1) {
                navigateTo(currentNavIndex + 1);
            }
        });

        // カテゴリ定義
        const categories = [
            { key: 'change', label: '3/1～変更点まとめ', color: '#1976D2' },
            { key: 'studygo', label: 'スタディGO', color: '#4CAF50' },
            { key: 'cafe', label: '勉強カフェ', color: '#BDBDBD', disabled: true },
            { key: 'staff', label: 'スタッフマニュアル', color: '#BDBDBD', disabled: true },
        ];

        // コンテキストバー（大項目・中項目の固定表示）
        const contextBar = document.getElementById('contextBar');
        const contextCategory = document.getElementById('contextCategory');
        const contextSection = document.getElementById('contextSection');
        const contextH3 = document.getElementById('contextH3');
        const contextH3Sep = document.getElementById('contextH3Sep');

        function updateContextBar(sectionId, h3Id) {
            if (!sectionId) {
                contextBar.style.display = 'none';
                return;
            }
            const section = document.getElementById(sectionId);
            if (!section) {
                contextBar.style.display = 'none';
                return;
            }
            const catKey = section.getAttribute('data-category');
            const cat = categories.find(c => c.key === catKey);
            const h2 = section.querySelector('h2');
            if (cat && h2) {
                contextCategory.textContent = cat.label;
                contextCategory.style.backgroundColor = cat.color;
                contextSection.textContent = h2.textContent;
                contextBar.style.display = 'flex';
                // h3名の表示
                if (h3Id) {
                    const h3El = document.getElementById(h3Id);
                    if (h3El) {
                        contextH3.textContent = h3El.textContent;
                        contextH3.style.display = '';
                        contextH3Sep.style.display = '';
                        return;
                    }
                }
                contextH3.style.display = 'none';
                contextH3Sep.style.display = 'none';
            } else {
                contextBar.style.display = 'none';
            }
        }

        // 動的に目次を生成（カテゴリ対応）
        function generateNavigation() {
            navList.innerHTML = '';

            // 中項目用アルファベット配列
            const alphaLabels = 'abcdefghijklmnopqrstuvwxyz';
            // 小項目用丸数字配列
            const circleNums = ['①','②','③','④','⑤','⑥','⑦','⑧','⑨','⑩','⑪','⑫','⑬','⑭','⑮','⑯','⑰','⑱','⑲','⑳'];

            categories.forEach((cat, catIdx) => {
                const catNum = catIdx + 1; // 1, 2, 3
                // カテゴリヘッダー
                const catLi = document.createElement('li');
                catLi.className = 'nav-category';
                const catHeader = document.createElement('div');
                catHeader.className = 'nav-category-header';
                catHeader.setAttribute('data-cat', cat.key);
                catHeader.style.borderLeftColor = cat.color;
                if (cat.disabled) {
                    catHeader.innerHTML = '<span class="cat-toggle" style="color:#BDBDBD;">&#9654;</span> ' + catNum + '. ' + cat.label + ' <span style="font-size:0.75rem; color:#9E9E9E; font-weight:normal;">（今後実施予定）</span>';
                    catHeader.style.color = '#BDBDBD';
                    catHeader.style.cursor = 'default';
                    catLi.appendChild(catHeader);
                    navList.appendChild(catLi);
                    return; // このカテゴリのセクション一覧は表示しない
                }
                catHeader.innerHTML = '<span class="cat-toggle">&#9654;</span> ' + catNum + '. ' + cat.label;
                catLi.appendChild(catHeader);

                const catList = document.createElement('ul');
                catList.className = 'nav-category-list';
                catList.setAttribute('data-cat-list', cat.key);

                // このカテゴリに属するセクションを追加
                let sectionIdx = 0;
                sections.forEach(section => {
                    if (section.getAttribute('data-category') !== cat.key) return;
                    const sectionLetter = alphaLabels[sectionIdx] || String(sectionIdx + 1);
                    sectionIdx++;
                    const sectionId = section.getAttribute('id');
                    const h2 = section.querySelector('h2');
                    if (!h2) return;

                    // h2に番号を挿入（例: "a. "）
                    const h2NumSpan = document.createElement('span');
                    h2NumSpan.className = 'section-num';
                    h2NumSpan.textContent = sectionLetter + '. ';
                    h2.insertBefore(h2NumSpan, h2.firstChild);

                    const sectionTitle = h2.textContent;
                    const li = document.createElement('li');
                    const mainLink = document.createElement('a');
                    mainLink.href = '#' + sectionId;
                    mainLink.setAttribute('data-section', sectionId);
                    mainLink.textContent = sectionTitle;
                    if (section.hasAttribute('data-modified')) {
                        mainLink.style.color = '#C62828';
                        mainLink.style.fontWeight = 'bold';
                    }
                    li.appendChild(mainLink);

                    // h3サブメニュー
                    const h3List = section.querySelectorAll('h3');
                    if (h3List.length > 0) {
                        const subMenu = document.createElement('ul');
                        subMenu.className = 'sub-menu';

                        h3List.forEach((h3, index) => {
                            const h3Num = circleNums[index] || ('(' + (index + 1) + ')'); // ①②③...
                            let h3Id = h3.getAttribute('id');
                            if (!h3Id) {
                                h3Id = sectionId + '-item-' + index;
                                h3.setAttribute('id', h3Id);
                            }

                            // h3に番号を挿入（block-labelスパンがある場合はその後に）
                            const h3NumSpan = document.createElement('span');
                            h3NumSpan.className = 'section-num';
                            h3NumSpan.textContent = h3Num + ' ';
                            const firstChild = h3.firstChild;
                            if (firstChild && firstChild.nodeType === 1 && firstChild.classList.contains('block-label')) {
                                // block-labelの後に挿入
                                firstChild.after(h3NumSpan);
                            } else {
                                h3.insertBefore(h3NumSpan, firstChild);
                            }

                            const subLi = document.createElement('li');
                            const subLink = document.createElement('a');
                            subLink.href = '#' + h3Id;
                            subLink.setAttribute('data-target', h3Id);
                            subLink.setAttribute('data-parent-section', sectionId);
                            subLink.textContent = h3.textContent;
                            subLi.appendChild(subLink);
                            subMenu.appendChild(subLi);
                        });

                        li.appendChild(subMenu);
                    }

                    catList.appendChild(li);
                });

                catLi.appendChild(catList);
                navList.appendChild(catLi);

                // カテゴリヘッダーのクリックで開閉
                if (cat.disabled) return; // 無効カテゴリはイベント登録しない
                catHeader.addEventListener('click', function() {
                    const isOpen = catList.classList.contains('open');
                    // 全カテゴリを閉じる
                    document.querySelectorAll('.nav-category-list').forEach(cl => cl.classList.remove('open'));
                    document.querySelectorAll('.nav-category-header').forEach(ch => ch.classList.remove('active'));
                    // クリックしたカテゴリだけ開く
                    if (!isOpen) {
                        catList.classList.add('open');
                        catHeader.classList.add('active');
                    }
                });
            });

            // イベントリスナーを設定
            setupNavEventListeners();
        }

        // ナビゲーションのイベントリスナー設定
        function setupNavEventListeners() {
            // メインセクションリンク（カテゴリリスト内）- トグル対応
            document.querySelectorAll('#navList .nav-category-list a[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    const subMenu = this.parentElement.querySelector('.sub-menu');

                    // 既にアクティブなセクションの場合、サブメニューをトグル
                    if (activeSection === sectionId && subMenu) {
                        subMenu.classList.toggle('open');
                        closeMobileMenu();
                        return;
                    }

                    showSection(sectionId);
                });
            });

            // サブメニューリンク（h3への直接ジャンプ）
            document.querySelectorAll('#navList .sub-menu a[data-target]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-target');
                    const parentSectionId = this.getAttribute('data-parent-section');

                    // まず親セクションを表示
                    showSection(parentSectionId, false);

                    // サブメニューのアクティブ状態を更新
                    updateSubMenuActive(targetId);

                    // ナビインデックスを更新（履歴も記録）
                    const newIdx = findNavIndex(parentSectionId, targetId);
                    if (currentNavIndex >= 0 && currentNavIndex !== newIdx) {
                        navHistory.push({ navIndex: currentNavIndex, scrollY: window.scrollY });
                        navForward = [];
                    }
                    currentNavIndex = newIdx;
                    updatePageNav();

                    // ターゲットにスクロール
                    setTimeout(() => {
                        const target = document.getElementById(targetId);
                        if (target) {
                            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 100);
                });
            });
        }

        // セクションを表示する関数
        function showSection(sectionId, scroll = true) {
            const targetSection = document.getElementById(sectionId);
            if (!targetSection) return;

            // 使い方ガイドを非表示にする
            if (usageGuide) usageGuide.style.display = 'none';
            if (quickAccess) quickAccess.style.display = 'none';

            // 全てのセクションを非表示
            sections.forEach(s => s.classList.add('collapsed'));

            // クリックしたセクションを表示
            targetSection.classList.remove('collapsed');
            activeSection = sectionId;

            // アクティブリンクを更新（大項目・小項目ともにリセット）
            document.querySelectorAll('.nav-category-list a').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('#navList .sub-menu a').forEach(l => l.classList.remove('active'));
            const activeLink = document.querySelector('#navList a[data-section="' + sectionId + '"]');
            if (activeLink) activeLink.classList.add('active');

            // 該当するカテゴリを自動展開
            const category = targetSection.getAttribute('data-category');
            if (category) {
                document.querySelectorAll('.nav-category-list').forEach(cl => cl.classList.remove('open'));
                document.querySelectorAll('.nav-category-header').forEach(ch => ch.classList.remove('active'));
                const catList = document.querySelector('.nav-category-list[data-cat-list="' + category + '"]');
                const catHeader = document.querySelector('.nav-category-header[data-cat="' + category + '"]');
                if (catList) catList.classList.add('open');
                if (catHeader) catHeader.classList.add('active');
            }

            // サブメニューの表示切替：選択された大項目のサブメニューのみ表示
            document.querySelectorAll('#navList .sub-menu').forEach(sm => sm.classList.remove('open'));
            if (activeLink) {
                const subMenu = activeLink.parentElement.querySelector('.sub-menu');
                if (subMenu) subMenu.classList.add('open');
                // サイドバーをスクロールしてアクティブ項目を表示
                scrollSidebarToActive(activeLink);
            }

            // スクロール
            if (scroll) {
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // モバイルメニューを閉じる
            closeMobileMenu();

            // コンテキストバーを更新
            updateContextBar(sectionId);

            // ページ送りボタンの表示更新（履歴も記録）
            const newIndex = findNavIndex(sectionId, null);
            if (currentNavIndex >= 0 && currentNavIndex !== newIndex) {
                navHistory.push({ navIndex: currentNavIndex, scrollY: 0 });
                navForward = [];
            }
            currentNavIndex = newIndex;
            updatePageNav();
        }

        // 初期状態：全セクションを非表示
        sections.forEach(section => {
            section.classList.add('collapsed');
        });

        // 目次を生成
        generateNavigation();

        // h3単位のナビリストを構築
        buildNavItems();

        // TOP画面へボタン
        document.getElementById('topButton').addEventListener('click', function() {
            // 全セクションを非表示
            sections.forEach(s => s.classList.add('collapsed'));
            activeSection = null;
            // 使い方ガイドとクイックアクセスを表示
            if (usageGuide) usageGuide.style.display = '';
            if (quickAccess) quickAccess.style.display = '';
            contextBar.style.display = 'none';
            // サイドバーのアクティブ状態をリセット
            document.querySelectorAll('.nav-category-list a').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('#navList .sub-menu a').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('#navList .sub-menu').forEach(sm => sm.classList.remove('open'));
            // ページトップにスクロール
            window.scrollTo({ top: 0, behavior: 'smooth' });
            // ページ送りを非表示
            pageNav.style.display = 'none';
            closeMobileMenu();
        });

        // クイックアクセスリンク対応
        document.querySelectorAll('.quick-link-item[data-quick-section]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const sectionId = this.getAttribute('data-quick-section');
                const h3Text = this.getAttribute('data-quick-h3');
                showSection(sectionId, false);

                // h3テキストに一致する要素を探してスクロール
                if (h3Text) {
                    const section = document.getElementById(sectionId);
                    if (section) {
                        const h3List = section.querySelectorAll('h3');
                        for (const h3 of h3List) {
                            if (h3.textContent.trim() === h3Text || h3.textContent.trim().includes(h3Text)) {
                                const h3Id = h3.getAttribute('id');
                                if (h3Id) {
                                    updateSubMenuActive(h3Id);
                                    currentNavIndex = findNavIndex(sectionId, h3Id);
                                    updatePageNav();
                                }
                                setTimeout(() => {
                                    h3.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }, 100);
                                break;
                            }
                        }
                    }
                }
            });
        });

        // 本文中のセクションリンク対応
        document.addEventListener('click', function(e) {
            const link = e.target.closest('.section-link[data-link-section]');
            if (link) {
                e.preventDefault();
                const targetSection = link.getAttribute('data-link-section');
                const targetH3Text = link.getAttribute('data-link-h3');
                showSection(targetSection, !targetH3Text);
                // h3指定がある場合はそのh3にスクロール
                if (targetH3Text) {
                    const section = document.getElementById(targetSection);
                    if (section) {
                        const h3List = section.querySelectorAll('h3');
                        for (const h3 of h3List) {
                            if (h3.textContent.trim() === targetH3Text || h3.textContent.trim().includes(targetH3Text)) {
                                setTimeout(() => {
                                    h3.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }, 100);
                                break;
                            }
                        }
                    }
                }
            }
        });

        // ハイライトを削除する関数
        function removeHighlights() {
            document.querySelectorAll('.search-highlight').forEach(el => {
                const parent = el.parentNode;
                parent.replaceChild(document.createTextNode(el.textContent), el);
                parent.normalize();
            });
        }

        // テキストをハイライトする関数
        function highlightText(element, query) {
            const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);
            const textNodes = [];
            while (walker.nextNode()) {
                textNodes.push(walker.currentNode);
            }

            textNodes.forEach(node => {
                const text = node.textContent;
                const lowerText = text.toLowerCase();
                const index = lowerText.indexOf(query.toLowerCase());

                if (index !== -1 && node.parentNode.tagName !== 'SCRIPT' && node.parentNode.tagName !== 'STYLE' && !node.parentNode.closest('svg')) {
                    const before = text.substring(0, index);
                    const match = text.substring(index, index + query.length);
                    const after = text.substring(index + query.length);

                    const fragment = document.createDocumentFragment();
                    if (before) fragment.appendChild(document.createTextNode(before));

                    const highlight = document.createElement('span');
                    highlight.className = 'search-highlight';
                    highlight.textContent = match;
                    fragment.appendChild(highlight);

                    if (after) fragment.appendChild(document.createTextNode(after));

                    node.parentNode.replaceChild(fragment, node);
                }
            });
        }

        // 検索クリアボタン
        const searchInput = document.getElementById('searchInput');
        const searchClear = document.getElementById('searchClear');

        function updateClearButton() {
            if (searchInput.value.trim() !== '') {
                searchClear.classList.add('visible');
            } else {
                searchClear.classList.remove('visible');
            }
        }

        searchClear.addEventListener('click', function() {
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input'));
            searchInput.focus();
        });

        // 検索機能
        searchInput.addEventListener('input', function() {
            updateClearButton();
            const query = this.value.trim();

            // 既存のハイライトを削除
            removeHighlights();

            if (query === '') {
                // 検索クリア時は全セクションを非表示に戻し、使い方ガイドを再表示
                sections.forEach(section => {
                    section.classList.add('collapsed');
                });
                if (usageGuide) usageGuide.style.display = '';
                if (quickAccess) quickAccess.style.display = '';
                contextBar.style.display = 'none';
                // カテゴリ・目次を全て表示、サブメニュー・カテゴリリストは閉じる
                document.querySelectorAll('.nav-category').forEach(c => c.style.display = '');
                document.querySelectorAll('.nav-category-list > li').forEach(li => li.style.display = '');
                document.querySelectorAll('.nav-category-list').forEach(cl => cl.classList.remove('open'));
                document.querySelectorAll('.nav-category-header').forEach(ch => ch.classList.remove('active'));
                document.querySelectorAll('#navList .sub-menu').forEach(sm => sm.classList.remove('open'));
                return;
            }

            // 検索中は使い方ガイドを非表示
            if (usageGuide) usageGuide.style.display = 'none';
            if (quickAccess) quickAccess.style.display = 'none';

            // サブメニューを一旦すべて閉じる
            document.querySelectorAll('#navList .sub-menu').forEach(sm => sm.classList.remove('open'));

            // ヒットしたカテゴリを追跡
            const hitCategories = new Set();

            // 無効カテゴリのキーを取得
            const disabledCats = categories.filter(c => c.disabled).map(c => c.key);

            // 検索実行：セクションとナビゲーション両方をフィルタリング
            sections.forEach(section => {
                const text = section.textContent.toLowerCase();
                const sectionId = section.getAttribute('id');
                const category = section.getAttribute('data-category');
                const navItem = document.querySelector('#navList a[data-section="' + sectionId + '"]');
                const parentLi = navItem ? navItem.closest('.nav-category-list > li') : null;

                // 無効カテゴリのセクションは常に非表示
                if (disabledCats.includes(category)) {
                    section.classList.add('collapsed');
                    if (parentLi) parentLi.style.display = 'none';
                    return;
                }

                if (text.includes(query.toLowerCase())) {
                    section.classList.remove('collapsed');
                    if (category) hitCategories.add(category);
                    if (parentLi) {
                        parentLi.style.display = '';
                        const subMenu = parentLi.querySelector('.sub-menu');
                        if (subMenu) subMenu.classList.add('open');
                    }
                    highlightText(section, query);
                } else {
                    section.classList.add('collapsed');
                    if (parentLi) parentLi.style.display = 'none';
                }
            });

            // ヒットしたカテゴリのみ展開表示
            document.querySelectorAll('.nav-category').forEach(cat => {
                const catList = cat.querySelector('.nav-category-list');
                const catHeader = cat.querySelector('.nav-category-header');
                const catKey = catHeader ? catHeader.getAttribute('data-cat') : '';
                if (hitCategories.has(catKey)) {
                    cat.style.display = '';
                    if (catList) catList.classList.add('open');
                    if (catHeader) catHeader.classList.add('active');
                } else {
                    cat.style.display = 'none';
                }
            });
        });

        // スクロール時のアクティブリンク更新（大項目＋小項目）
        window.addEventListener('scroll', () => {
            let current = '';
            let currentH3 = '';
            const scrollPos = scrollY + 130;

            sections.forEach(section => {
                if (!section.classList.contains('collapsed')) {
                    const sectionTop = section.offsetTop;
                    const sectionBottom = sectionTop + section.offsetHeight;

                    if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
                        current = section.getAttribute('id');

                        // このセクション内のh3を逆順にチェックして、現在位置のh3を特定
                        const h3List = section.querySelectorAll('h3[id]');
                        for (let i = h3List.length - 1; i >= 0; i--) {
                            const h3 = h3List[i];
                            const h3Top = h3.getBoundingClientRect().top + window.scrollY;
                            if (scrollPos >= h3Top) {
                                currentH3 = h3.getAttribute('id');
                                break;
                            }
                        }
                    }
                }
            });

            if (current) {
                document.querySelectorAll('.nav-category-list a[data-section]').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-section') === current) {
                        link.classList.add('active');
                        // スクロール時にサブメニューが閉じていたら自動で開く
                        const subMenu = link.parentElement.querySelector('.sub-menu');
                        if (subMenu && !subMenu.classList.contains('open')) {
                            document.querySelectorAll('#navList .sub-menu').forEach(sm => sm.classList.remove('open'));
                            subMenu.classList.add('open');
                        }
                    }
                });

                // 小項目のアクティブ状態を更新
                updateSubMenuActive(currentH3);

                // ナビインデックスも更新
                if (currentH3) {
                    const idx = findNavIndex(current, currentH3);
                    if (idx !== -1) currentNavIndex = idx;
                }

                // コンテキストバーにh3名も反映
                updateContextBar(current, currentH3);
            }
        });

        // ===================================
        // お知らせ確認機能
        // ===================================
        const managerNotice = document.getElementById('manager-notice');
        const trainingDashboard = document.getElementById('training-dashboard');
        const adminQuizDash = document.getElementById('admin-quiz-dashboard');

        function confirmNotice(btn, noticeId) {
            const user = getCurrentUser();
            if (!user) { alert('ログインしてください'); return; }
            // LocalStorageにユーザー別で確認済みを保存
            const key = 'studygo_notices_' + user;
            const confirmed = JSON.parse(localStorage.getItem(key) || '{}');
            confirmed[noticeId] = new Date().toISOString();
            localStorage.setItem(key, JSON.stringify(confirmed));
            // UIを更新
            const actions = btn.parentElement;
            actions.innerHTML = '<span class="notice-confirmed">&#10003; 確認済み</span>';
        }

        // 既に確認済みのお知らせを反映（ユーザー切り替え対応）
        function loadNoticeStatus() {
            const user = getCurrentUser();
            document.querySelectorAll('#noticeList .notice-actions[data-notice-id]').forEach(actionsEl => {
                const noticeId = actionsEl.dataset.noticeId;
                if (!user) {
                    actionsEl.innerHTML = '<button class="notice-confirm-btn" disabled style="opacity:0.5;cursor:default;">ログインしてください</button>';
                } else {
                    const key = 'studygo_notices_' + user;
                    const confirmedData = JSON.parse(localStorage.getItem(key) || '{}');
                    if (confirmedData[noticeId]) {
                        actionsEl.innerHTML = '<span class="notice-confirmed">&#10003; 確認済み</span>';
                    } else {
                        actionsEl.innerHTML = '<button class="notice-confirm-btn" onclick="confirmNotice(this, \'' + noticeId + '\')">確認しました</button>';
                    }
                }
            });
        }
        loadNoticeStatus();

        // ===================================
        // お知らせ表示制御（TOP: 最新1件のみ、テキスト省略）
        // ===================================
        const noticeListPage = document.getElementById('notice-list-page');
        const noticeListAll = document.getElementById('noticeListAll');
        // TOP画面のお知らせ：最新1件のみ表示（テキスト省略はCSSで処理）
        function initTopNotices() {
            const cards = document.querySelectorAll('#noticeList .notice-card');
            cards.forEach((card, idx) => {
                if (idx > 0) {
                    card.style.display = 'none'; // 2件目以降を非表示
                }
            });
        }
        initTopNotices();

        // お知らせ一覧ページを構築
        function buildNoticeListPage() {
            noticeListAll.innerHTML = '';
            const cards = document.querySelectorAll('#noticeList .notice-card');
            cards.forEach(card => {
                const clone = card.cloneNode(true);
                clone.style.display = ''; // 全件表示
                // 一覧ではテキスト省略を解除
                const textEl = clone.querySelector('.notice-text');
                if (textEl) {
                    textEl.classList.add('notice-text-full');
                }
                // 確認ボタンの状態を反映
                const actionsEl = clone.querySelector('.notice-actions');
                if (actionsEl) {
                    const noticeId = actionsEl.dataset.noticeId;
                    const user = getCurrentUser();
                    if (!user) {
                        actionsEl.innerHTML = '<button class="notice-confirm-btn" disabled style="opacity:0.5;cursor:default;">ログインしてください</button>';
                    } else {
                        const key = 'studygo_notices_' + user;
                        const confirmedData = JSON.parse(localStorage.getItem(key) || '{}');
                        if (confirmedData[noticeId]) {
                            actionsEl.innerHTML = '<span class="notice-confirmed">&#10003; 確認済み</span>';
                        } else {
                            actionsEl.innerHTML = '<button class="notice-confirm-btn" onclick="confirmNotice(this, \'' + noticeId + '\')">確認しました</button>';
                        }
                    }
                }
                noticeListAll.appendChild(clone);
            });
        }

        // 「他のお知らせを確認する」リンク
        document.getElementById('showAllNoticesLink').addEventListener('click', function(e) {
            e.preventDefault();
            // TOP要素をすべて非表示
            if (managerNotice) managerNotice.style.display = 'none';
            if (trainingDashboard) trainingDashboard.style.display = 'none';
            if (adminQuizDash) adminQuizDash.style.display = 'none';
            if (quickAccess) quickAccess.style.display = 'none';
            if (usageGuide) usageGuide.style.display = 'none';
            sections.forEach(s => s.classList.add('collapsed'));
            pageNav.style.display = 'none';
            // お知らせ一覧を表示
            buildNoticeListPage();
            noticeListPage.style.display = '';
            noticeListPage.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });

        // 「TOPに戻る」ボタン
        document.getElementById('backToTopFromNotices').addEventListener('click', function() {
            noticeListPage.style.display = 'none';
            if (managerNotice) managerNotice.style.display = '';
            if (trainingDashboard) trainingDashboard.style.display = '';
            if (adminQuizDash) updateAdminDashboard();
            if (quickAccess) quickAccess.style.display = '';
            if (usageGuide) usageGuide.style.display = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // showSection時にお知らせ・研修進捗・クイックアクセス・お知らせ一覧を非表示にする（既存関数の拡張）
        const originalShowSection = showSection;
        showSection = function(sectionId, scroll) {
            if (managerNotice) managerNotice.style.display = 'none';
            if (trainingDashboard) trainingDashboard.style.display = 'none';
            if (adminQuizDash) adminQuizDash.style.display = 'none';
            if (noticeListPage) noticeListPage.style.display = 'none';
            originalShowSection(sectionId, scroll);
        };

        // TOP画面ボタン拡張：お知らせと研修進捗を再表示
        const topButtonEl = document.getElementById('topButton');
        const originalTopClick = topButtonEl.onclick;
        topButtonEl.addEventListener('click', function() {
            if (managerNotice) managerNotice.style.display = '';
            if (trainingDashboard) trainingDashboard.style.display = '';
            if (adminQuizDash) updateAdminDashboard();
            if (noticeListPage) noticeListPage.style.display = 'none';
        });

        // 検索時にお知らせを非表示
        const origSearchInput = document.getElementById('searchInput');
        origSearchInput.addEventListener('input', function() {
            const q = this.value.trim();
            if (q !== '') {
                if (managerNotice) managerNotice.style.display = 'none';
                if (trainingDashboard) trainingDashboard.style.display = 'none';
                if (adminQuizDash) adminQuizDash.style.display = 'none';
                if (noticeListPage) noticeListPage.style.display = 'none';
            } else {
                if (managerNotice) managerNotice.style.display = '';
                if (trainingDashboard) trainingDashboard.style.display = '';
                if (adminQuizDash) updateAdminDashboard();
            }
        });

        // ===================================
        // クイズ検定システム
        // ===================================
        const quizData = {
            'bp-to-studygo': {
                title: 'スタディGO変更内容',
                questions: [
                    {
                        q: 'スタディGOでの支払い方法は？',
                        options: ['口座振替またはクレカ', '現金またはクレカ', 'クレジットカードのみ', '口座振替のみ'],
                        correct: 2,
                        explanation: 'スタディGOではクレジットカードのみです。口座振替は廃止されました。'
                    },
                    {
                        q: 'スタディGOでの入退室（解錠）方法は？',
                        options: ['Akerunアプリで解錠', 'スタディGOアプリで解錠', 'ICカードをかざす', 'スタッフに声をかける'],
                        correct: 1,
                        explanation: '入退室はスタディGOアプリで解錠します。Akerunは不要になりました。'
                    },
                    {
                        q: '超過料金の請求方法はどう変わった？',
                        options: ['翌月末に請求（変更なし）', '翌日に請求', 'スタッフが手動で請求', '即日自動決済（1分13円）'],
                        correct: 3,
                        explanation: 'BPアプリは翌月末請求でしたが、スタディGOは即日自動決済（1分あたり13円）です。'
                    },
                    {
                        q: '時間外利用について正しいものは？',
                        options: ['時間外利用は廃止された', '有人時間帯のみ利用可能（770円/h・即日決済）', '営業時間内すべて利用可能', '無人時間帯も追加料金なしで利用可能'],
                        correct: 1,
                        explanation: 'スタディGOでは有人時間帯のみ時間外利用が可能で、料金は770円/hの即日決済です。'
                    },
                    {
                        q: '入会時のプラン説明について、特に重要な注意点は？',
                        options: ['プラン変更は3か月に1回のみ可能', 'プラン選択はスタッフが管理画面で行う', 'プラン時間帯の前の無人時間は利用不可で、プラン選びなおしは翌月扱い', '全てのプランで24時間利用可能'],
                        correct: 2,
                        explanation: 'プラン時間帯の前の無人営業時間は利用できません（延長は可能）。入会後のプラン選びなおしは翌月扱いになるため、最初のプラン選択が非常に重要です。必ずお客様に説明してください。'
                    },
                    {
                        q: 'プラン変更・休会の申請について、BPアプリから変わった点は？',
                        options: ['10日ルールが新設された', 'スタッフ経由でしか申請できなくなった', '申請後の取り消しが完全にできなくなった', '変更は一切できなくなった'],
                        correct: 2,
                        explanation: 'BPアプリでは基本取り消し不可（例外あり）でしたが、スタディGOでは完全に取り消し不可になりました。10日ルール（毎月10日まで）・月1回の制限はBPアプリと同じです。'
                    },
                    {
                        q: 'チェックインの方法はどう変わった？',
                        options: ['受付の専用機器にQRをかざす（変更なし）', 'ICカードで打刻する方式に変更', 'アプリでQRコードを読み取る方式に変更', 'スタッフがチェックインを代行する'],
                        correct: 2,
                        explanation: 'BPアプリは受付の専用機器にQRをかざす方式でしたが、スタディGOではアプリでQRコードを読み取る方式に変わりました。'
                    },
                    {
                        q: '打刻修正について正しいものは？',
                        options: ['お客様自身では一切修正できない', '打刻修正は廃止された', 'スタッフが管理画面からいつでも修正可能', 'チェックイン時刻はチェックアウト前まで修正可、チェックアウト忘れは店舗コード入力'],
                        correct: 3,
                        explanation: 'チェックイン時刻の修正はチェックアウト前のみ可能です。チェックアウト忘れはアプリで店舗コードを入力して対応します。'
                    },
                    {
                        q: 'スタディGOで廃止されたサービスはどれ？',
                        options: ['月額プラン、見学予約、Lステップ', 'ドロップイン、ロッカー、休会', '時間制プラン、新宿エリアパス、即日アップグレード、時間外利用割引', 'オプション契約、プラン変更、入会手続き'],
                        correct: 2,
                        explanation: '時間制プラン・新宿エリアパス・即日アップグレード・会員様の時間外利用割引（550円）が廃止されました。時間外利用は770円/h統一です。'
                    },
                    {
                        q: '超過料金・時間外料金の返金対応について正しいものは？',
                        options: ['マネージャー判断で返金可能', 'お客様の申し出があれば返金する', '全額返金が原則', 'アプリの不具合でない限り返金は行わない'],
                        correct: 3,
                        explanation: 'チェックイン・チェックアウトはお客様の責任です。アプリの不具合でない限り返金は行いません。'
                    },
                    {
                        q: 'スタディGOでチェックイン忘れが起きにくい理由は？',
                        options: ['スタッフが毎回確認するため', 'チェックインしないとアプリで解錠できないため', '自動チェックイン機能があるため', 'ICカードで自動記録されるため'],
                        correct: 1,
                        explanation: 'スタディGOではQRコードを読み込んでチェックインした後に、アプリ上で施設の扉を解錠できる仕組みです。チェックインしないと入室できないため、チェックイン忘れはほぼ発生しません。'
                    },
                    {
                        q: 'ドロップイン（時間利用）の1日の最大料金は？',
                        options: ['2,200円', '3,300円', '5,500円', '上限なし'],
                        correct: 1,
                        explanation: 'ドロップイン（時間利用）は770円/時間で、1日最大3,300円です。'
                    },
                    {
                        q: '休会について正しいものは？',
                        options: ['年に2回まで可能', '店頭でGoogleフォーム回答が必要', 'アプリで申請するだけ（店頭不要）で月1回・取り消し不可', 'スタッフが管理画面で処理する'],
                        correct: 2,
                        explanation: '休会はアプリで10日までに申請するだけで完了します。店頭来店不要・スタッフ処理不要です。ただし月に1度しかできず、取り消し不可です。'
                    },
                    {
                        q: '入会時に必要なものとして正しいものは？',
                        options: ['現金・印鑑・身分証', '入会金（11,000円）・クレジットカード・スマートフォン・身分証', '銀行口座・印鑑・スマートフォン', '入会金（5,500円）・クレジットカード・身分証'],
                        correct: 1,
                        explanation: '入会には入会金11,000円（税込）、クレジットカード、スマートフォン、身分証（氏名・現住所記載）が必要です。当月日割り分と翌月分の月会費も必要です。'
                    },
                    {
                        q: 'ロッカー解約について正しいものは？',
                        options: ['店頭でGoogleフォーム回答が必要', 'アプリで申請可能（店頭不要）だが荷物撤去と鍵返却が必要', 'スタッフが管理画面で処理する', '解約は月末にのみ可能'],
                        correct: 1,
                        explanation: 'ロッカー解約はアプリから申請可能で店頭来店は不要です。ただし解約日までに荷物をすべて持ち帰り、鍵は受付に返却する必要があります。'
                    }
                ]
            },
            'procedures': {
                title: 'スタディGO対応フロー',
                questions: [
                    {
                        q: 'お客様がチェックアウトを忘れて退店した場合、どう案内する？',
                        options: ['翌日来店時にチェックアウトしてもらう', 'スタッフが管理画面からチェックアウトする', 'アプリ →「QR読取」→「QRが読み取れない場合」→ 店舗コード入力', '運営本部に連絡して対応を依頼する'],
                        correct: 2,
                        explanation: '店外からでもアプリで対応可能です。「QR読取」→「QRが読み取れない場合」→ 店舗コードを入力してチェックアウトします。チェックアウトするまで課金が継続します。'
                    },
                    {
                        q: 'チェックイン忘れのお客様への対応は？',
                        options: ['チェックインなしで利用を許可する', 'その場でチェックインしてもらい、管理画面「チェックイン実績」→「編集」で時刻修正', '一度退店してもらい再入店してもらう', '管理画面から代理チェックインする'],
                        correct: 1,
                        explanation: 'まずその場でチェックインしてもらい、管理画面「チェックイン実績」→「編集」でチェックイン時刻を修正します。'
                    },
                    {
                        q: '間違ってチェックアウトしてしまったお客様への対応は？',
                        options: ['管理画面からチェックアウトを削除する', 'そのまま利用を続けてもらう', 'スタッフがチェックアウトを取り消す', 'もう一度QRコードを読み取って再チェックインしてもらう'],
                        correct: 3,
                        explanation: '再度QRコードを読み取ってチェックインし直してもらいます。'
                    },
                    {
                        q: '見学当日にそのまま入会（即日入会）する場合のスタッフ操作は？',
                        options: ['管理画面「店舗管理」→「最短利用開始日」を0日に変更 → 契約後に1日に戻す', '管理画面から会員を手動登録する', '特に操作不要、お客様にアプリで登録してもらうだけ', '運営本部に電話して即日入会の許可を得る'],
                        correct: 0,
                        explanation: '管理画面「店舗管理」→ 編集で「最短利用開始日」を0日に変更し、契約完了後に必ず1日に戻します。チャットワークへの報告も必要です。'
                    },
                    {
                        q: '退会手続きについて正しいものは？',
                        options: ['Googleフォームに回答すれば退会が成立する', 'アプリから申請するだけで完了する', 'Googleフォーム回答＋スタッフが管理画面で10日21時までに処理（間に合わないと15日に自動請求）', '月末までに処理すればよい'],
                        correct: 2,
                        explanation: '退会は店頭でGoogleフォーム回答＋スタッフが管理画面で処理を完了して初めて成立します。10日21時までに間に合わないと15日にプランが自動請求され翌月も継続になります。'
                    },
                    {
                        q: '月額プラン会員が契約時間外に利用したい場合の対応は？',
                        options: ['スタッフがプランを一時変更する', '時間外利用は一切不可', 'ドロップイン（時間利用）として別途チェックインが必要', '追加料金なしでそのまま利用可能'],
                        correct: 2,
                        explanation: '契約時間外はドロップイン（時間利用）として別途チェックインが必要です。770円/時間で即日決済されます。'
                    },
                    {
                        q: 'ロッカー契約のお客様への案内で正しいものは？',
                        options: ['運営本部に申請が必要', 'アプリで契約後、ロッカー番号の決定は店頭で行う', 'すべてアプリで完結する', '店頭でGoogleフォームに記入してもらう'],
                        correct: 1,
                        explanation: 'ロッカーはアプリで契約（日割・即時決済）しますが、ロッカー番号の決定は店頭で行います。'
                    },
                    {
                        q: '休会中のお客様が再開を希望した場合、伝えるべき重要事項は？',
                        options: ['再開には店頭来店が必要', '翌月から無料で再開できる', '再開時に2か月分の決済が必要', '再開手数料5,000円が必要'],
                        correct: 2,
                        explanation: '休会からの再開には2か月分の決済が必要です。休会を申請される前に、この点をお客様にお伝えしておくことが重要です。'
                    },
                    {
                        q: 'お客様がプラン変更を希望された場合、必ず伝えるべきことは？',
                        options: ['スタッフが代わりに申請する', '変更手数料がかかる', '毎月10日までに申請が必要・月1回のみ・取り消し不可', '変更は翌月からしかできない'],
                        correct: 2,
                        explanation: '毎月10日までに申請が必要（10日ルール）、プラン変更・休会は月に1度しかできず、申請後の取り消しもできません。申請前にお客様へ十分に確認することが重要です。'
                    },
                    {
                        q: '管理画面ダッシュボードの「確認済み」ボタンについて正しい対応は？',
                        options: ['スタッフは押さない（マネージャーが対応完了後に操作する）', '確認したら必ず押す', '出勤時にすべて押す', '1日1回押す'],
                        correct: 0,
                        explanation: '「確認済み」ボタンはスタッフは絶対に押さないでください。押すとダッシュボードから項目が消え、未対応のまま見落とす原因になります。マネージャーが対応完了を確認した上で操作します。'
                    },
                    {
                        q: '見学予約が入った場合の正しい対応フローは？',
                        options: ['お客様が来店するまで待つ', 'メール通知確認 → 来店予約一覧で内容確認 → 「予約確定」に変更 → メッセージで確認連絡', '本部に報告して指示を待つ', 'すぐに「見学実施」に変更する'],
                        correct: 1,
                        explanation: '見学予約が入ったら、まず来店予約一覧で内容を確認し、ステータスを「予約確定」に変更します。その後メッセージでお客様に確認連絡を送ります。'
                    },
                    {
                        q: '店外で契約したお客様がダッシュボードに表示された場合の対応は？',
                        options: ['何もしなくてよい', 'メッセージで来店手続きの連絡を送る', '管理画面から契約を取り消す', '電話で連絡する'],
                        correct: 1,
                        explanation: '店外で契約したユーザーには、メッセージ機能で来店案内・手続き連絡を送ります。初回来店時に身分証確認やルール説明が必要です。'
                    },
                    {
                        q: '見学予約のお客様が来店しなかった場合、いつ「見学キャンセル」に変更する？',
                        options: ['予約時間になったらすぐ', '予約時間を30分過ぎても来店がなければ', '当日の営業終了後', '翌日に変更する'],
                        correct: 1,
                        explanation: '予約時間を30分過ぎても来店がなければ「見学キャンセル」に変更します。'
                    },
                    {
                        q: '新規入会があった場合に必ず行う報告は？',
                        options: ['本部にメールで報告', 'チャットワーク【入会情報】に会員番号と氏名を報告', 'Lステップで報告', '報告は不要'],
                        correct: 1,
                        explanation: '新規入会があった場合、チャットワークの【入会情報】に会員番号と氏名を報告します。'
                    },
                    {
                        q: 'ダッシュボードに「未返信のメッセージ」が表示された場合の対応は？',
                        options: ['翌日返信すればよい', '必ずその日のうちに返信する', 'マネージャーに報告して返信してもらう', '本部が対応するので放置'],
                        correct: 1,
                        explanation: '未返信のメッセージがあるお客様には、必ずその日のうちに返信してください。'
                    }
                ]
            },
            'bp-to-studygo-scenario': {
                title: '実践シナリオ',
                questions: [
                    {
                        q: '【例題】会員のAさんが「今日チェックアウトするの忘れてもう家に着いちゃったんですけど…」と電話してきました。どう案内しますか？',
                        options: ['「こちらで管理画面からチェックアウトしておきます」', '「アプリの"QR読取"→"QRが読み取れない場合"→店舗コードを入力してチェックアウトできます」', '「営業終了時に自動チェックアウトされるので大丈夫です」', '「明日来店時にチェックアウトしてください」'],
                        correct: 1,
                        explanation: '店外からでもアプリで対応可能です。店舗コード入力でチェックアウトできることを案内します。チェックアウトまで課金が継続するため、早めの対応を促してください。'
                    },
                    {
                        q: '【例題】初めて来店されたBさんが「1時間だけ使いたいんですけど」と言いました。スタディGOアプリは入れていないそうです。どう対応しますか？',
                        options: ['入店をお断りして帰ってもらう', '現金で受け付けて利用してもらう', 'スタディGO未登録者は受付不可のため、まずアプリ登録をご案内する', 'BPアプリで対応する'],
                        correct: 2,
                        explanation: 'スタディGO未登録者のドロップインは受付不可です。まずスタディGOアプリの登録をご案内し、登録後にドロップインとして利用いただけます。'
                    },
                    {
                        q: '【例題】平日プランのCさんが土曜17時に来店し「今日も使いたいんだけど」と言いました。どのパターンですか？',
                        options: ['プラン外の利用は一切不可', 'スタッフがプランを一時的に変更する', 'プラン時間内なので通常利用', 'プラン時間外なので、ドロップイン（時間利用）として別途チェックインが必要'],
                        correct: 3,
                        explanation: '平日プランの方が土曜に利用する場合はプラン時間外です。ドロップインとして別途チェックインし、770円/時間で即日決済されます。'
                    },
                    {
                        q: '【例題】Dさんが「来月からプランを変えたいんですけど」と12日に相談してきました。どう案内しますか？',
                        options: ['「プラン変更はできません」', '「申請は毎月10日までなので、今月はもう間に合いません。来月10日までに申請すれば再来月から変更になります」', '「今すぐアプリで申請してください、来月から変わります」', '「スタッフが代わりに申請します」'],
                        correct: 1,
                        explanation: 'プラン変更は毎月10日までに申請が必要です。12日では当月の締めに間に合わないため、来月10日までの申請で再来月からの変更になります。月1回・取り消し不可もお伝えしましょう。'
                    },
                    {
                        q: '【例題】見学に来たEさんが「気に入ったので今日から使いたい！」と言いました。スタッフは何をしますか？',
                        options: ['翌日からの利用を案内する', '本部に電話して許可をもらう', '管理画面「店舗管理」→「最短利用開始日」を0日に変更 → 契約後に1日に戻す → チャットワーク報告', 'お客様にアプリで登録してもらうだけ'],
                        correct: 2,
                        explanation: '即日入会の場合、管理画面で「最短利用開始日」を0日に一時変更し、契約完了後に必ず1日に戻します。チャットワークへの報告も忘れずに。'
                    },
                    {
                        q: '【例題】会員のFさんが「ロッカーを解約したいんですけど、鍵をなくしてしまって…」と来店しました。どう対応しますか？',
                        options: ['「鍵の紛失なので解約はできません」', '「アプリで解約申請していただけます。荷物は解約日までにお持ち帰りください。鍵紛失の場合は再発行手数料3,300円がかかります」', '「無料で鍵を再発行しますのでお待ちください」', '「本部に連絡して対応を確認します」'],
                        correct: 1,
                        explanation: 'ロッカー解約はアプリで申請できます。鍵の紛失・破損時は再発行手数料3,300円が必要です。荷物は解約日までにすべて持ち帰り、残置物がある場合は翌月分請求の可能性があります。'
                    },
                    {
                        q: '【例題】Gさんが「退会したいです」と20時に来店しました。今日は9日です。どう対応しますか？',
                        options: ['電話で本部に連絡する', '「アプリで申請できますのでご自分でお願いします」', '店頭でGoogleフォームに回答してもらい、スタッフが管理画面で退会処理を行う', '「明日また来てください」'],
                        correct: 2,
                        explanation: '退会は店頭でGoogleフォームに回答してもらい、スタッフが管理画面で処理を完了させます。10日21時までに処理しないと自動請求で翌月継続になるため、今日中に処理を完了させます。'
                    },
                    {
                        q: '【例題】Hさんが「今月は休会したい」と8日に連絡してきました。どう案内しますか？',
                        options: ['「スタッフが代わりに処理します」', '「休会は受け付けていません」', '「アプリから休会申請してください。10日までなので間に合います。店頭来店は不要です」', '「店頭に来てGoogleフォームに回答してください」'],
                        correct: 2,
                        explanation: '休会はアプリで10日までに申請するだけで完了します。店頭来店不要・スタッフ手続きなしです。ただし再開時には2か月分の決済が必要であることもお伝えしましょう。'
                    },
                    {
                        q: '【例題】ナイトプランのIさんが20時50分に「もう少しだけ勉強したい」と言っています。有人時間は21時までです。どうなりますか？',
                        options: ['プラン時間内なら延長可能。ただし超過すると1分13円が即日自動決済される', '21時で強制チェックアウトされる', 'スタッフが許可すれば無料で延長できる', '延長は一切できない'],
                        correct: 0,
                        explanation: 'プラン時間内であれば延長は可能ですが、プラン時間を超過すると1分あたり13円が即日自動決済されます。新規会員には特にこの点を説明しておくことが重要です。'
                    },
                    {
                        q: '【例題】Jさんが「領収書がほしいのですが」と言いました。どう案内しますか？',
                        options: ['「領収書は発行できません」', '本部に依頼する', '「決済ごとに電子領収書がメールで届きます。月の利用金額は翌月1日にまとめて発行も可能です」', '手書きで領収書を発行する'],
                        correct: 2,
                        explanation: 'スタディGOでは決済ごとに電子領収書がメールで自動送付されます。月の利用金額は翌月1日にまとめて発行することも可能です。スタッフの手書き対応は不要になりました。'
                    },
                    {
                        q: '【例題】15歳の高校生Kさんが入会を希望しています。どう案内しますか？',
                        options: ['「高校生はご利用いただけません」', '「利用時間は21時まで、保護者同意書が必要です」', '「18歳未満は入会できません」', '「保護者同伴でのみご利用いただけます」'],
                        correct: 1,
                        explanation: '15歳以上の現役高校生は利用可能ですが、利用時間は21時までで、保護者同意書が必要です。保護者一筆で22時までの利用も可能です。'
                    },
                    {
                        q: '【例題】新宿スタジオが混雑しています。お客様にどう案内しますか？',
                        options: ['「満席なのでお帰りください」', '「BPスタジオへの移動をお願いする場合があります」', '「立席でご利用ください」', '「翌日のご利用をお勧めします」'],
                        correct: 1,
                        explanation: '新宿スタジオ混雑時は、BPスタジオへの移動をお願いする場合があります。'
                    },
                    {
                        q: '【例題】見学予約が入り、ステータスは「△不明」です。次に何をしますか？',
                        options: ['お客様が来るまで待つ', 'ステータスを「予約確定」に変更し、メッセージでお客様に確認連絡を送る', '「見学実施」に変更する', '予約を削除する'],
                        correct: 1,
                        explanation: '「△不明」はデフォルトの仮予約状態です。内容を確認し「予約確定」に変更した上で、メッセージでお客様に確認連絡を送ります。'
                    },
                    {
                        q: '【例題】給茶機に「水を補給してください」と表示されています。どう対応しますか？',
                        options: ['電源を切って運営に連絡する', '新しい茶葉カートリッジに交換する', '水タンクに水を補充し、リセットボタンを押す', 'そのまま放置して運営連絡を待つ'],
                        correct: 2,
                        explanation: '「水を補給してください」は水タンクの水切れです。水を補充し、リセットボタンを押せば復旧します。'
                    },
                    {
                        q: '【例題】お客様から「Wi-Fiが繋がらない」と言われました。まず何をしますか？',
                        options: ['運営に連絡する', 'ルーターの電源を抜いて30秒後に再接続する', '「Wi-Fiは使えません」と案内する', 'LANケーブルを差し替える'],
                        correct: 1,
                        explanation: 'Wi-Fiが接続できない場合、まずルーターの電源を抜いて30秒後に再接続します。速度が遅い場合も同様にルーター再起動で改善する場合があります。'
                    },
                    {
                        q: '【例題】お客様の忘れ物を発見しました。保管期間は？',
                        options: ['1週間', '2週間保管後、処分', '1か月', '即日処分'],
                        correct: 1,
                        explanation: 'お忘れ物は2週間保管した後、処分となります。'
                    },
                    {
                        q: '【例題】会員Lさんが他の会員に保険の営業活動をしているのを発見しました。どう対応しますか？',
                        options: ['注意せず様子を見る', '退店・除名処分の対象であることを伝え、対応する', '次回から注意するよう伝える', '本人の自由なので放置する'],
                        correct: 1,
                        explanation: '他の方への営業活動（物品勧誘・セミナー・マルチ商法・宗教勧誘含む）は禁止です。発覚時は退店・除名処分の対象となります。'
                    },
                    {
                        q: '【例題】アプリで月額契約したMさんが初めて来店しました。スタッフは何を確認しますか？',
                        options: ['特に確認は不要', '身分証確認 → アプリ解錠確認 → 館内案内 → ルール説明', '入会金の現金支払い', '保証人の確認'],
                        correct: 1,
                        explanation: 'Web契約済み会員の初来店時は、本人確認（身分証）→ アプリ解錠確認 → 館内案内 → ルール説明を行います。'
                    },
                    {
                        q: '【例題】会員Nさんが「ロッカーを使いたい」と来店しました。対応の流れは？',
                        options: ['アプリで契約してもらうだけ', '空きロッカー確認 → ロッカー番号決定 → アプリでオプション契約 → 鍵の貸与と注意事項説明', 'Googleフォームに記入してもらう', '本部に申請して後日連絡する'],
                        correct: 1,
                        explanation: 'ロッカー新規契約は、空きロッカー確認 → 番号決定 → アプリで契約（日割・即時決済）→ 鍵の貸与と注意事項説明の流れです。'
                    },
                    {
                        q: '【例題】お客様から「Akerunで解錠できない」と連絡がありました。どう案内しますか？',
                        options: ['「スタッフが行くまで待ってください」', '「BluetoothがONか確認 → アプリ再起動 → それでもダメなら手動鍵で対応します」', '「本部に連絡してください」', '「別の入口から入ってください」'],
                        correct: 1,
                        explanation: 'Akerunで解錠できない場合は、Bluetooth/通信状況確認 → アプリ再起動を案内します。改善しない場合は手動鍵で対応します。'
                    }
                ]
            },
            'basic-info': {
                title: '基本情報・料金・ルール',
                questions: [
                    {
                        q: '勉強カフェの平日の営業時間は？',
                        options: ['7:00～22:00', '6:00～23:00', '8:00～22:00', '6:00～21:00'],
                        correct: 1,
                        explanation: '平日の営業時間は6:00～23:00です。土曜は6:00～22:00、日祝は6:00～21:00です。'
                    },
                    {
                        q: '平日の有人営業時間帯は？',
                        options: ['9:00～18:00', '12:00～21:00', '17:00～21:00', '10:00～22:00'],
                        correct: 2,
                        explanation: '平日の有人営業時間帯は17:00～21:00です。土日祝は12:00～21:00です。'
                    },
                    {
                        q: '勉強カフェの定期休業日は？',
                        options: ['毎週月曜日', '毎月第3日曜日', '年末年始（12/29～1/3）', 'お盆（8/13～8/16）'],
                        correct: 2,
                        explanation: '定期休業は年末年始（12/29～1/3）です。その他、年2回程度のメンテナンスデーがあります。'
                    },
                    {
                        q: 'ドロップイン（時間利用）の料金は？',
                        options: ['1時間550円', '1時間770円（1Day最大3,300円）', '1時間1,100円', '30分500円'],
                        correct: 1,
                        explanation: 'ドロップイン（時間利用）は1時間パック770円（税込）、1Day最大3,300円です。延長は1分13円です。'
                    },
                    {
                        q: '入会金はいくら？',
                        options: ['5,500円', '11,000円', '22,000円', '無料'],
                        correct: 1,
                        explanation: '入会金は11,000円（税込）です。他に当月日割り分と翌月分の月会費が必要です。'
                    },
                    {
                        q: '15歳以上の現役高校生の利用について正しいものは？',
                        options: ['利用不可', '利用時間は21時まで・保護者同意書が必要', '保護者同伴でのみ利用可', '制限なし（一般会員と同じ）'],
                        correct: 1,
                        explanation: '15歳以上の現役高校生は利用可能ですが、利用時間は21時までで、保護者同意書が必要です。'
                    },
                    {
                        q: '会員特典として白黒コピーが無料になる枚数は？',
                        options: ['5枚まで', '10枚まで', '20枚まで', '無制限'],
                        correct: 1,
                        explanation: '会員特典として白黒コピーは10枚まで無料です。それ以上は1枚10円です。'
                    },
                    {
                        q: '荷物を置いたまま離席できる上限時間は？',
                        options: ['30分', '1時間', '2時間', '制限なし'],
                        correct: 1,
                        explanation: '荷物を置いたままの離席は1時間までです。1時間以上の離席でスタッフが荷物を移動する場合があります。'
                    },
                    {
                        q: '施設内での喫煙について正しいものは？',
                        options: ['喫煙室あり', '電子タバコのみ可', '全面禁煙（電子タバコ含む）', 'エントランスで喫煙可'],
                        correct: 2,
                        explanation: '施設内は全面禁煙です。エントランスや手洗いも含め、電子タバコも同様に禁止です。'
                    },
                    {
                        q: '施設内での飲食ルールについて正しいものは？',
                        options: ['全エリアで食事可能', '食事はラウンジで、匂いの強い食べ物・カップ麺・アルコールは持ち込み不可', '飲食一切不可', 'ドリンクのみ可、食事は不可'],
                        correct: 1,
                        explanation: '食事はラウンジエリアで可能です。匂いの強いもの・カップ麺・アルコール類は持ち込みを遠慮いただいています。'
                    },
                    {
                        q: '無人時間帯の印刷機利用の支払い方法は？',
                        options: ['現金のみ', 'PayPayのみ', '各種キャッシュレス決済', '無料'],
                        correct: 1,
                        explanation: '無人時間帯の印刷機利用はPayPayのみです。有人時間帯は各種キャッシュレス決済（現金不可）です。'
                    },
                    {
                        q: 'BPスタジオのテルブースについて正しいものは？',
                        options: ['完全防音なので個人情報の会話も安心', '完全防音ではないため個人情報の取り扱いに注意、扉は閉めて利用', '予約制で利用する', '食事スペースとしても利用可能'],
                        correct: 1,
                        explanation: 'テルブースは完全防音ではないため、個人情報の取り扱いに注意が必要です。扉は閉めて利用し、食事は控えてください。'
                    },
                    {
                        q: '新宿スタジオの会議室（MTGルーム）の利用料金は？',
                        options: ['無料', '15分110円', '1時間550円', '30分220円'],
                        correct: 1,
                        explanation: '新宿スタジオの会議室は15分110円で利用可能です。WEBページからの予約制です。'
                    },
                    {
                        q: '無人時間帯にトラブルが発生した場合の連絡先は？',
                        options: ['メールのみ', 'スタディGOサポート（03-6302-0774）', '050-3199-1446（メール・Lステップも可）', '翌日の有人時間帯まで待つ'],
                        correct: 2,
                        explanation: '無人時間帯の緊急連絡先は050-3199-1446です。メールやLステップでも連絡可能です。'
                    },
                    {
                        q: '平日の混雑する時間帯は？',
                        options: ['12:00～15:00', '15:00～18:00', '18:00～21:00（特に19:00前後）', '6:00～9:00'],
                        correct: 2,
                        explanation: '平日は18:00～21:00（特に19:00前後）が混雑します。土日祝は13:00～17:00が混雑します。'
                    }
                ]
            },
            'admin-ops': {
                title: '管理画面操作',
                questions: [
                    {
                        q: '管理画面にログインする際、2段階認証で求められるものは？',
                        options: ['SMSで届く4桁のコード', 'メールアドレスに送られる6桁の番号', 'Google認証アプリのコード', 'スタッフPIN'],
                        correct: 1,
                        explanation: '管理画面ログインの2段階認証では、メールアドレスに送られてくる6桁の番号を入力します。'
                    },
                    {
                        q: 'スタディGOの管理画面「ID」と勉強カフェ「会員番号」の関係は？',
                        options: ['同じ番号', 'スタディGO固有のIDと勉強カフェの会員番号は別物', 'IDの頭にBCBPを付けたものが会員番号', '会員番号は廃止された'],
                        correct: 1,
                        explanation: 'スタディGOのIDは固有の番号で、勉強カフェの会員番号（BCBP○○/BCS○○）とは異なります。会員番号は契約時にメールで送付されます。'
                    },
                    {
                        q: '新規入会時、メールで届いた会員番号はどこに記録する？',
                        options: ['ノートに手書きする', '管理画面の該当会員のメモ欄に記入', 'チャットワークに投稿するだけ', 'スプレッドシートに記録する'],
                        correct: 1,
                        explanation: '新規入会時は、メールで届いた会員番号を管理画面の該当会員のメモ欄に記入します。併せてチャットワークへの報告も必要です。'
                    },
                    {
                        q: '即日入会後に「最短利用開始日」を0日のまま戻し忘れるとどうなる？',
                        options: ['翌日の入会者だけ影響がある', 'すべての新規契約者が即日利用開始可能になる', '特に問題は起きない', 'システムエラーが発生する'],
                        correct: 1,
                        explanation: '最短利用開始日を0日のまま放置すると、すべての新規契約者が即日利用開始可能になります。必ず契約完了後に1日に戻してください。'
                    },
                    {
                        q: 'チェックイン忘れの修正を管理画面で行う手順は？',
                        options: ['会員管理からチェックインを追加する', '「チェックイン実績」→ 当日日付で検索 → 該当ユーザーの「編集」→ 時刻修正', '「店舗管理」から修正する', 'ダッシュボードから直接修正する'],
                        correct: 1,
                        explanation: '「チェックイン実績」を開き、当日の日付で検索し、該当ユーザーの「編集」をクリックして正しい時刻に修正します。'
                    },
                    {
                        q: '昨日のチェックイン時刻を修正したい場合は？',
                        options: ['管理画面「チェックイン実績」から修正可能', '店舗側では修正できない', 'マネージャーだけが修正可能', '電話で本部に依頼する'],
                        correct: 1,
                        explanation: '別日のチェックイン修正は店舗側ではできません。同日のチェックイン忘れ修正のみ管理画面で対応可能です。'
                    },
                    {
                        q: '来店予約一覧でデフォルト表示されるステータスは？',
                        options: ['予約確定', '△不明（仮予約状態）', '見学実施', '予約キャンセル'],
                        correct: 1,
                        explanation: 'デフォルトでは「△不明（未確認）」で表示されます。仮予約状態のため、スタッフが「予約確定」に変更する対応が必要です。'
                    },
                    {
                        q: '管理画面の「月額会員向け」と「都度利用向け」の営業時間設定の関係は？',
                        options: ['連動している', '独立したカレンダーで連動しない（両方の変更が必要）', '都度利用は自動設定で変更不要', '同じ画面で設定する'],
                        correct: 1,
                        explanation: '「月額会員向け」と「都度利用向け」は独立したカレンダーのため連動しません。両方の設定を変更し、整合させる必要があります。'
                    },
                    {
                        q: '営業時間設定に関連する自動処理について正しいものは？',
                        options: ['営業終了時にすべて自動チェックアウト', '終了時間1分前にチェックイン中ユーザーの強制チェックアウトが行われる', '終了時間30分前に通知が送られる', '自動処理は行われない'],
                        correct: 1,
                        explanation: '設定した営業時間の終了時間1分前に、チェックイン中ユーザーの強制チェックアウトが行われます。'
                    },
                    {
                        q: '見学予約を「見学キャンセル」に変更するとどうなる？',
                        options: ['何も起きない', 'お客様にキャンセルメールが届く', 'お客様のアカウントが削除される', '自動で翌週に振り替えられる'],
                        correct: 1,
                        explanation: '「見学キャンセル」に変更すると、お客様にメールが届きます。予約時間を30分過ぎても来店がない場合にこのステータスに変更します。'
                    },
                    {
                        q: '見学予約カレンダーで「対応不明」にチェックを入れるとどうなる？',
                        options: ['見学予約が停止される', '「△対応不明」（仮予約）として表示される', '「◎見学可能」として表示される', 'エラーが表示される'],
                        correct: 1,
                        explanation: '「対応不明」にチェックを入れると「△対応不明」（仮予約）で表示されます。無人店舗は基本的にすべて「△対応不明」とする運用です。'
                    },
                    {
                        q: '管理画面からスタジオへのメール通知に含まれないものは？',
                        options: ['見学予約の通知', '月額プラン契約・解約の通知', 'お客様のアプリ利用履歴', 'お客様からのメッセージ受信通知'],
                        correct: 2,
                        explanation: 'メール通知には見学予約・契約/解約・プラン変更/休会・メッセージ受信等が含まれますが、お客様のアプリ利用履歴は通知されません。'
                    },
                    {
                        q: '月額会員向け営業時間設定について正しいものは？',
                        options: ['いつでも自由に変更してよい', '頻繁な変更は推奨しない（契約中ユーザーへの影響を考慮）', '月1回のみ変更可能', '変更は不可'],
                        correct: 1,
                        explanation: '頻繁な変更は推奨されません。現在提供中のプランとの干渉や、契約中ユーザーへの事前連絡が必要な場合があります。'
                    },
                    {
                        q: '管理画面のメッセージ機能を使う場面として正しくないものは？',
                        options: ['見学予約の確認連絡', '店外契約者への来店案内', '全会員への一斉告知', 'リスケ対応'],
                        correct: 2,
                        explanation: 'メッセージ機能は個別連絡に使用します。全会員への一斉告知には使用しません。'
                    },
                    {
                        q: 'ダッシュボードに「解約予定のお客様」が表示された場合の対応は？',
                        options: ['自動処理されるので放置', '店頭来店・フォーム入力＋スタッフの管理画面処理が必要', 'メッセージで引き止める', '本部に報告する'],
                        correct: 1,
                        explanation: '解約予定のお客様には、店頭来店・Googleフォーム入力＋スタッフが管理画面で処理を行う必要があります。10日21時までの処理が重要です。'
                    }
                ]
            },
            'staff-daily': {
                title: 'スタッフ日常業務',
                questions: [
                    {
                        q: '出勤時のAkerun設定で行うことは？',
                        options: ['オートロックをONにする', 'オートロック設定をOFFに変更する（有人時間帯）', 'Akerunの電源を切る', '特に操作は不要'],
                        correct: 1,
                        explanation: '有人時間帯はAkerunオートロック設定をOFFに変更します。退勤時にONに戻すことを忘れずに。'
                    },
                    {
                        q: 'OP作業でAkerun履歴を確認する時間帯と目的は？',
                        options: ['6:00～17:00の利用状況を確認', '22:00～5:00の不正利用チェック', '全時間帯の利用回数を集計', '前日の有人時間帯の確認'],
                        correct: 1,
                        explanation: '深夜（22:00～5:00）のAkerun履歴を確認し、不正利用がないかチェックします。'
                    },
                    {
                        q: 'ドリンクコーナーのOP作業に含まれないものは？',
                        options: ['コーヒーマシンの電源ON・水タンク確認', '紙コップ・マドラー等の補充', 'カウンター周りの拭き掃除', 'コーヒー豆の焙煎'],
                        correct: 3,
                        explanation: 'ドリンクコーナーOPは、コーヒーマシン電源ON・水タンク確認、給茶機の準備、紙コップ等の補充、ウォーターサーバー確認、カウンター清掃です。'
                    },
                    {
                        q: '退勤時にAkerun設定で忘れてはいけないことは？',
                        options: ['オートロック設定をONに戻す', 'Akerunの電源を切る', 'Akerunアプリを削除する', 'オートロックをOFFにする'],
                        correct: 0,
                        explanation: '退勤時はAkerunオートロック設定をONに戻します。忘れると無人時間帯にオートロックが効かなくなります。'
                    },
                    {
                        q: 'チャットワークでの退勤報告に含めるべき項目は？',
                        options: ['退勤時刻のみ', '退勤時刻・来店者数・特記事項（トラブル、忘れ物、備品不足等）', '来店者の氏名一覧', '売上金額'],
                        correct: 1,
                        explanation: '退勤報告には退勤時刻、来店者数、特記事項を含めます。新規入会があった場合はID・氏名も報告します。'
                    },
                    {
                        q: '清掃時に必ず行うべきことは？',
                        options: ['掃除機は無言で開始してよい', 'お客様に一声おかけしてから掃除機を開始する', 'お客様の荷物も移動して掃除する', '全エリアを一度に清掃する'],
                        correct: 1,
                        explanation: '掃除機をかける際は、お客様に一声おかけしてから作業を開始してください。お客様の荷物や持ち物には触れないでください。'
                    },
                    {
                        q: '火曜日の追加作業は？',
                        options: ['MTGルーム清掃', '観葉植物の水やり・状態チェック', 'シュレッダー処理', 'アスクル発注確認'],
                        correct: 1,
                        explanation: '火曜日は観葉植物の水やり・状態チェックが追加作業です。'
                    },
                    {
                        q: '給茶機に「茶葉を補給してください」と表示された場合の対応は？',
                        options: ['水タンクに水を補充する', '電源をリセットする', '新しい茶葉カートリッジに交換する', '運営に連絡する'],
                        correct: 2,
                        explanation: '「茶葉を補給してください」は茶葉カートリッジの残量不足です。新しい茶葉カートリッジに交換してください。'
                    },
                    {
                        q: 'コーヒー豆を補充すべきタイミングは？',
                        options: ['毎日必ず補充', '完全になくなってから', '残り1/4以下になったら補充', '週1回まとめて補充'],
                        correct: 2,
                        explanation: 'コーヒー豆は残り1/4以下になったら補充します。'
                    },
                    {
                        q: '電話対応の基本マナーとして正しいものは？',
                        options: ['5コール以内に出る', '3コール以内 → 名乗り → 用件確認 → メモ → 復唱確認', '1コール以内に出る', 'コール数は気にしなくてよい'],
                        correct: 1,
                        explanation: '電話対応の基本は、3コール以内に出る → 名乗り → 用件確認 → メモ → 復唱確認です。'
                    }
                ]
            },
            'equipment-trouble': {
                title: '設備・機器トラブル',
                questions: [
                    {
                        q: 'Wi-Fiの速度が遅い場合の対処法は？',
                        options: ['そのまま様子を見る', '接続端末数を確認し、ルーター再起動を試す', 'ルーターを交換する', '運営に連絡して新しいルーターを発注する'],
                        correct: 1,
                        explanation: 'Wi-Fiの速度が遅い場合は、接続端末数を確認し、ルーター再起動で改善する場合があります。'
                    },
                    {
                        q: 'エアコンが動かない場合の対処順序は？',
                        options: ['すぐに運営に連絡する', 'リモコンの電池確認 → ブレーカー確認 → 改善しなければ運営に連絡', '自分で修理する', 'そのまま放置する'],
                        correct: 1,
                        explanation: 'リモコンの電池確認 → ブレーカー確認の順で対処し、改善しなければ運営に連絡します。'
                    },
                    {
                        q: '給茶機のランプが赤く点滅した場合の対処は？',
                        options: ['水タンクに水を補充する', '茶葉カートリッジを交換する', '電源OFF → 30秒後に再起動 → 改善しなければ運営に連絡', '排水トレイの水を捨てる'],
                        correct: 2,
                        explanation: '赤ランプ点滅は内部エラーです。電源OFF → 30秒後に再起動し、改善しなければ運営に連絡してください。'
                    },
                    {
                        q: 'コーヒーサーバーから出るコーヒーが薄い場合に確認すべきことは？',
                        options: ['水タンクの水量', '豆の残量とグラインダーの詰まり', '電源プラグの接続', 'ミルクラインの洗浄'],
                        correct: 1,
                        explanation: 'コーヒーが薄い場合は、豆の残量を確認し、グラインダーの詰まりもチェックします。'
                    },
                    {
                        q: '印刷機で紙詰まりが発生した場合の対処は？',
                        options: ['電源を切って放置する', '表示に従い詰まった紙を除去し、前面・背面カバーを確認', '新しい印刷機に交換する', 'そのまま印刷を続ける'],
                        correct: 1,
                        explanation: '紙詰まりの場合は画面の指示に従い除去し、前面・背面カバーも確認します。頻発する場合は保守連絡します。'
                    },
                    {
                        q: 'Akerunの電池切れ警告が出た場合の対応は？',
                        options: ['翌月の定期交換まで待つ', '速やかに電池交換（CR123A）、予備電池は棚に保管', '運営に連絡して電池を発注する', '手動鍵だけで運用する'],
                        correct: 1,
                        explanation: 'Akerunの電池切れ警告が出たら速やかに電池交換（CR123A）してください。予備電池は棚に保管してあります。'
                    },
                    {
                        q: 'コーヒーサーバーの内部洗浄モードはどう実行する？',
                        options: ['専用洗浄液を入れてスタートボタンを押す', '電源ボタン長押し3秒で洗浄モード実行', '抽出口に水を流し込む', '分解して手洗いする'],
                        correct: 1,
                        explanation: 'コーヒーサーバーの内部洗浄は電源ボタン長押し3秒で実行します。週1回の定期メンテナンスとして行います。'
                    },
                    {
                        q: 'コーヒーサーバーから水漏れしている場合に確認すべきことは？',
                        options: ['すぐに電源を切る', 'ドリップトレイの位置確認とパッキンのずれチェック', '水タンクを外す', '床を拭くだけでよい'],
                        correct: 1,
                        explanation: 'ドリップトレイの位置確認とパッキンのずれチェックを行います。改善しなければ運営に連絡してください。'
                    },
                    {
                        q: '製氷機が氷を作らない場合に確認すべきことは？',
                        options: ['電源プラグだけ確認する', '給水バルブの開閉確認とフィルター清掃', 'すぐに新しい製氷機を発注する', '氷の購入で対応する'],
                        correct: 1,
                        explanation: '製氷機が氷を作らない場合は、給水バルブの開閉確認とフィルター清掃を行います。'
                    },
                    {
                        q: '印刷機のトナーが切れた場合の対応は？',
                        options: ['印刷機の利用を停止する', '予備トナーに交換、在庫がなければ発注依頼', 'そのまま印刷を続ける', '運営に連絡して修理を待つ'],
                        correct: 1,
                        explanation: 'トナーが切れたら予備トナーに交換します。在庫がなければ発注依頼を行ってください。'
                    }
                ]
            }
        };

        // クイズモーダルHTML生成
        const quizModalHTML = `
            <div class="quiz-modal-overlay" id="quizOverlay">
                <div class="quiz-modal">
                    <div class="quiz-modal-header">
                        <h3 id="quizTitle">理解度チェック</h3>
                        <button class="quiz-modal-close" id="quizClose">&times;</button>
                    </div>
                    <div class="quiz-modal-body" id="quizBody">
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', quizModalHTML);

        const quizOverlay = document.getElementById('quizOverlay');
        const quizClose = document.getElementById('quizClose');
        const quizBody = document.getElementById('quizBody');
        const quizTitle = document.getElementById('quizTitle');

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let quizAnswered = false;
        let quizWrongAnswers = []; // 誤答記録用

        quizClose.addEventListener('click', () => {
            quizOverlay.classList.remove('active');
        });
        quizOverlay.addEventListener('click', (e) => {
            if (e.target === quizOverlay) quizOverlay.classList.remove('active');
        });

        // GASバックエンドURL（デプロイ後にURLを設定してください）
        const QUIZ_API_URL = localStorage.getItem('studygo_quiz_api_url') || '';

        function getQuizProgress() {
            const user = getCurrentUser();
            if (!user) return {};
            return JSON.parse(localStorage.getItem('studygo_quiz_' + user) || '{}');
        }

        // GASからユーザーの進捗を取得してlocalStorageを更新
        async function syncQuizProgressFromServer() {
            if (!QUIZ_API_URL) return;
            const user = getCurrentUser();
            if (!user) return;
            try {
                const res = await fetch(QUIZ_API_URL + '?action=getProgress&user=' + encodeURIComponent(user));
                const data = await res.json();
                if (data.status === 'ok' && data.progress) {
                    const local = getQuizProgress();
                    let updated = false;
                    Object.keys(data.progress).forEach(key => {
                        if (!local[key] || (!local[key].passed && data.progress[key].passed)) {
                            local[key] = data.progress[key];
                            updated = true;
                        }
                    });
                    if (updated) {
                        localStorage.setItem('studygo_quiz_' + user, JSON.stringify(local));
                        updateTrainingDashboard();
                        updateQuizButtons();
                    }
                }
            } catch (e) { /* サーバー未接続時は無視 */ }
        }

        function saveQuizProgress(sectionId, passed, wrongAnswers) {
            const user = getCurrentUser();
            if (!user) return;
            const progress = getQuizProgress();
            progress[sectionId] = { passed: passed, date: new Date().toISOString() };
            localStorage.setItem('studygo_quiz_' + user, JSON.stringify(progress));
            // 誤答履歴を保存（ローカル）
            if (wrongAnswers && wrongAnswers.length > 0) {
                const historyKey = 'studygo_quiz_history';
                const history = JSON.parse(localStorage.getItem(historyKey) || '[]');
                history.push({
                    user: user,
                    section: quizData[sectionId].title,
                    sectionId: sectionId,
                    date: new Date().toISOString(),
                    score: quizScore + '/' + quizData[sectionId].questions.length,
                    wrongAnswers: wrongAnswers
                });
                if (history.length > 100) history.splice(0, history.length - 100);
                localStorage.setItem(historyKey, JSON.stringify(history));
            }
            // GASバックエンドにも保存（非同期・バックグラウンド）
            if (QUIZ_API_URL) {
                fetch(QUIZ_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'saveResult',
                        user: user,
                        sectionId: sectionId,
                        sectionTitle: quizData[sectionId].title,
                        score: quizScore,
                        total: quizData[sectionId].questions.length,
                        wrongAnswers: wrongAnswers || []
                    })
                }).catch(function() { /* 送信失敗時は無視（ローカルには保存済み） */ });
            }
            updateTrainingDashboard();
            updateQuizButtons();
        }

        function startQuiz(sectionId) {
            if (!getCurrentUser()) {
                alert('クイズに挑戦するにはログインしてください');
                return;
            }
            currentQuiz = quizData[sectionId];
            if (!currentQuiz) return;
            currentQuiz.sectionId = sectionId;
            currentQuestionIndex = 0;
            quizScore = 0;
            quizWrongAnswers = [];
            quizTitle.textContent = currentQuiz.title + ' - 理解度チェック';
            renderQuestion();
            quizOverlay.classList.add('active');
        }

        function renderQuestion() {
            const q = currentQuiz.questions[currentQuestionIndex];
            const total = currentQuiz.questions.length;
            quizAnswered = false;

            let progressHTML = '<div class="quiz-progress">';
            for (let i = 0; i < total; i++) {
                let cls = 'quiz-progress-dot';
                if (i === currentQuestionIndex) cls += ' active';
                else if (i < currentQuestionIndex) cls += ' correct';
                progressHTML += '<div class="' + cls + '"></div>';
            }
            progressHTML += '</div>';

            let optionsHTML = '';
            q.options.forEach((opt, idx) => {
                optionsHTML += '<button class="quiz-option" data-idx="' + idx + '">' + opt + '</button>';
            });

            quizBody.innerHTML = progressHTML +
                '<div class="quiz-question">' +
                    '<div class="quiz-question-number">Q' + (currentQuestionIndex + 1) + ' / ' + total + '</div>' +
                    '<div class="quiz-question-text">' + q.q + '</div>' +
                '</div>' +
                '<div class="quiz-options">' + optionsHTML + '</div>' +
                '<div class="quiz-feedback" id="quizFeedback"></div>' +
                '<button class="quiz-next-btn" id="quizNextBtn" style="display:none;">次の問題へ</button>';

            // オプションクリック
            quizBody.querySelectorAll('.quiz-option').forEach(btn => {
                btn.addEventListener('click', () => handleAnswer(parseInt(btn.dataset.idx)));
            });

            document.getElementById('quizNextBtn').addEventListener('click', () => {
                currentQuestionIndex++;
                if (currentQuestionIndex < currentQuiz.questions.length) {
                    renderQuestion();
                } else {
                    renderResult();
                }
            });
        }

        function handleAnswer(selectedIdx) {
            if (quizAnswered) return;
            quizAnswered = true;

            const q = currentQuiz.questions[currentQuestionIndex];
            const isCorrect = selectedIdx === q.correct;
            if (isCorrect) {
                quizScore++;
            } else {
                quizWrongAnswers.push({
                    questionNum: currentQuestionIndex + 1,
                    question: q.q,
                    selected: q.options[selectedIdx],
                    correct: q.options[q.correct],
                    explanation: q.explanation
                });
            }

            // オプションの色を更新
            quizBody.querySelectorAll('.quiz-option').forEach((btn, idx) => {
                btn.disabled = true;
                if (idx === q.correct) btn.classList.add('correct');
                if (idx === selectedIdx && !isCorrect) btn.classList.add('incorrect');
            });

            // プログレスドット更新
            const dots = quizBody.querySelectorAll('.quiz-progress-dot');
            if (dots[currentQuestionIndex]) {
                dots[currentQuestionIndex].classList.remove('active');
                dots[currentQuestionIndex].classList.add(isCorrect ? 'correct' : 'incorrect');
            }

            // フィードバック表示
            const feedback = document.getElementById('quizFeedback');
            feedback.className = 'quiz-feedback show ' + (isCorrect ? 'correct' : 'incorrect');
            feedback.innerHTML = '<div class="quiz-feedback-title">' + (isCorrect ? '正解!' : '不正解') + '</div>' +
                '<div>' + q.explanation + '</div>';

            // 次へボタン表示
            const nextBtn = document.getElementById('quizNextBtn');
            nextBtn.style.display = 'block';
            if (currentQuestionIndex === currentQuiz.questions.length - 1) {
                nextBtn.textContent = '結果を見る';
            }
        }

        function renderResult() {
            const total = currentQuiz.questions.length;
            const passed = quizScore === total;
            saveQuizProgress(currentQuiz.sectionId, passed, quizWrongAnswers);

            let icon, title, message;
            if (passed) {
                icon = '&#127942;';
                title = '全問正解! 合格!';
                message = 'おめでとうございます！「' + currentQuiz.title + '」の理解度チェックに合格しました。';
            } else {
                icon = '&#128218;';
                title = quizScore + ' / ' + total + ' 問正解';
                message = '全問正解で合格です。もう一度チャレンジしてみましょう！';
            }

            // 誤答レポート
            let wrongHTML = '';
            if (quizWrongAnswers.length > 0) {
                wrongHTML = '<div style="text-align:left; margin-top:15px; padding:12px; background:#FFF3E0; border-radius:8px; font-size:0.85rem;">' +
                    '<div style="font-weight:bold; margin-bottom:8px; color:#E65100;">間違えた問題：</div>';
                quizWrongAnswers.forEach(w => {
                    wrongHTML += '<div style="margin-bottom:10px; padding-bottom:8px; border-bottom:1px solid #FFE0B2;">' +
                        '<div style="font-weight:bold;">Q' + w.questionNum + '. ' + w.question + '</div>' +
                        '<div style="color:#C62828;">あなたの回答: ' + w.selected + '</div>' +
                        '<div style="color:#2E7D32;">正解: ' + w.correct + '</div>' +
                        '</div>';
                });
                wrongHTML += '</div>';
            }

            // コピー用テキスト生成
            const user = getCurrentUser();
            const now = new Date();
            const dateStr = now.getFullYear() + '/' + (now.getMonth()+1) + '/' + now.getDate() + ' ' + now.getHours() + ':' + String(now.getMinutes()).padStart(2,'0');
            let copyText = '【研修クイズ結果】\n';
            copyText += '名前: ' + user + '\n';
            copyText += '日時: ' + dateStr + '\n';
            copyText += 'カテゴリ: ' + currentQuiz.title + '\n';
            copyText += '結果: ' + quizScore + '/' + total + '問正解' + (passed ? '（合格）' : '') + '\n';
            if (quizWrongAnswers.length > 0) {
                copyText += '\n--- 間違えた問題 ---\n';
                quizWrongAnswers.forEach(w => {
                    copyText += '\nQ' + w.questionNum + '. ' + w.question + '\n';
                    copyText += '  回答: ' + w.selected + '\n';
                    copyText += '  正解: ' + w.correct + '\n';
                });
            }

            let copyBtnHTML = '<button id="quizCopyBtn" style="margin-top:10px; padding:8px 20px; background:#1976D2; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:0.9rem;">結果をコピー</button>' +
                '<span id="quizCopyMsg" style="margin-left:8px; color:#2E7D32; font-size:0.85rem; display:none;">コピーしました</span>';

            quizBody.innerHTML =
                '<div class="quiz-result">' +
                    '<div class="quiz-result-icon">' + icon + '</div>' +
                    '<div class="quiz-result-title">' + title + '</div>' +
                    '<div class="quiz-result-score">' + quizScore + ' / ' + total + ' 問正解</div>' +
                    '<div class="quiz-result-message">' + message + '</div>' +
                    wrongHTML +
                    '<div style="margin-top:12px;">' + copyBtnHTML + '</div>' +
                    '<button class="quiz-retry-btn" id="quizRetryBtn" style="margin-top:10px;">' + (passed ? '閉じる' : 'もう一度チャレンジ') + '</button>' +
                '</div>';

            document.getElementById('quizCopyBtn').addEventListener('click', () => {
                navigator.clipboard.writeText(copyText).then(() => {
                    const msg = document.getElementById('quizCopyMsg');
                    msg.style.display = 'inline';
                    setTimeout(() => { msg.style.display = 'none'; }, 2000);
                });
            });

            document.getElementById('quizRetryBtn').addEventListener('click', () => {
                if (passed) {
                    quizOverlay.classList.remove('active');
                } else {
                    currentQuestionIndex = 0;
                    quizScore = 0;
                    quizWrongAnswers = [];
                    renderQuestion();
                }
            });
        }

        // クイズIDとセクションIDのマッピング（同一セクションに複数クイズを配置可能）
        const quizSectionMap = {
            'bp-to-studygo': 'bp-to-studygo',
            'procedures': 'procedures',
            'bp-to-studygo-scenario': 'bp-to-studygo',
            'basic-info': 'cafe-basic',
            'admin-ops': 'admin-panel',
            'staff-daily': 'staff-op',
            'equipment-trouble': 'cafe-studio-compare'
        };

        // 各セクションにクイズボタンを追加
        function addQuizButtons() {
            const progress = getQuizProgress();
            Object.keys(quizData).forEach(quizId => {
                const targetSectionId = quizSectionMap[quizId] || quizId;
                const section = document.getElementById(targetSectionId);
                if (!section) return;
                // 既に同じクイズのボタンがあればスキップ
                if (section.querySelector('.quiz-trigger[data-quiz-section="' + quizId + '"]')) return;

                const isPassed = progress[quizId] && progress[quizId].passed;
                const btn = document.createElement('button');
                btn.className = 'quiz-trigger' + (isPassed ? ' completed' : '');
                btn.setAttribute('data-quiz-section', quizId);
                if (isPassed) {
                    btn.innerHTML = '&#127942; ' + quizData[quizId].title + ' 合格済み - もう一度チャレンジ';
                } else {
                    btn.innerHTML = '&#128221; ' + quizData[quizId].title + ' - クイズに挑戦!';
                }
                btn.addEventListener('click', () => startQuiz(quizId));
                section.appendChild(btn);
            });
        }

        function updateQuizButtons() {
            const progress = getQuizProgress();
            document.querySelectorAll('.quiz-trigger').forEach(btn => {
                const quizId = btn.getAttribute('data-quiz-section');
                const isPassed = progress[quizId] && progress[quizId].passed;
                const title = quizData[quizId] ? quizData[quizId].title : '';
                btn.className = 'quiz-trigger' + (isPassed ? ' completed' : '');
                if (isPassed) {
                    btn.innerHTML = '&#127942; ' + title + ' 合格済み - もう一度チャレンジ';
                } else {
                    btn.innerHTML = '&#128221; ' + title + ' - クイズに挑戦!';
                }
            });
        }

        // 研修進捗ダッシュボードの更新
        function updateTrainingDashboard() {
            const grid = document.getElementById('trainingProgressGrid');
            if (!grid) return;
            const titleEl = document.getElementById('trainingDashboardTitle');
            const user = getCurrentUser();
            if (titleEl) {
                titleEl.textContent = user ? user + 'さんの研修進捗' : '研修進捗';
            }
            const progress = getQuizProgress();
            let html = '';
            Object.keys(quizData).forEach(sectionId => {
                const data = quizData[sectionId];
                const isPassed = progress[sectionId] && progress[sectionId].passed;
                html += '<div class="training-progress-item' + (isPassed ? ' passed' : '') + '">' +
                    '<span class="progress-icon">' + (isPassed ? '&#127942;' : '&#9675;') + '</span>' +
                    '<span>' + data.title + '</span>' +
                '</div>';
            });
            grid.innerHTML = html;
        }

        // 管理者用：誤答分析ダッシュボード
        const ADMIN_USERS = ['國松', '近藤'];

        function renderAdminDashboardFromData(history, staffProgress) {
            const statsEl = document.getElementById('adminQuizStats');
            if (!statsEl) return;

            let html = '';

            // === 全スタッフ進捗一覧（GASデータがある場合）===
            if (staffProgress && Object.keys(staffProgress).length > 0) {
                html += '<div style="margin-bottom:15px;">';
                html += '<div style="font-weight:bold; font-size:0.9rem; margin-bottom:8px;">全スタッフ クイズ進捗</div>';
                html += '<table style="width:100%; border-collapse:collapse; font-size:0.82rem;">';
                html += '<tr style="background:#E8F5E9;"><th style="padding:6px; text-align:left;">スタッフ</th>';
                Object.keys(quizData).forEach(qid => {
                    html += '<th style="padding:6px; text-align:center;">' + quizData[qid].title.replace('スタディGO', '').substring(0, 6) + '</th>';
                });
                html += '</tr>';
                Object.entries(staffProgress).forEach(([name, sections]) => {
                    html += '<tr style="border-bottom:1px solid #E0E0E0;">';
                    html += '<td style="padding:6px; font-weight:bold;">' + name + '</td>';
                    Object.keys(quizData).forEach(qid => {
                        const s = sections[qid];
                        if (s && s.passed) {
                            html += '<td style="padding:6px; text-align:center; color:#2E7D32;">&#127942; 合格</td>';
                        } else if (s) {
                            html += '<td style="padding:6px; text-align:center; color:#E65100;">' + (s.score || '未合格') + '</td>';
                        } else {
                            html += '<td style="padding:6px; text-align:center; color:#999;">未受験</td>';
                        }
                    });
                    html += '</tr>';
                });
                html += '</table></div>';
            }

            // === 誤答分析 ===
            if (!history || history.length === 0) {
                if (!staffProgress || Object.keys(staffProgress).length === 0) {
                    statsEl.innerHTML = '<p style="color:#999; font-size:0.85rem;">まだクイズデータがありません。</p>';
                    return;
                }
                statsEl.innerHTML = html;
                return;
            }

            const questionStats = {};
            const userStats = {};
            history.forEach(entry => {
                if (!userStats[entry.user]) userStats[entry.user] = { total: 0, wrong: 0 };
                userStats[entry.user].total++;
                const wa = entry.wrongAnswers || [];
                wa.forEach(w => {
                    const key = (entry.sectionId || '') + '_Q' + w.questionNum;
                    if (!questionStats[key]) questionStats[key] = { question: w.question, section: entry.section, count: 0, users: [] };
                    questionStats[key].count++;
                    if (!questionStats[key].users.includes(entry.user)) questionStats[key].users.push(entry.user);
                    userStats[entry.user].wrong++;
                });
            });

            const sorted = Object.entries(questionStats).sort((a, b) => b[1].count - a[1].count);
            if (sorted.length > 0) {
                html += '<div style="margin-bottom:15px;">';
                html += '<div style="font-weight:bold; font-size:0.9rem; margin-bottom:8px;">間違いが多い問題 TOP5</div>';
                html += '<table style="width:100%; border-collapse:collapse; font-size:0.82rem;">';
                html += '<tr style="background:#ECEFF1;"><th style="padding:6px; text-align:left;">問題</th><th style="padding:6px; width:60px; text-align:center;">回数</th><th style="padding:6px; width:100px; text-align:left;">間違えた人</th></tr>';
                sorted.slice(0, 5).forEach(([key, data]) => {
                    html += '<tr style="border-bottom:1px solid #E0E0E0;">';
                    html += '<td style="padding:6px;"><span style="color:#888; font-size:0.75rem;">[' + data.section + ']</span> ' + data.question.substring(0, 40) + (data.question.length > 40 ? '...' : '') + '</td>';
                    html += '<td style="padding:6px; text-align:center; color:#C62828; font-weight:bold;">' + data.count + '回</td>';
                    html += '<td style="padding:6px; font-size:0.8rem;">' + data.users.join(', ') + '</td>';
                    html += '</tr>';
                });
                html += '</table></div>';
            }

            // スタッフ別の誤答数
            if (Object.keys(userStats).length > 0) {
                html += '<div style="font-weight:bold; font-size:0.9rem; margin-bottom:8px;">スタッフ別 誤答数</div>';
                html += '<div style="display:flex; gap:8px; flex-wrap:wrap;">';
                Object.entries(userStats).forEach(([name, data]) => {
                    const color = data.wrong === 0 ? '#2E7D32' : '#C62828';
                    html += '<div style="background:#F5F5F5; border-radius:6px; padding:8px 12px; font-size:0.82rem;">';
                    html += '<strong>' + name + '</strong> ';
                    html += '<span style="color:' + color + ';">' + data.wrong + '問ミス</span>';
                    html += ' / 受験' + data.total + '回';
                    html += '</div>';
                });
                html += '</div>';
            }

            statsEl.innerHTML = html;
        }

        function updateAdminDashboard() {
            const dashboard = document.getElementById('admin-quiz-dashboard');
            if (!dashboard) return;
            const user = getCurrentUser();
            if (!user || !ADMIN_USERS.includes(user)) {
                dashboard.style.display = 'none';
                return;
            }
            dashboard.style.display = '';

            // まずローカルデータで表示
            const localHistory = JSON.parse(localStorage.getItem('studygo_quiz_history') || '[]');
            renderAdminDashboardFromData(localHistory, null);

            // GASからデータ取得（非同期）
            if (QUIZ_API_URL) {
                const statsEl = document.getElementById('adminQuizStats');
                const loading = document.createElement('div');
                loading.style.cssText = 'color:#1976D2; font-size:0.8rem; margin-bottom:8px;';
                loading.textContent = 'サーバーからデータを取得中...';
                statsEl.prepend(loading);

                fetch(QUIZ_API_URL + '?action=getAdminDashboard')
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === 'ok') {
                            // GASのresultsからhistory形式に変換
                            let serverHistory = [];
                            if (data.results) {
                                serverHistory = data.results;
                            }
                            // questionStatsとuserStatsが直接返ってくる場合はそれを使う
                            const fakeHistory = [];
                            if (data.questionStats || data.userStats) {
                                // サーバーデータで再描画
                                renderAdminDashboardFromServer(data);
                            } else {
                                renderAdminDashboardFromData(serverHistory, data.staffProgress);
                            }
                        }
                    })
                    .catch(() => {
                        loading.textContent = '(サーバー未接続 - ローカルデータを表示中)';
                        loading.style.color = '#999';
                    });
            }
        }

        // GASのgetAdminDashboardレスポンスを直接描画
        function renderAdminDashboardFromServer(data) {
            const statsEl = document.getElementById('adminQuizStats');
            if (!statsEl) return;
            let html = '';

            // 全スタッフ進捗
            if (data.staffProgress && Object.keys(data.staffProgress).length > 0) {
                html += '<div style="margin-bottom:15px;">';
                html += '<div style="font-weight:bold; font-size:0.9rem; margin-bottom:8px;">全スタッフ クイズ進捗 <span style="color:#2E7D32; font-size:0.75rem;">(全PC共有)</span></div>';
                html += '<table style="width:100%; border-collapse:collapse; font-size:0.82rem;">';
                html += '<tr style="background:#E8F5E9;"><th style="padding:6px; text-align:left;">スタッフ</th>';
                Object.keys(quizData).forEach(qid => {
                    html += '<th style="padding:6px; text-align:center;">' + quizData[qid].title.replace('スタディGO', '').substring(0, 6) + '</th>';
                });
                html += '</tr>';
                Object.entries(data.staffProgress).forEach(([name, sections]) => {
                    html += '<tr style="border-bottom:1px solid #E0E0E0;">';
                    html += '<td style="padding:6px; font-weight:bold;">' + name + '</td>';
                    Object.keys(quizData).forEach(qid => {
                        const s = sections[qid];
                        if (s && s.passed) {
                            html += '<td style="padding:6px; text-align:center; color:#2E7D32;">&#127942; 合格</td>';
                        } else if (s) {
                            html += '<td style="padding:6px; text-align:center; color:#E65100;">' + (s.score || '未合格') + '</td>';
                        } else {
                            html += '<td style="padding:6px; text-align:center; color:#999;">未受験</td>';
                        }
                    });
                    html += '</tr>';
                });
                html += '</table></div>';
            }

            // 間違いが多い問題
            if (data.questionStats && data.questionStats.length > 0) {
                html += '<div style="margin-bottom:15px;">';
                html += '<div style="font-weight:bold; font-size:0.9rem; margin-bottom:8px;">間違いが多い問題 TOP5</div>';
                html += '<table style="width:100%; border-collapse:collapse; font-size:0.82rem;">';
                html += '<tr style="background:#ECEFF1;"><th style="padding:6px; text-align:left;">問題</th><th style="padding:6px; width:60px; text-align:center;">回数</th><th style="padding:6px; width:100px; text-align:left;">間違えた人</th></tr>';
                data.questionStats.forEach(item => {
                    html += '<tr style="border-bottom:1px solid #E0E0E0;">';
                    html += '<td style="padding:6px;"><span style="color:#888; font-size:0.75rem;">[' + item.section + ']</span> ' + item.question.substring(0, 40) + (item.question.length > 40 ? '...' : '') + '</td>';
                    html += '<td style="padding:6px; text-align:center; color:#C62828; font-weight:bold;">' + item.count + '回</td>';
                    html += '<td style="padding:6px; font-size:0.8rem;">' + item.users.join(', ') + '</td>';
                    html += '</tr>';
                });
                html += '</table></div>';
            }

            // スタッフ別誤答数
            if (data.userStats && Object.keys(data.userStats).length > 0) {
                html += '<div style="font-weight:bold; font-size:0.9rem; margin-bottom:8px;">スタッフ別 誤答数</div>';
                html += '<div style="display:flex; gap:8px; flex-wrap:wrap;">';
                Object.entries(data.userStats).forEach(([name, stat]) => {
                    const color = stat.wrong === 0 ? '#2E7D32' : '#C62828';
                    html += '<div style="background:#F5F5F5; border-radius:6px; padding:8px 12px; font-size:0.82rem;">';
                    html += '<strong>' + name + '</strong> ';
                    html += '<span style="color:' + color + ';">' + stat.wrong + '問ミス</span>';
                    html += ' / 受験' + stat.total + '回';
                    html += '</div>';
                });
                html += '</div>';
            }

            if (!html) html = '<p style="color:#999; font-size:0.85rem;">まだクイズデータがありません。</p>';
            statsEl.innerHTML = html;
        }

        // エクスポート・クリアボタン
        document.getElementById('adminExportBtn').addEventListener('click', () => {
            // GASから取得を試み、なければローカル
            if (QUIZ_API_URL) {
                fetch(QUIZ_API_URL + '?action=getAllResults')
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === 'ok' && data.results && data.results.length > 0) {
                            exportHistory(data.results, true);
                        } else {
                            exportLocalHistory();
                        }
                    })
                    .catch(() => exportLocalHistory());
            } else {
                exportLocalHistory();
            }
        });

        function exportLocalHistory() {
            const history = JSON.parse(localStorage.getItem('studygo_quiz_history') || '[]');
            if (history.length === 0) { alert('履歴がありません'); return; }
            exportHistory(history, false);
        }

        function exportHistory(history, isServer) {
            let text = '【研修クイズ 誤答履歴レポート】' + (isServer ? '（全PC統合）' : '（このPC分のみ）') + '\n';
            text += '出力日時: ' + new Date().toLocaleString('ja-JP') + '\n';
            text += '================================\n\n';
            history.forEach(entry => {
                const d = entry.date ? new Date(entry.date) : null;
                const dateStr = d ? d.toLocaleString('ja-JP') : (entry.date || '');
                text += '■ ' + entry.user + ' / ' + entry.section + ' / ' + dateStr + ' / ' + entry.score + '\n';
                const wa = entry.wrongAnswers || [];
                wa.forEach(w => {
                    text += '  Q' + w.questionNum + '. ' + w.question + '\n';
                    text += '    回答: ' + w.selected + '\n';
                    text += '    正解: ' + w.correct + '\n';
                });
                text += '\n';
            });
            navigator.clipboard.writeText(text).then(() => {
                const msg = document.getElementById('adminCopyMsg');
                msg.style.display = 'inline';
                setTimeout(() => { msg.style.display = 'none'; }, 2000);
            });
        }

        document.getElementById('adminClearBtn').addEventListener('click', () => {
            if (confirm('誤答履歴をすべて削除しますか？（ローカルのみ。サーバーデータは残ります）')) {
                localStorage.removeItem('studygo_quiz_history');
                updateAdminDashboard();
            }
        });

        addQuizButtons();
        updateTrainingDashboard();
        updateAdminDashboard();
        // ログイン済みならGASから進捗を同期
        if (getCurrentUser() && QUIZ_API_URL) {
            syncQuizProgressFromServer();
        }
        // API URL設定ボタン
        const apiUrlInput = document.getElementById('quizApiUrlInput');
        const saveApiUrlBtn = document.getElementById('saveQuizApiUrl');
        if (apiUrlInput && saveApiUrlBtn) {
            apiUrlInput.value = QUIZ_API_URL;
            saveApiUrlBtn.addEventListener('click', () => {
                const url = apiUrlInput.value.trim();
                if (url) {
                    localStorage.setItem('studygo_quiz_api_url', url);
                } else {
                    localStorage.removeItem('studygo_quiz_api_url');
                }
                const msg = document.getElementById('apiUrlSaveMsg');
                msg.style.display = 'inline';
                setTimeout(() => { msg.style.display = 'none'; }, 3000);
            });
        }

    // スクリーンショット拡大モーダル
    (function(){
        var overlay = document.createElement('div');
        overlay.className = 'screenshot-modal-overlay';
        overlay.innerHTML = '<img src="" alt="">';
        document.body.appendChild(overlay);
        overlay.addEventListener('click', function(){ overlay.classList.remove('active'); });
        window.openScreenshot = function(img){
            overlay.querySelector('img').src = img.src;
            overlay.querySelector('img').alt = img.alt;
            overlay.classList.add('active');
        };
    })();

    
        // マネージャー用：全問題一覧表示
        function showAllQuizReview() {
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:10000;overflow-y:auto;padding:20px;box-sizing:border-box;';

            let html = '<div style="max-width:900px;margin:0 auto;background:#fff;border-radius:12px;padding:30px;position:relative;">';
            html += '<button onclick="this.parentElement.parentElement.remove()" style="position:sticky;top:0;float:right;background:#f44336;color:#fff;border:none;border-radius:50%;width:36px;height:36px;font-size:1.2rem;cursor:pointer;z-index:1;">&times;</button>';
            html += '<h2 style="margin:0 0 20px;color:#7B1FA2;">全問題一覧（全' + Object.values(quizData).reduce((s,d)=>s+d.questions.length,0) + '問）</h2>';

            let questionNum = 0;
            Object.keys(quizData).forEach(sectionId => {
                const section = quizData[sectionId];
                html += '<div style="margin-bottom:25px;">';
                html += '<h3 style="background:#7B1FA2;color:#fff;padding:10px 15px;border-radius:8px;margin:0 0 10px;">' + section.title + '（' + section.questions.length + '問）</h3>';

                section.questions.forEach((q, idx) => {
                    questionNum++;
                    html += '<div style="background:#FAFAFA;border:1px solid #E0E0E0;border-radius:8px;padding:12px 15px;margin-bottom:8px;">';
                    html += '<div style="font-weight:bold;color:#333;margin-bottom:8px;">Q' + questionNum + '. ' + q.q + '</div>';

                    q.options.forEach((opt, oi) => {
                        const isCorrect = oi === q.correct;
                        const style = isCorrect
                            ? 'background:#E8F5E9;border:2px solid #4CAF50;color:#2E7D32;font-weight:bold;'
                            : 'background:#fff;border:1px solid #ddd;color:#666;';
                        html += '<div style="' + style + 'padding:6px 10px;border-radius:4px;margin:3px 0;font-size:0.85rem;">';
                        html += (isCorrect ? '&#9989; ' : '&emsp; ') + opt;
                        html += '</div>';
                    });

                    html += '<div style="background:#FFF3E0;padding:8px 10px;border-radius:4px;margin-top:6px;font-size:0.82rem;color:#E65100;">';
                    html += '<strong>解説：</strong>' + q.explanation;
                    html += '</div>';
                    html += '</div>';
                });

                html += '</div>';
            });

            html += '</div>';
            overlay.innerHTML = html;
            document.body.appendChild(overlay);
        }

        // 全問題一覧ボタン
        const allQBtn = document.getElementById('adminAllQuestionsBtn');
        if (allQBtn) {
            allQBtn.addEventListener('click', showAllQuizReview);
        }

        </script>
</body>
</html>
